
<style>
    @font-face {font-family: "iconfont";
    src: url('//at.alicdn.com/t/font_1474105_ofrmqg44wnb.eot?t=1573009901867'); /* IE9 */
    src: url('//at.alicdn.com/t/font_1474105_ofrmqg44wnb.eot?t=1573009901867#iefix') format('embedded-opentype'), /* IE6-IE8 */
    url('data:application/x-font-woff2;charset=utf-8;base64,d09GMgABAAAAAAoQAAsAAAAAESgAAAnDAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCEHgqTdJAgATYCJAMsCxgABCAFhG0HgQkbcQ4jEfZ6sPKR/WWCdlnceqOKQERjn7E1TtHa4Stw0lrHLs+QMunPlR8qlGrzzFBKiGi/3+zZs/8Ra2pRXJJqInRNYiHTCJFQoONRLGSmcLM2CV8gIbS9AkEqVNShpeIBzmhPVOCMPtS4wWtU/EwkgbsX1wAI8wYIGOufAwT/i3N1dw9kTNTLkTz75NFnXdpmhbQD+r+1Vk8TJqEcg7d75L6zYjPD28E/5neOSyJdhRIJaRf3aInQLkNrxEorBjrnqvEHGDEemixnL51JmEHF7DfuhgAhWSpI5+fgJD4GNgWTdnh9Ed9Tj0nIE/xaF3GmQU6w+OpI3QE4lp8vP6TEAoXV8JGja10rtL7zRRntv3ZmXMjVAXBwAg1UAHNgV5HWCURuBZpwpGEFSBJX1PAuLhp++Dj/Iua9a5MNAytRU0iSIk0GgL3vpQhwhHjo6fjmiYNJjPyH0RDeeVfDwruYSGrBUaAOnAA0hEmQRjABHQbHA31ANTR8nAM+W0SGsjlJRKEMULo36h8NNTAblOKykWCjMCNsVUme2JfgciduJTlaWKyAnyDoriQpUj9cxGbE4t4JHLZQGChkMDgB27WAolCO2616w+NR22xE98XwkbGjF2+fF1lGsJHT/InT4bdppZbUQR7VoBs1mHnHyji3UqxW9BYl1b4maRrzYEqjR72MVhun+icjzqQNi52Tp8aF9ojRsOFxUW+60oCaBVarjeMw3DhiH0anG1DUbLVCdSXb+BiOGS30mM3ovCy7j+rG+LhtRDssII2YJJzgC21XWQ1mLV9pcfDMdh4qMPNBz7MwFNGhPNRq4MHo6I1AyFalZXVmD7HYNpbuizTadAKVddQwzFsw7jp+PhwDA7Tc+64nFMLGrp4cXIHBKLL9jDtwyFN+mw7uodKA3SBe5etZforyL4J3jn3uDMhpEHK6jSI4lK2XB8w7c0V31XhZe4n0LT57VXfFcEl7eaWauV6ltukmDTxyAO7xEDl+OVbduhAxJV48OQ1CHWcoG3XH5IyeCTNTilvkqC98CQCKZn6aP4gRYw8fejyp8+ME6cg9JEVGVF5w0zUhKNyoPuuJjY0eodNpDDMSGFhtnlbc65N1U0a+Um0zTmh5841jEKSbhBHAMrIYheb6WhRFAnR4XAg7JjBv45QEcU6uKvtaNK0EnLVcxHu+wR0zKnbm2i7aZuYdeWFhw3wL/zyt9njE1skMg1Vnw04/FlEfkBSl0qFWoltis/DsQrPaILASRz2ZRgvvFBVn1tRj6GLkcvECN1gFNeN0BgjgKK4LXBcjLfxeQFGLt5M8zX2DbnJ0TGHg0vzUAKHgDCjAdgAw6AwYtCAEhwMGoW5MmHDsCIqae8etmpQeBLN4OupERIZbaCVNExhcWCinRfSHSs/HagQ94x6/l8kR8M5RWfeoMHQGDjhqDEa3U5+Q9KdKz+dq92ezzQaBijT3lBPqqfSNuSwWqfS/nJNcqD8AGmdrmp42gTlzoUYcNMxqaWAU3Qr9/fpg8GTsvpDpttksvP7Uw+Qda8cqZkHFhggjAKAD6uDLizPYI9mi40HHhdGjaHG5grkfYPA+IFNW52yANnwBiuRyULRpjwIoAG8+b1ER8NHFpE/U28NzdD/8MGcjwrtmuLBh47WTyVvZ28zMLzGCLcB+Dlm/nlNvvsDgO5uS61GK42XZxnYMeYWZ5sw5FuEfcWz/nl/9250RHpAeAeHHQMHcTpNpk+A9geqgSZ2Vw7j9g/yZlHUhMLTrzUwUPvahy4edvVb7S8B5NptT9gEdxXSOTDq7HIP9iwTfChYPWi+8CP3o8rgr9EBxpyu8HS+daWKZFDPxdqlrMNVObhjC8ykg+Ye6s9nFXD+ZLDlZLkO4WcVn18OR8KJ1Zx9wEXlEiUzmx80uTqXuytlcdyECTos0ndmZQzkGzpK+J3+37F35exlrkgzne2Sgw+db+XfyMGgF0iN2jvoWtEe3aJo1rZIUiX22JuzHxSGS1mZNiybLsbf5ppPGLhmHbrPuJIkYgOVX1euWRf0hYa1BZc0113uqQBfMEG8Q94FNCXdL9s9eVJfZFD6jq55zbZO5XZFeJPsosTyLAl19kuLzLXeHm4obfUvTiuVJDZqCzZFnVvf/0FTirZ+eOXrgfHxLvn49T5MvKwnpB0G/k3ef3ZG9+14r4UPoH7988lJPAGIL+LcOjUMv9VG8OPYldtyyzeXN8Oa+vs3W4SNw1ebyJAcyhjh5N/wmkHFkorEZmrd16zzpEAI/TvOV1AeTXZMg7GHVsmkHE0ILako2/nwmYXlDZU4h6jWf+RY2QjwMuT8zinnDhznhM8H8wC8cKvVfcJBfxN7MJt8G0Fpmti3jU2J/uSB+DRJMllF1SV+wEteOVcadCLnJcyFuN+Ly4fqF+bc+GjfCS8GxpamzI/LvvMxIaOpvaQG74HN20fZkGOcipuvXTXoicuM6bAqtJ7Z/dJZYEIG4aDf44Z8imRxG5PIkac/0m1YqTzvTFZIqngZPIzX4gZPn9vnmFhS0sa9d8GlLyE3G265f7EBz42kHfE+dw1sVBaaG/IKidexeB76uqqCKu7bXtpZZoOdd5t1lwZenFqRiK7qs4MPda4yVMlm1os5ZMRWYtIVTF1gTNiMLkkigWRkN0s9uC0caNAUUtc5qBTYdNa7LnA746xle24K+fvarOcgcPn9PfcwBpfLAHLFn4Wz+z/gp7rK8ZdYXeZoOpIj2NUMqZVh/DYbmjPC6qSf0Lo5uFv4v3Kx29yb0/f2ufj3xP7GlP9ADdl8DVP5/rWFk0/+h6yFI7i1011EkW47QO45sBdSDMGE2BW7oQIrzbsH/RjwOIclFOzoQraa6F/jiL52+xTvvVxb2vzD4+ouZ30pcvVtLtHoFgai4dgEtlBsurmt3laUq5HfK/846IBUMRFwHIQWEIgW0z64Ub9Wz9Myybs3SHaTwyEQanwK38VcgS0Qlcvi0oJByPedHpNpFIyYAyuwZSEhygxQJ3Bo6yn9vGPhfkSXDn+7ICkEh05J6xYhjX+Pnt4Fwog7aHVhJ1NU0PavJ32RmjwOpu4P+aRhZItRF9Yx/UaShimPGxTTTpEEPEuDTOIK8F0iD9KSmwhJL17LUp2MLJeH07G0gnL4VO9Duwawk6q2n58DHf5OZPQ4Jq96C/2kYefugVqgyuL9IzLRqV2aOi2lMBBreCwcJ4JOAvIgISNG79aSmgi0QSlclbaSzkqJ5FtY3YfWtyW8cpUSLEStOPPElkFAiifEylGOWgQ/L96OVeaf7RJ6neIw909PG6LGTNd6MszyuGM1hbf8wogRGuceY5+b3Br0tn04=') format('woff2'),
    url('//at.alicdn.com/t/font_1474105_ofrmqg44wnb.woff?t=1573009901867') format('woff'),
    url('//at.alicdn.com/t/font_1474105_ofrmqg44wnb.ttf?t=1573009901867') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */
    url('//at.alicdn.com/t/font_1474105_ofrmqg44wnb.svg?t=1573009901867#iconfont') format('svg'); /* iOS 4.1- */
    }

    .iconfont {
    font-family: "iconfont" !important;
    font-size: 14px;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    }

    .iconlanjie:before {
    content: "\e82a";
    }

    .iconxialadown:before {
    content: "\e600";
    }

    .iconanquan:before {
    content: "\e606";
    }

    .iconguanbi:before {
    content: "\e60b";
    }
	.waf_conter{height:100%;color:#444}.waf_left_menu{display:inline-block;width:140px;height:100%;background:#f0f0f1}.waf_left_menu li{padding:0 20px;height:40px;line-height:40px;cursor:pointer}.waf_left_menu li.active{background:#fff}.waf_left_menu .icon{display:inline-block}.waf_left_menu .icon i{color:#666;font-size:17px}.waf_left_menu span{margin-left:8px;color:#666;font-size:13px}.waf_rigth_body{position:absolute;top:0;right:0;bottom:0;left:140px;height:100%}.waf_rigth_body .item_con{display:none}.waf_rigth_body .item_con.active{display:block}.waf_switch>span{margin:0 5px;font-size:15px;line-height:30px}.switch-wrapper,.waf_switch>span{display:inline-block;height:30px;vertical-align:middle}.switch-wrapper{position:relative;z-index:0;overflow:hidden;width:88px;border:1px solid;border-color:#ccc;border-radius:4px;cursor:pointer}.switch-wrapper.swicth-sm{width:72px;height:26px}.waf_switch.swicth-sm>span{font-size:13px}.switch-wrapper.swicth-sm span{padding:3px 8px;width:36px;height:24px;font-size:11px}.switch-wrapper.swicth-sm .swicth_container{width:81pt;height:24px}.swicth_container{display:inline-block;width:129px;height:28px;border-radius:4px;vertical-align:middle;font-size:0;transition:all .5s;transform:translate3d(0,0,0)}.swicth_no{border-bottom-left-radius:3px;border-top-left-radius:3px;background:#5cb85c;color:#fff}.swicth_yes{border-top-right-radius:3px;border-bottom-right-radius:3px;background:#f0ad4e;color:#fff}.swicth_container span{display:inline-block;padding:5px 10px;width:43px;height:28px;vertical-align:top;text-align:center;font-size:9pt;line-height:1.5;line-height:18px;direction:ltr}.switch-wrapper.swicth-sm span i{display:inline-block;text-align:left;transform:scale(.85)}.switch-wrapper.swicth-sm .swicth_yes i{position:relative;left:-2px}.swicth_container span i{font-style:inherit}.switch-wrapper .waf_swicth{display:none}.waf_totall_data{margin:0;padding:0 40px;border-top:1px solid #f1f1f1;border-bottom:1px solid #f1f1f1;text-align: center;}.waf_totall_data .item_center{margin:0 auto;padding:15px 0;min-width:200px}.waf_totall_data .icon{display:inline-block}.waf_totall_data .icon i{color:#5cb85c;font-size:60px}.waf_totall_data .grade_1 .icon i,.waf_totall_data .grade_1 .item_data{color:#5d88b4}.waf_totall_data .grade_2 .icon i,.waf_totall_data .grade_2 .item_data{color:#5cb85c}.waf_totall_data .grade_3 .icon i,.waf_totall_data .grade_3 .item_data{color:#d9534f}.waf_totall_data .tips{display:inline-block;margin-left:20px}.waf_totall_data .item_title{display:block;margin-bottom:3px;text-align:center;font-size:17px}.waf_totall_data .item_data{display:block;text-align:center;font-weight:500;font-size:21px}.waf_totall_data .item_data i{font-style:initial}.waf_totall_data .item_data i:nth-child(2){margin-left:2px;font-size:1pc}.waf_other_data{text-align: center; margin:0;padding:10px 0}.waf_other_data .item_conter{padding:15px 0}.waf_other_data .item_title{display:block;font-size:15px}.waf_other_data .item_data{position:relative;top:1px;display:block;margin-left:5px;color:#aaa;font-size:19px}.waf_other_data .grade_1 .item_data{color:#5cb85c}.waf_other_data .grade_2 .item_data{color:#d9534f}.waf_other_tips{position:absolute;right:20px;bottom:25px;left:20px;padding:15px 0 0 20px;border-top:1px solid #f1f1f1;font-size:13px;color:#777}.waf_other_tips li{list-style-type: disc;line-height: 21px;}.waf_table{border:1px solid #ececec}.waf_table>thead>tr{background:#f6f6f6}.waf_table>tbody>tr>td,.waf_table>thead>tr>th{padding:8px;vertical-align:middle}.waf_table>thead>tr>th{height:25px;font-weight:500;line-height:25px}.waf_table>tbody>tr>td,.waf_table>thead>tr>th{border-bottom:1px solid #ececec;font-size:13px}.waf_table>tbody>tr>td{height:20px;color:#444;line-height:20px}.waf_table .btswitch-ios:checked+.btswitch-btn{background:#5cb85c}.waf_table .btswitch-ios+.btswitch-btn{border:none}.waf_table .btswitch+.btswitch-btn{position:relative;top:4px;margin-bottom:0;width:2.2em;height:1.3em}.waf_table>tbody>tr>td>span,.waf_unselect i{display:inline-block}.waf_unselect i{width:1pc;height:1pc;border:1px solid #d2d2d2;border-radius:2px;background-color:#fff;vertical-align:text-bottom;text-align:center;font-size:9pt;line-height:1pc;cursor:pointer;transition:.1s linear}.waf_unselect input{display:none}.tipsval{margin-left:7px;color:#999;}.tipsval.grade_1{color:red}.tipsval.grade_2{color:#d9534f}.waf_unselect .waf-checked{border:1px solid#5fb878;background:#5cb85c}.waf_unselect .waf-checked span{width:9pt;height:9pt;color:#fff;transform:scale(.8,.8)}.waf_page{float:right;padding:0 5px;height:30px;font-size:13px}.waf_page span.Pcurrent{display:inline-block;margin-right:2px;width:30px;height:30px;border-radius:2px;background-color:#5cb85c;color:#fff;text-align:center;line-height:30px}.waf_page span.Pcount{margin-right:0;margin-left:5px}.waf_page a{display:inline-block;margin:0 3px;padding:0 10px;height:30px;border-radius:2px;background-color:#f5f5f5;color:#666;text-align:center;line-height:30px;cursor:pointer}.waf_page a:hover{background:#e5e5e5}.waf-icon-ok .glyphicon-ok{display:none}.waf-icon-ok.waf-checked .glyphicon-ok{display:inline-block}.waf-form{padding:25px}.waf-line,.waf-lines{margin-bottom:15px}.waf-line{height:2pc;line-height:2pc}.waf-line-tips,.waf-line.waf_one{margin-bottom:0}.waf-line-tips{margin-top:20px}.waf-line .name-l,.waf-lines .name-l{display:inline-block;margin:0 10px;width:70px;color:#666;text-align:right;font-size:13px}.waf-line .info-r{height:2pc;line-height:2pc}.waf-line .info-r,.waf-lines .info-r{display:inline-block;vertical-align:top}.waf-line .info-r input{padding:2px 2px 2px 4px;border-radius:2px}.waf-input{padding:2px 2px 2px 6px;height:2pc;border:1px solid #ccc;border-radius:2px;line-height:2pc;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.waf_input_tips{display:inline-block;margin-left:5px;height:2pc;color:#999;line-height:2pc}.waf_tips_list{margin-top:15px;margin-left:25px;}.waf_tips_list li{list-style-type: disc;line-height:21px;}.waf_tips_list .key{color:red}.cc_rule_form{padding:35px 25px 15px 35px}.other_table{overflow:auto;padding:18px 15px}.waf-fht-cell{overflow:hidden;height:1px}.fixed-table{margin-bottom:0}.fixed-table-view{position:relative;overflow-x:hidden;overflow-y:auto;padding-right:1px;border-radius:3px;}.fixed-table-thead{position:absolute;top:0;z-index:9999}.fixed-table-shadow{box-shadow:2px 2px 4px rgba(0,0,0,.1)}.waf-form-input{margin-bottom:15px}.waf-form-input input{height:35px;line-height:35px}.other_table .waf-form-input input:nth-child(1){margin-right:10px;width:530px;height:35px;line-height:35px}.other_table .waf-form-input input:nth-child(2){margin-right:10px;width:150px;height:35px;line-height:35px}.waf-form-input button{padding:4px 15px;height:35px;font-size:13px}.waf-table-textarea{position:relative;top:5px;height:auto;line-height:20px}.ip_region_table,.other_rule_table,.ua_name_table{padding:25px 15px}.ip_region_table .waf-form-input input:nth-child(1){margin-right:10px;width:215px}.other_rule_table .waf-form-input input:nth-child(1){width:440px}.ip_region_table .waf-form-input input:nth-child(2){width:215px}.scan_rule_form .waf-input{width:430px;height:82px;line-height:18px}.mtl0{margin-top:0;margin-left:15px}.site_logs_table{padding:20px}.waf_date_select{margin-bottom:15px}.waf-unselect{position:relative;display:inline-block;height:38px;border:1px solid #e6e6e6;border-radius:2px;font-size:13px;line-height:28px}.waf-unselect .waf-inputs{box-sizing:border-box;padding:5px 40px 5px 15px;height:38px;cursor:pointer}.waf-unselect.active .waf-inputs:after{transform:rotate(180deg)}.waf-unselect .waf-inputs:after{position:absolute;top:1pc;right:9pt;display:block;width:0;height:0;border-color:#c2c2c2 transparent transparent;border-style:solid;border-width:6px 6px 0;content:'';transition:transform .5s}.waf-unselect.active .waf-input-list{animation-name:layui-upbit;animation-duration:.3s;animation-fill-mode:both}.waf-input-list{position:absolute;top:42px;right:-1px;left:-1px;z-index:899;display:none;box-sizing:border-box;padding:5px 0;height:auto;min-width:100%;border:1px solid #d2d2d2;border-radius:2px;background-color:#fff;box-shadow:0 2px 4px rgba(0,0,0,.12)}.waf-unselect.active .waf-input-list{display:block}.waf-input-list dd{padding:5px 15px;height:38px;line-height:30px}.waf-input-list dd.waf_checked{background:#5fb878!important;color:#fff}.waf-input-list dd:hover{background-color:#f2f2f2;cursor:pointer}.waf_date_select .waf-title{display:inline-block;width:auto;height:40px;font-size:14px;line-height:40px}.divpre{overflow:auto;margin:0 0 10px;padding:9.5px;max-height:75pt;border:1px solid #ddd;border-radius:4px;background-color:#f6f6f6;color:#333;word-wrap:break-word;font-size:13px;line-height:1.42857143;word-break:break-all}.lib-con{margin-bottom:10px;width:100%}#site_logs_table{margin-top:13px}
	.waf_head_view{height: 35px;margin: 5px 0;}
	.ua_name_table input{width:440px;}
	.http_rule_table .tab_list,
    .other_rule_table .tab_list,
    .ip_region_table .tab_list{width:100%;font-size: 0;}
	.spider_list_table .tab_list .tab_block,
	.http_rule_table .tab_list .tab_block,
    .other_rule_table .tab_list .tab_block,
    .ip_region_table .tab_list .tab_block{
        width: 50%;
        height: 45px;
        line-height: 45px;
        display: inline-block;
        text-align: center;
        border: 1px solid #cfcfcfcf;
        border-top: 0;
        background: #ececec;
        cursor: pointer;
        font-size: 12px;
    }
	
    .spider_list_table .tab_list .tab_block.active,.http_rule_table .tab_list .tab_block.active,.other_rule_table .tab_list .tab_block.active,.ip_region_table .tab_list .tab_block.active {
        background: #fff;
        border: 0;
    }
	
	.http_rule_table .tab_list div.tab_block{
		width: 33.333333%;
    }
	.spider_list_table ul{
		font-size: 0;
	}
	.spider_list_table ul .tab_block {
		width: 16.65% !important;
	}	
	/* 站点配置首页 */
	#site_table .waf_table>tbody>tr>td,
	#site_table .waf_table>thead>tr>th{
		font-size: 12px;
	}
	#site_table .waf_unselect i{
		width: 0.8pc;
    	height: 0.8pc;
		line-height: 0.8pc;
	}
	#site_table .waf_unselect .waf-checked span{
		width: 3pt;
		height: 3pt;
		transform: scale(.7,0.7);
		left: -2px;
	}
	#site_table .tipsval {
		margin-left: 2px;
		font-size: 12px;
		vertical-align: -2px;
	}
	/* 站点配置首页 结束 */
    .waf_nav_group{
		height: 36px;
    	line-height: 36px;
		border-bottom: 1px solid #ececec;
		font-size: 0;
	}
	.waf_nav_group span{
		display: inline-block;
		height: 36px;
		padding: 0 25px;
		font-size: 13px;
		cursor: pointer;
		color: #444;
		border: 1px solid #fff;
		border-bottom:none;
		position: relative;
		top: -1px;
	}
	.waf_nav_group span.active{
		border: 1px solid #ececec;
		line-height: 34px;
		color: #444;
		border-bottom-color:#fff;
		border-top-left-radius: 2px;
		border-top-right-radius: 2px;
	}
	.waf_nav_content{
		display: block;
		position: relative;
	}
	.waf_nav_content .waf_nav_item{
		display: none;
		padding-top: 15px;
	}
	.waf_nav_content .waf_nav_item.active{
		display: block;
	}
	.waf_nav_content .webshell_logs{
		background-color: #424251;
		width: 100%;
		height: 560px;
		padding: 10px;
		color: #fff;
		line-height: 17px;
		border-radius: 2px;
		outline: none;
		resize:none;
	}
	.waf_nav_item .waf_nav_header select{
		height: 34px;
		font-size: 14px;
	}
	.waf_nav_item .waf_nav_header{
		margin-bottom: 15px;
	}
	.input_list_two input{
		height: 34px;
	}
	.input_list_two{
		margin-right: 15px;
	}
	.file_rule span{
		width:220px;
		vertical-align: bottom;
		overflow: hidden;
		text-overflow:ellipsis;
		white-space: nowrap;
		position: relative;
		cursor: pointer;
	}
	.rule_down_icon{
		width: 25px;
		height: 42px;
		line-height: 42px;
		text-align: center;
		background: #fff;
		border:1px solid #ececec;
		position: absolute;
		right: 0;
		top: 5px;
		cursor: pointer;
	}
	.rule_mask{
		position: absolute;
		z-index: 999999;
		top: 48px;
		line-height: 18px;
		background: #fff;
		box-shadow: 0 1px 8px rgba(0,0,0,.2);
		padding: 10px 15px;
		max-width: 300px;
	}
	.rule_mask .iconfont{
		font-size: 23px;
		position: absolute;
		background: #fff;
		top: -9px;
		right: -11px;
		cursor: pointer;
	}
	.file_rule_link{
		display: inline-block;
		width: 180px;
		vertical-align: bottom;
		overflow: hidden;
		text-overflow:ellipsis;
		white-space: nowrap;
		position: relative;
		cursor: pointer;
	}
	#site_table .waf_table tbody tr td:first-child span a{
		width: 100px;
		display: block;
		overflow:hidden;
		text-overflow:ellipsis;
		white-space:nowrap
	}
	#logs_table .waf_table tbody tr td:first-child span{
		width: 550px;
		display: block;
		overflow:hidden;
		text-overflow:ellipsis;
		white-space:nowrap
	}
	#logs_table .waf_table tbody tr td{
		line-height: 25px;
	}
	#site_logs_table .waf_table tbody tr td:nth-child(4) span{
		width: 205px;
		display: block;
		overflow: hidden;
		text-overflow:ellipsis;
		white-space:nowrap
	}
	#site_logs_table .waf_table tbody tr td:nth-child(6) span{
		width: 50px;
		display: block;
		overflow: hidden;
		text-overflow:ellipsis;
		white-space:nowrap
	}
	#site_logs_table .waf_table tbody tr td:nth-child(7) span{
		width: 139px;
	}
	#history_table .waf_table>tbody>tr>td{
		line-height: 15px;
	}
	.overflow_hide{
		overflow: hidden;
		text-overflow:ellipsis;
		white-space:nowrap
	}
	.waf_config_line{
		display: inline-block;
	}
	.waf_config_line .waf_unselect{
		margin: 0 15px 0 5px;
	}

	/* 站点配置-》批量配置 start */
	#site_table i.dot{
		position: relative;
	}
	#site_table i.dot:after{
		content: "";
		height: 4px;
		width: 4px;
		border-radius: 2px;
		background: #fc6d26;
		position: absolute;
		top: 0;
	}
	/* 站点配置-》批量配置 end */
    /*拦截日志 start*/
	.alarm-view .bt-w-main{height:400px}
	.alert-group-box .box-group {
		display: inline-block;
		margin-right: 15px;
		vertical-align: middle;
		height: 32px;
		line-height: 32px;
	}
	.alert-group-box .bt_checkbox_groups {
		display: inline-block;
		height: 16px;
		width: 16px;
		border-radius: 1px;
		cursor: pointer;
		border: 1px solid #c2c2c2;
		position: relative;
		text-align: center;
		line-height: 20px;
		margin: 0;
		vertical-align: top;
	}
	.alert-group-box .bt_checkbox_groups.active {
		border: none;
		position: relative;
		top: 1px;
		display: inline-block;
		font-family: 'Glyphicons Halflings';
		font-style: normal;
		font-weight: 400;
		line-height: 1;
		-webkit-font-smoothing: antialiased;
		background: #20a53a;
		color: #fff;
	}
	.alert-group-box .bt_checkbox_groups.active:after {
		content: "\e013";
		font-size: 12px;
		transform: scale(.85);
		position: absolute;
		left: 2px;
		top: 2px;
	}
	.alert-group-box .box-group .bt_checkbox_groups {
		vertical-align: -2px;
		margin-right: 5px;
	}
	/*拦截日志 end*/
	/* 封锁历史 */
	.history_add_ip_white {
		cursor: pointer;
		display: inline-block;
	}
	.history_add_ip_white .waf_unselect i{
		width: 0.9pc;
    	height: 0.85pc;
	}
	.history_add_ip_white .waf_unselect .waf-checked span{
		width: 0.3pt;
		height: 0.3pt;
		left: -5px;
		top: 0;
	}
	/* 封锁历史 end */
	/* 多选、搜索下拉样式 */
	.clean_log_data .select-menu {
		display: inline-block;
		position: fixed;
		background-color: #fff;
		border: 1px solid #ccc;
		border-radius: 2px;
	}
	.clean_log_data .select-menu .select-picker-search{
		height: 28px;
		line-height: 28px;
		padding-left: 8px;
		outline: none;
	}
	.clean_log_data .select-menu .select-picker-search span{
		white-space: nowrap;
		text-overflow: ellipsis;
		overflow: hidden;
		display: block;
	}
	.clean_log_data .select-menu input {
		margin: 10px 10px 0 10px;
		padding: 0 0 5px 0;
		height: 25px;
		line-height: 25px;
		border: none;
		border-bottom: 1px solid #fafafa;
	}
	.clean_log_data .select-menu input:focus{
		outline:none;
	} 
	.clean_log_data .select-menu .down-select-full {
		display: inline-block;
		width: 0;
		height: 0;
		border-width: 5px;
		border-style: solid;
		border-color: #777 transparent transparent transparent;
		position: absolute;
		top: 14px;
		right: 5px;
	}
	.clean_log_data .select-menu .select-list-item{
		transition: all 500ms;
		display: none;
		box-shadow: 0 1px 5px rgba(0,0,0,.2);
	}
	.clean_log_data .select-menu .select-list-item ul{
		max-height: 180px;
		overflow: auto;
	}
	.clean_log_data .select-menu .select-list-item li {
		height: 28px;
		line-height: 28px;
		padding-left: 10px;
		cursor: pointer;
	}
	.clean_log_data .select-menu .select-list-item li:hover{
		background: #ebf1f5;
	}
	.clean_log_data .select-menu .only-one .select-list-item li.active{
		background-color: #ebf1f5;
	}
	.clean_log_data .select-menu .select-check-full {
		display: inline-block;
		height: 16px;
		width: 16px;
		border-radius: 1px;
		margin-right: 5px;
		cursor: pointer;
		border: 1px solid #c2c2c2;
		position: relative;
		text-align: center;
		line-height: 20px;
		transition: all 200ms;
		vertical-align: sub;
	}
	.clean_log_data .select-menu .select-list-item li.active .select-check-full {
		border: none;
		position: relative;
		top: 1px;
		display: inline-block;
		font-family: 'Glyphicons Halflings';
		font-style: normal;
		font-weight: 400;
		line-height: 1;
		-webkit-font-smoothing: antialiased;
		background: #5FB878;
		color: #fff;
	}
	.clean_log_data .select-menu .select-list-item li.active .select-check-full:after {
		content: "\e013";
		font-size: 12px;
		transform: scale(.85);
		position: absolute;
		left: 2px;
		top: 2px;
	}
	/* 多选、搜索下拉样式 end */
	.waf-line-box{
		height: 35px;
		position: relative;
		margin-bottom: 12px;
	}
	.waf-line-box .clear_log{
		position: absolute;
		right: 0;
	}
	.waf_form_width{
	    width: 140px;
	    display: inline-block;
        margin: 0 10px;
        color: #666;
        text-align: right;
        font-size: 13px;
	}
</style>
<div class="waf_conter">
	<ul class="waf_left_menu">
		<li class="active"><span>Home</span></li>
		<li><span>Global</span></li>
		<li><span>WebSite</span></li>
		<li><span>Webshell</span></li>
		<li><span>Blockade</span></li>
		<li><span>Logs</span></li>
<!--		<li><span><a href="/btwaf/index" class="btlink" target="_blank">New GUI</a></span></li>-->
	</ul>
	<div class="waf_rigth_body pd15">
		<div class="item_con active" data-type="home">
			<div class="waf_head_view">
			    <div>
    				<span class="pull-left" style="font-weight: 400;font-size: 16px;margin-right: 10px;line-height: 35px;">Firewall switch</span>
    				<div class="waf-switch pull-left" style="margin-top: 7px;">
                        <input class="btswitch btswitch-ios" id="waf_swicth_all" type="checkbox">
                        <label class="btswitch-btn" for="waf_swicth_all" onclick="bt_waf.waf_switch()"></label>
    				</div>
			    </div>
				<button class="btn btn-success waf_all_text pull-right">Simulated attack</button>
			</div>
			<div class="waf_totall_data row">
				<div class="col-sm-6 col-xs-6 item_mode waf_total grade_2">
					<div class="item_center">
						<div class="icon"><i class="iconfont iconlanjie"></i></div>
						<div class="tips">
							<span class="item_title">Total Blocked</span>
							<span class="item_data"><i>--</i><i> Times</i></span>
						</div>
					</div>
				</div>
				<div class="col-sm-6 col-xs-6 item_mode waf_safe_day grade_1">
					<div class="item_center">
						<div class="icon"><i class="iconfont iconanquan"></i></div>
						<div class="tips">
							<span class="item_title">Protected</span>
							<span class="item_data"><i>--</i><i> Days</i></span>
						</div>
					</div>
				</div>
			</div>
			<div class="waf_other_data row"></div>
			<ul class="waf_other_tips mt10">
				<li>Note: The firewall switch is the main switch, so the website will lose protection after it is closed, please operate with caution</li>
				<li>We try to provide refined filtering rules, but if there are false positives, please close the corresponding rules and go to <a class="btlink" href="https://forum.aapanel.com/d/3350-3350-summary-of-nginx-waf-false-positives-or-bug-submissions" target="_blank">Forum feedback</a></li>
				<li>If you find a bug or have any suggestions for the product during use, please go to <a class="btlink" href="https://forum.aapanel.com/d/3350-3350-summary-of-nginx-waf-false-positives-or-bug-submissions" target="_blank">Forum feedback</a></li>
			</ul>
		</div>
		<div class="item_con" data-type="overall">
			<div id="overall_table"></div>
			<div style="margin-top: 10px;height: 37px;">
				<button class="btn btn-default import_waf_config pull-right" style="margin-left:10px">Export</button>
				<button class="btn btn-default export_waf_config pull-right">Import</button>
			</div>
			<ul class="waf_tips_list mtl0 c7" style="font-size: 13px;padding-right: 40px;margin-top: 10px;">
				<li>Inheritance: Global settings will be automatically inherited as default values in the website configuration</li>
				<li>Priority: IP whitelist &gt; IP blacklist &gt; UA whitelist&gt; UA blacklist&gt; URL keyword blocking&gt; URL whitelist &gt; URL blacklist &gt;  Spider pond &gt; Prohibit regional ip access &gt; Non-browser&gt; User-Agent &gt;CC defense &gt; Cookie &gt; URI filtering &gt; URL parameters &gt; POST &gt; Custom defense</li>
			</ul>
		</div>
		<div class="item_con" data-type="site">
			<div class="waf-line-box"><button class="btn btn-success clear_log">Log cleanup</button></div>
			<div id="site_table"></div>
		</div>
		<div class="item_con" data-type="webshell">
			<div class="waf_nav_group">
				<span class="active">Scan</span>
				<span>Rules</span>
				<span>Logs</span>
			</div>
			<div class="waf_nav_content">
				<div class="active waf_nav_item" data-type="killing">
					<div class="waf_nav_header">
						<select class="bt-input-text mr5" style="width:120px" name="dir_path">
							<option value="0" selected="">WebSite Dir</option>
							<option value="1">Custom Dir</option>
						</select>
						<div class="input_list_one" style="display: inline-block;">
							<select class="bt-input-text mr5" style="width:180px" name="static_site_list"></select>
						</div>
						<div class="input_list_two" style="display: none;">
							<input type="text" class="bt-input-text mr5" id="san_path" style="width:250px">
							<span data-id="path" class="glyphicon cursor ml5 glyphicon-folder-open"></span>
						</div>
						<button class="btn btn-success va0" id="san_webshell_event">Scan</button>
					</div>
					<div class="waf_nav_body">
						<div id="scan_webshell_table"></div>
                    </div>
					<ul class="help-info-text c7">
                        <li style="color:red">The scanned content is a suspected Trojan horse file, the scanning method is based on the current rule base, and you can add scanning rules by yourself</li>
                        <li style="color:red">It is recommended to mix official detection and third-party detection. If one party is webshell, it is recommended to delete this file immediately</li>
                        <li style="color:red">Mark a file to exclude it</li>
                    </ul>
				</div>
				<div class="waf_nav_item" data-type="rule_list">
					<button class="btn btn-success add_webshell_rule" type="button" style="margin-bottom:12px;">Add rule</button>
					<div id="webshell_rule_table"></div>
				</div>
				<div class="waf_nav_item" data-type="logs">
					<textarea class="webshell_logs" readonly="readonly"></textarea>
				</div>
			</div>
        </div>
		<div class="item_con" data-type="history">
			<button class="btn btn-success uncover_all" type="button" style="margin:0 5px 12px 0;">Unblock all</button>
			<button class="btn btn-success a_key_block" type="button">OneKey Block</button>
			<button class="btn btn-success clear_log" style="float: right;">Log cleanup</button>
			<div id="history_table"></div>
			<button class="btn btn-success export_block_list" type="button">Export blocked IP</button>
			<div class="history_uncover_page waf_page"></div>
			<ul class="waf_tips_list mtl0 c7" style="font-size: 13px;padding-right: 40px;margin-top: 20px;">
				<li>OneClick Block: Add all IPs that are being blocked to the IP blacklist "If you need to query the IP blacklist, please open the IP blacklist in the global settings"</li>
			</ul>
		</div>
		<div class="item_con" data-type="logs">
			<div id="logs_table"></div>
		</div>
	</div>
</div>

<script type="text/javascript">
	var bt_waf = {
		plugin_name:'btwaf',
		total_all:{}, //统计数据
		overall_config:{}, //全局配置参数
		site_config:{}, //站点配置参数
		site_list:[],
		waf_table_list:[], //渲染表格专用列表
		ip_config_list:[],
		drop_abroad_list:[],
		ua_config_list:[],
		url_config_list:[],
		ban_word_list:[], //违禁词列表
		spider_data_list:[], //某个蜘蛛池列表
		batch_config_sitename:[],
		ajaxList:{
			'get_rule':'Getting a list of rules',
			'get_config':'Getting firewall global configuration',
			'get_total_all':'Getting firewall data',
			'get_url_find':'Getting URL keyword list',
			'get_ua_white':'Getting UA whitelist',
			'get_ua_black':'Getting UA blacklist',
			'get_url_white_chekc':'Getting API defense data',
			'get_zhizu_list2233':'Updating the spider pool from the cloud',
			'get_site_rule':'Getting site rules',
			'get_site_cdn_header':'Setting up website CDN-Header',
			'get_site_config_byname':'Getting website configuration',
			'get_site_disable_rule':'Getting site rules',
			'get_log':'Getting webshell logs',
			'get_logs_list':'Getting site log list',
			'get_webshell':'Getting webshell dynamic killing list',
			'get_golbls_cc':'Getting URL whitelist',
			'get_gl_logs':'Getting firewall block logs',
			'get_safe_logs':'Getting the list of firewall blocked IPs',
			'get_site_config':'Getting firewall site configuration list',
			'get_stop_ip':'Getting four layers of defense status',
			'get_log_send':'Getting intercept log list',
			'shell_get_rule':'Getting the list of webshell scan rules',
			'set_open': 'Getting firewall status',
			'start_cc_status': 'Turning on automatic mode',
			'stop_cc_status': 'Turning off automatic mode',
			'set_site_disable_rule': 'Setting website rule status',
			'set_site_obj_open': 'Setting WebSite status',
			'set_retry': 'Setting malicious attack tolerance',
			'set_site_retry': 'Setting malicious attack tolerance',
			'set_rule_state': 'Setting rule status',
			'set_cc_conf': 'Setting up CC configuration',
			'set_obj_status': 'Setting response code',
			'set_site_cc_conf': 'Setting up site CC configuration',
			'set_obj_open': 'Setting global configuration switch',
			'set_cc_automatic': 'Setting up automatic mode configuration',
			'set_stop_ip_stop': 'Stopping four layers of defense',
			'set_dingding': '设置钉钉推送',
			'set_mail_to': 'Setting up email notification',
			'set_stop_ip': 'Opening four layers of defense',
			'send_baota': 'The official rule base is being used to detect files',
			'add_url_white': 'Adding URL whitelist',
			'golbls_cc_zeng': 'Adding URL whitelist',
			'add_url_black': 'Adding URL blacklist',
			'add_site_rule': 'Adding site rules',
			'add_ip_black': 'Adding IP blacklist',
			'add_ip_white': 'Adding IP whitelist',
			'set_ipv6_back': 'Adding IP blacklist',
			'add_ua_white': 'Adding UA whitelist',
			'add_ua_black': 'Adding UA blacklist',
			'add_url_white_chekc': 'Adding API defense',
			'add_url_find': 'Adding URL keywords',
			'add_body_rule': 'Adding sensitive text replacement',
			'add_body_intercept':'Adding keywords',
			'add_body_site_rule': 'Adding sensitive text replacement',
			'add_site_cdn_header': 'Adding website CDN-Header',
			'add_cnip': 'Adding disabled IP',
			'add_rule': 'Adding rule',
			'add_method_type': 'Adding request type',
			'add_header_len': 'Adding header filtering',
			'add_spider':'Adding spider IP',
			'save_scan_rule': 'Saving scanner rules',
			'modify_rule': 'Saving rule',
			'return_site': 'Scanning website',
			'san_dir': 'Scanning webshell',
			'shell_add_rule': 'Adding webshell rules',
			'clean_waf_drop_ip': 'Unblocking all IP',
			'import_data': 'Importing data',
			'import_body_intercept':'Importing keywords',
			'export_body_intercept':'Exporting keywords',
			'lock_not_webshell': 'Setting file false positive',
			'upload_file_url':'Scanning files using third-party rule base',
			'wubao_url_white':'Adding URL whitelist',
			'sync_cnlist':'从云端更新国内IP库',
			'shell_del_rule':'Deleting webshell rules',
			'edit_header_len':'Modifying header filter',
			'remove_waf_drop_ip':'Unblocking IP',
			'remove_site_rule':'Deleting site rules',
			'remove_site_cdn_header':'Deleting website CDN-Header',
			'remove_url_white':'Deleting URL whitelist',
			'remove_url_black':'Deleting URL blacklist',
			'remove_ip_black':'Deleting IP blacklist',
			'remove_ip_white':'Deleting IP whitelist',
			'remove_cnip':'Deleting disabled IP',
			'remove_rule':'Deleting rule',
			'remove_log':'Cleaning log',
			'del_ua_black':'Deleting UA blacklist',
			'del_ua_white':'Deleting UA whitelist',
			'del_golbls_cc':'Deleting URL whitelist',
			'del_ipv6_back':'Deleting IP blacklist',
			'del_url_white_chekc':'Deleting API defense data',
			'del_body_rule':'Deleting sensitive text list',
			'del_body_site_rule':'Deleting sensitive text list',
			'del_url_find':'Deleting URL keyword list',
			'del_webshell_list':'Deleting dynamic scan list',
			'del_method_type':'Deleting request type',
			'del_header_len':'Deleting header filter',
			'del_body_intercept':'Deleting keywords',
			'empty_body_intercept':'Emptying prohibited words',
			'import_ip_data':'Exporting blocked IP list',
			'import_ip_black':'Importing IP blacklist',
			'import_spider':'Importing spider pool data',
			'test_waf':'Testing firewall',
			'import_sesings':'Importing firewall configuration'
		},
		overall_show_config:[
			{name:'CC defense',type:'cc',ps:'Defense against CC attacks.'},
			{name:'Request defense',type:'cc_tolerate',ps:'Malicious request blocking threshold.',status:'',open:''},
			{name:'IP whitelist',type:'ip_white',ps:'All rules are invalid for IP whitelist.',status:'',open:''},
			{name:'IP blacklist',type:'ip_black',ps:'Ban access to the IP of all websites.',status:'',open:''},
			{name:'URL whitelist',type:'url_white',ps:'Most rules are invalid for URL whitelist.',status:'',open:''},
			{name:'URL blacklist',type:'url_black',ps:'Prohibit access to the specified URL.',status:'',open:''},
            {name:'UA whitelist',type:'ua_white',ps:'User-Agent whitelist in the initialization phase.'},
            {name:'UA blacklist',type:'ua_black',ps:'User-Agent blacklist in the initialization phase.'},
			{name:'Spider pond',type:'spider',ps:'Get the spider pool list from the cloud.',status:'',open:''},
			{name:'Non-browser',type:'is_browser',ps:'Intercept non-browser requests, this switch will apply to all websites.',status:'',open:''},
			{name:'HTTP filter',type:'method_type',ps:'Request type filtering/request header filtering/semantic analysis.',status:'',open:''},
			{name:'GET-param filter',type:'get',ps:'SQL injection and xss attacks in filtering uri and uri parameters.'},
			{name:'GET-URL filter',type:'get',ps:'SQL injection and xss attacks in filtering uri and uri parameters.'},
			{name:'UA filter',type:'user-agent',ps:'Usually used to filter browsers, spiders and some automatic scanners.'},
			{name:'POST filter',type:'post',ps:'Filter common SQL injection and xss attacks in POST parameters.'},
			{name:'Cookie filter',type:'cookie',ps:'Filter penetration attacks initiated by cookies.'},
			{name:'Scanner',type:'scan',ps:'Filter penetration testing of common scan testing tools.'},
			// {name:'禁止海外访问',type:'drop_abroad',ps:'禁止中国大陆以外的地区访问站点.'},
			// {name:'禁止境内访问',type:'drop_china',ps:'禁止大陆地区访问.'},
			// {name:'Webshell scan',type:'webshell_open',ps:'Webshell dynamic scan switch.',status:'',open:''},
			{name:'From-data',type:'from_data',ps:'From-data protocol parameter transfer specification switch.',status:'',open:''},
			{name:'HTTP package',type:'http_open',ps:'Switch to block large traffic packets',status:'',open:''},
			// {name:'Sensitive text replacement',type:'sensitive_text',ps:'Replace set sensitive text.',status:'',open:''},
			{name:'Content replace',type:'sensitive_text',ps:'Replace set sensitive text',status:'',open:''},
			{name:'URL keyword',type:'key_words',ps:'Intercept Illegal word from URL.',status:'',open:''},
			{name:'Illegal word',type:'body_intercept',ps:'Block words or phrases in text.',status:'',open:''},
			{name:'API defense',type:'api_defense',ps:'API interface defense.',status:'',open:''}
		],
		site_show_config:[
			{name:'CC defense',type:'cc',ps:'Defense against CC attacks.'},
			{name:'Request defense',type:'cc_tolerate',ps:'Malicious request blocking threshold.'},
			{name:'GET-URL filter',type:'get'},
			{name:'GET-param filter',type:'get'},
			{name:'POST filter',type:'post'},
			{name:'User-Agent filter',type:'user-agent'},
			{name:'Cookie filter',type:'cookie'},
			// {name:'禁止海外访问',type:'drop_abroad'},
			// {name:'禁止境内访问',type:'drop_china'},
			{name:'Scanner',type:'scan'},
			{name:'CDN',type:'cdn',ps: "If the site uses CDN, the client IP can be obtained correctly after turn on"},
			{name:'Baidu CDN',type:'cdn_baidu',ps: "It needs to be turned on when the site uses Baidu CDN, other CDNs do not need to be turned on"},
			{name:'Block php exec',type:'disable_php_path',ps:"Prohibit running PHP scripts at the specified URL"},
			{name:'Forbidden URL',type:'disable_path',ps:"Prohibit access to the specified URL"},
			{name:'Forbidden extension',type:'disable_ext',ps:"Prohibit access to the specified extension"},
			{name:'Block File types',type:'disable_upload_ext',ps: "File types prohibited from uploading"},
			{name:'Protected URL',type:'url_tell',ps:"Encrypt the URL address with custom parameters, parameter errors will be intercepted"},
			{name:'URL filter',type:'url_rule',ps:"Set filtering rules for specific URL addresses"},
			{name:'Content replace',type:'sensitive_text',ps:'Replace set sensitive text',status:'',open:''},
			{name:'Anti-Leech',type:'preventing_hotlinking',ps:'Anti-Leech',status:'',open:''},
		],
		waf_cc_config_list:{
            '1':{title:'Basic mode',data:{
                cc_cycle: '60',
                cc_limit: '180',
                cc_endtime: '300',
                increase_wu_heng: '0',
                cc_four_defense: '0',
                cc_auto_mode: '0',
                cc_time: '0',
                cc_retry_cycle: '0',
                cc_enhance_mode: '0',
                cc_increase_type: 'js'
            }},
            '2':{title:'General mode',data:{
                cc_cycle: '60',
                cc_limit: '240',
                cc_endtime: '300',
                increase_wu_heng: '0',
                cc_four_defense: '0',
                cc_auto_mode: '0',
                cc_time: '0',
                cc_retry_cycle: '0',
                cc_enhance_mode: '0',
                cc_increase_type: 'js'
            }},
            '3':{title:'Auto mode',data:{
                cc_cycle: '60',
                cc_limit: '240',
                cc_endtime: '300',
                increase_wu_heng: '0',
                cc_four_defense: '0',
                cc_auto_mode: '1',
                cc_time: '60',
                cc_retry_cycle: '600',
                cc_enhance_mode: '0',
                cc_increase_type: 'js'
            }},
            '4':{title:'Enhanced mode',data:{
                cc_cycle: '60',
                cc_limit: '240',
                cc_endtime: '300',
                increase_wu_heng: '0',
                cc_four_defense: '0',
                cc_auto_mode: '0',
                cc_time: '0',
                cc_retry_cycle: '0',
                cc_enhance_mode: '1',
                cc_increase_type: 'js'
            }}
        },
		// 初始化
		init:function(){
			var that = this;
			setTimeout(function(){
				$('.layui-layer-page').width(970).css({
				    'height': '730px',
					'top':(document.body.clientHeight-690)/2+'px',
					'left':(document.body.clientWidth-970)/2+'px'
				})
				$('.waf_conter').css({
				    width: '100%',
				    height: ($('.layui-layer-page').height() - 42) + 'px'
				    
				})
				    // 
			},1);
			// 菜单跳转
			$('.waf_left_menu li').click(function(){
				var _index = $(this).index(), _type = $('.waf_rigth_body .item_con:eq('+ _index +')').attr('data-type');
				$(this).addClass('active').siblings().removeClass('active');
				$('.waf_rigth_body .item_con:eq('+ _index +')').addClass('active').siblings().removeClass('active');
				that.refresh_data_total(_type);
			});
			// webshell菜单
			$('.waf_nav_group span').click(function(){
				var _index = $(this).index(), _type = $('.waf_nav_content .waf_nav_item:eq('+ _index +')').attr('data-type');
				$(this).addClass('active').siblings().removeClass('active');
				$('.waf_nav_content .waf_nav_item:eq('+ _index +')').addClass('active').siblings().removeClass('active');
				that.refresh_data_webshell(_type);
			});
			// 扫描木马按钮
			$('#san_webshell_event').click(function(){
				var type = $('[name="dir_path"]').val(),path = '';
				if(type == "0"){
					path = $('[name="static_site_list"]').val();
				}else{
					path = $('#san_path').val();
					if(path == '')return layer.msg('The scan address cannot be empty!',{icon:2})
				}
				that.ajaxTask('san_dir',{path:path},function(res){
					that.render_san_webshell({data:res,path:path});
				});
			});
			// 【木马查杀】选择目录类型
			$('[name="dir_path"]').change(function() {
				if($(this).val() == '0'){
					$('.input_list_one').css('display','inline-block');
					$('.input_list_two').hide();
				}else{
					$('.input_list_two').css('display','inline-block');
					$('.input_list_one').hide();
				}
			});
			// 【木马查杀】文件图标按钮
			$('span[data-id="path"]').click(function(){
				bt.select_path('san_path');
			});
			// 单选框点击事件
			$('.item_con').on('click','.waf_unselect',function(){
				var _checked = $(this).find('input').prop('checked');
				if(_checked){
					$(this).find('.waf-icon').removeClass('waf-checked');
					$(this).find('input').prop('checked',false);
				}else{
					$(this).find('.waf-icon').addClass('waf-checked');
					$(this).find('input').prop('checked',true);
				}
			});
			// 模拟测试
			$('.waf_all_text').click(function(){
                    layer.open({
    					type: 1,
    					title: 'Simulated attack',
    					area: '600px',
    					closeBtn: 2,
    					content: '<div id="bt_waf_test_table" class="pd20 bt_table" style="padding-bottom:30px;">\
                        			<div class="divtable mtb10" style="max-height:300px">\
                        				<table class="table table-hover">\
                        					<thead>\
                        						<tr>\
                        							<th width="300px"><span data-index="1"><span>Simulated attack website list</span></span></th>\
                        							<th width="80px"><span data-index="2"><span>Protection result</span></span></th>\
                        							<th width="80px" style="text-align:right"><span data-index="3"><span>OPT</span></span></th>\
                        						</tr>\
                        					</thead>\
                        					<tbody id="waf_test_table_body"></tbody>\
                        				</table>\
                        			</div>\
                        		</div>\
                        		 <ul class="mtl0 c7" style="font-size: 13px;position:relative;bottom:20px;padding-right: 40px;">\
                        		    <li style="list-style:inside disc;margin-top:5px" style="">This simulated attack is: hackers perform SQL injection to obtain database permissions. It will not affect the normal operation of the business\
                        		    </li>\
                        		    <li style="list-style:inside disc;margin-top:5px">If your IP is in the IP whitelist, the test will have no effect\
                        		    </li>\
                        		    <li style="list-style:inside disc;margin-top:5px">If you need to test other websites, you can use [http://your_domain_name?id=etc/passwd] to check\
                        		    </li>\
                        		    <li style="list-style:inside disc;margin-top:5px">If the interception information is returned, the interception is successful. If it is found that it is not intercepted, it is recommended to update to the latest version\
                        		    </li>\
                        		    <li style="list-style:inside disc;margin-top:5px">If you have any questions, please go to the forum for feedback!\
                        		    </li>\
            	                </ul>',
    					success:function(index,layers){
    					    that.ajaxTask('return_is_site',function(res){
					            $.each(res,function(index,item){
						        $('#waf_test_table_body').append($('<tr>\
						                <td><a href="'+item+'" target="_blank" class="btlink local_attack">'+ (item.length >= 45?item.slice(0,45)+"...":item )+'</a></td>\
						                <td><span class="waf_unselect"><i class="waf-icon waf-icon-ok waf-checked"><span class="glyphicon glyphicon-ok" aria-hidden="true" title=""></span></i><input type="checkbox" checked="">&nbsp;&nbsp;Protecting</span></td>\
                                        <td style="text-align: right;">\
                                            <a href="'+item+'" target="_blank" class="btlink" >Attack</a>\
                                        </td>\
                                    </tr>'
                                    ).data({data:item,index:index}))
                                });
                                //绑定方法
                        //         $('.local_attack').on('click',function(e){
                        //             var _url = $(this).parents('tr').data().data;
                        //             layer.open({
                    				// 	type: 1,
                    				// 	title: false,
                    				// 	area: ['530px', '500px'],
                    				// 	closeBtn: 2,
                    				// 	content: url
                			    	// });
                        //         });
					        });
    				    },
    				    cancel: function(index, layero){
                            that.refresh_data_total('home');
                        }
    				});
            })

			// 导出防火墙配置
			$('.import_waf_config').click(function(){
				that.ajaxTask('bckup_sesings',function(res){
					 if(res.status) that.import_or_export_waf_config(true,res.msg)
				})
			})
			// 导入防火墙配置
			$('.export_waf_config').click(function(){
				that.import_or_export_waf_config()
			})
			// 【封锁历史】解封所有按钮
			$('.uncover_all').click(function(){
				layer.confirm('Are you sure you want to unblock all IPs from the firewall', { title: 'Unblock IP address',closeBtn:2,icon:0}, function () {
					that.ajaxTask('clean_waf_drop_ip',function(res){
						if(res.status) that.render_history_data();
						layer.msg(res.msg,{icon:res.status?1:2});
					});
				});
			});
			// 【封锁历史】一键拉黑
			$('.a_key_block').click(function(){
			    layer.confirm('Do you want to add all IPs in <span style="color:red">[Blocking]</span> to the blacklist', { title: 'OneKey Block',closeBtn:2,icon:0}, function () {
			        that.ajaxTask('import_ip_black',function(res){
			            layer.msg(res.msg,{icon:res.status?1:2})
			        })
			    })
			})
			// 【封锁历史】导出
			$('.export_block_list').click(function(){
			    that.export_block_view();
			})
			// 【日志清理】
			$('.clear_log').click(function(){
				var _type = $(this).parents('.item_con').attr('data-type');
				that.clean_site_or_history_log(_type);
			})
			this.refresh_data_total('home'); //初始化调用首页数据
		},
		/**
        	* @description 菜单显示页面
			* @param {String} type 显示的页面
        */
		refresh_data_total:function(type){
			var that = this;
			switch(type){
				case 'home': //首页
					this.ajaxTask('get_total_all',function(res){
						var rules = res.total.rules,_html = '';
						that.total_all = res;
						$('#waf_swicth_all').prop('checked',that.total_all.open)
						$('.waf_total').find('.item_data i:eq(0)').html(that.addThousands(that.total_all.total.total));
						$('.waf_safe_day').find('.item_data i:eq(0)').html(that.total_all.safe_day);
						for(var i= 0;i< rules.length;i++){
							_html += '<div class="item_conter col-sm-4 col-xs-4 '+ ( rules[i]['value'] > 0?'grade_1':(rules[i]['value'] > 100?'grade_2':'')) +'">\
								<div class="item_title">'+ rules[i]['name'] +'</div>\
								<div class="item_data">'+ that.addThousands(rules[i]['value']) +'</div>\
							</div>'
						}
						$('.waf_other_data').html(_html);
					});
					break;
				case 'overall': //全局
					this.ajaxTask('get_config',function(res){
						that.overall_config = res;
						for(var i=0;i<that.overall_show_config.length;i++){
							var _type = that.overall_config[that.overall_show_config[i]['type']];
                			if(that.overall_show_config[i]['ps'] === undefined) that.overall_show_config[i]['ps'] = (_type !== undefined?_type['ps']:'');
                			that.overall_show_config[i]['status'] = (_type != undefined?_type['status']:'');
                			that.overall_show_config[i]['open'] = (_type != undefined?_type['open']:'');
                		}
                		that.overall_show_config[1].status = that.overall_config.cc.status; //恶意容忍度
                		that.overall_show_config[9].open = that.overall_config.is_browser;  //非浏览器拦截
                		that.overall_show_config[10].status = '';            //HTTP请求类型过滤
                		that.overall_show_config[10].open = '';
                // 		that.overall_show_config[11].status = '';            //状态码过滤
                // 		that.overall_show_config[11].open = '';
                		that.overall_show_config[6].status = '';           //UA白名单
                		that.overall_show_config[6].open = '';
                        that.overall_show_config[7].status = '';           //UA黑名单
                		that.overall_show_config[7].open = '';
                		that.overall_show_config[3].status = that.overall_config.cc.status;;  //IP黑名单
                		that.overall_show_config[5].status = that.overall_config.get.status;   //URL黑名单
                // 		that.overall_show_config[20].status = that.overall_config.get.status;   //Webshell查杀
                // 		that.overall_show_config[20].open = that.overall_config.webshell_open;
                		//that.overall_show_config[17].status = '';                               //From-data协议
                		that.overall_show_config[17].open = that.overall_config.from_data;
                		that.overall_show_config[18].open = that.overall_config.http_open;      //HTTP包
                		that.overall_show_config[22].status = '';                               //URL关键词拦截
                		that.overall_show_config[22].open = '';
						that.refresh_table_view({
							el:'#overall_table',
							form_id:'overall_table', //用于重置
							height: '503px',
							config:[
								{fid:'name',title:'Name',width:'120px'},
								{fid:'ps',title:'Description'},
								{fid:'status',type:'link',title:'Resp',width:'20px',style:'text-align: center;',event:function(row,index,event){
									layer.open({
										type: 1,
										title: 'Set response code ['+ row.name +']',
										area: '350px',
										closeBtn: 2,
										btn:['Apply','Cancel'],
                						content:'<div class="waf-form pd20">\
											<div class="waf-line waf_one">\
												<span class="name-l">Response</span>\
												<div class="info-r">\
													<select id="statusCode" class="bt-input-text mr5" style="width: 175px;">\
													    <option value="200">(200)Normal</option>\
													    <option value="404">(404)File does not exist</option>\
													    <option value="403">(403)Access denied</option>\
													    <option value="444">(444)Close connection</option>\
													    <option value="500">(500)Application error</option>\
													    <option value="502">(502)Connection timed out</option>\
													    <option value="503">(503)Server unavailable</option>\
													</select>\
												</div>\
											</div>\
										</div>',
										success:function(index, layero){
											$('#statusCode').val(row.status);
										},
										yes:function(index,layero){
											var _type = row.type;
											if(_type == 'cc_tolerate') _type = 'cc';
											if(_type == 'ip_black') _type = 'cc';
											if(_type == 'url_black') _type = 'get';
											if(_type == 'webshell_open') _type = 'get';
											that.ajaxTask('set_obj_status',{ obj:_type,statusCode:$('#statusCode').val()},function(res){
												if(res.status){
													that.refresh_data_total('overall');
													layer.close(index);
												}
												layer.msg(res.msg,{icon:res.status?1:2});
											});
										}
									});
								}},
								{fid:'open',type:'btswitch',title:'Status',width:'60px',style:'text-align: center;',event:function(row,index,event){
									that.ajaxTask('set_obj_open',{obj:row.type},function(res){
										if(res.status) that.refresh_data_total('overall');
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'tools',title:'OPT',style:'text-align: right;',width:'90px',group:function(row,index){
									var _title = [],_arry = [];
									switch(row.type){
										case 'cc': //cc防御
										case 'cc_tolerate':
											_title =  ['Initial rule'];
											break;
										case 'get':
										case 'post':
										case 'user-agent':
                                		case 'cookie':
											_title =  ['Rule','Resp'];
											break;
										case 'spider':
										case 'drop_abroad':
											_title =  ['Conf','Sync'];
											break;
										case 'drop_china':
										    _title = ['Conf'];
										    break;
										case 'static_code_config':
										case 'method_type':
										case 'ua_white':
										case 'ua_black':
										case 'ip_white':
										case 'ip_black':
										case 'url_white':
										case 'scan':
										case 'sensitive_text':
										case 'body_intercept':
										case 'api_defense':
										case 'key_words':
											_title = ['Conf'];
											break;
										case 'url_black':
										    _title = ['Conf'];
										    break;
									}
									for(var j=0;j<_title.length;j++){
										_arry.push({
											title:_title[j],
											event:function(row,index){
												switch(row.type){
													case 'cc': //cc防御
														that.set_cc_rule_view({
                                                            cc_cycle: that.overall_config.cc.cycle,
                                                            cc_limit: that.overall_config.cc.limit,
                                                            cc_endtime: that.overall_config.cc.endtime,
                                                            increase_wu_heng: that.overall_config.increase_wu_heng,
                                                            increase: that.overall_config.cc.increase,
                                                            cc_increase_type: that.overall_config.cc.cc_increase_type,
                                                            mode:that.overall_config.cc_mode,
                                                            cc_type_status:that.overall_config.cc_type_status,
														});
													break;
													case 'static_code_config':
													    layer.msg('The function is temporarily removed from the shelves and will be opened after optimization!')
												// 		that.set_static_code_config();
														break;
													case 'method_type':
														that.set_http_rule_view();
														break;
													case 'get': //GET-URI过滤 或 GET-参数过滤
													case 'post': //POST过滤
													case 'user-agent': //User-Agent过滤
													case 'cookie':  //cookie
														if(j==1){
															that.set_other_rule_view(row);
														}else{
															OnlineEditFile(0,'/www/server/btwaf/html/'+ (row.type != 'user-agent'?row.type:'user_agent') +'.html');
														}
													break;
													case 'drop_abroad': //禁止海外访问
														if(j==1){
															that.set_ip_region_view(row.type);
														}else{
															that.ajaxTask('sync_cnlist',function(res){layer.msg(res.msg,{icon:res.status?1:2});})
														}
													break;
													case 'drop_china':
													    that.set_ip_region_view(row.type);
													break;
													case 'cc_tolerate': //恶意容忍度
														that.set_cc_tolerate_view({
															cycle: that.overall_config.retry_cycle,
															retry: that.overall_config.retry,
															time: that.overall_config.retry_time
														})
													break;
													case 'spider': //蜘蛛池
														if(j==1){
															that.get_spider_view();
														}else{
															that.ajaxTask('get_zhizu_list2233',function(res){layer.msg(res.msg,{icon:res.status?1:2});})
														}
													break;
                                                    case 'ua_white': //ua白名单
                                                    case 'ua_black': //ua黑名单
                                                        if(j==1){
															that.set_ua_white_view(row.type);
														}else{
															OnlineEditFile(0,'/www/server/btwaf/html/url.html');
														}
													break;
													case 'ip_white': //IP白名单
													case 'ip_black': //IP黑名单
														that.set_ip_region_view(row.type)
													break;
                                                    case 'url_black': //URL黑名单
															that.set_other_rule_one_view({type:row.type})
                                                    break;
													case 'url_white': //URL白名单
													case 'api_defense': //API接口防御
													case 'key_words': //URL关键词拦截
                                                        that.set_other_rule_one_view({type:row.type})
													break;
													case 'scan': //常见扫描器
														that.set_scan_rule_view();
													break;
													case 'sensitive_text': //敏感字替换
											        	// layer.msg('The function is temporarily removed from the shelves and will be opened after optimization!')
														that.set_sensitive_text_view(false);
													break;
													case 'body_intercept': //违禁词拦截
														that.set_body_intercept_view(row.type);
													break;
												}
											}
										})
									}
									return _arry
								}}
							],
							data:that.overall_show_config,
							done:function(){}
						})
					});
					break;
				case 'site': //站点
					this.ajaxTask('get_site_config',function(res){
						if(res.length >= 1){
							for(var i =0; i<res.length; i++){
								that.batch_config_sitename.push({siteName:res[i].siteName});
							}
						}
						that.refresh_table_view({
							el:'#site_table',
							form_id:'site_table', //用于重置
							height: 565,
							config:[
								{fid:'siteName',title:'WebSite',tips:true,type:'link',width:'120px',event:function(row,index){
									that.set_site_config_view({siteName:row.siteName});
								}},
								{fid:'get',title:'GET',type:'unselect',tips:function(row){return row.total[1].value},event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'get'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'post',title:'POST',type:'unselect',tips:function(row){return row.total[0].value},event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'post'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'user-agent',title:'UA',type:'unselect',tips:function(row){return row.total[3].value},event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'user-agent'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'cookie',title:'Cookie',type:'unselect',tips:function(row){return row.total[4].value},event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'cookie'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								// {fid:'drop_abroad',title:'禁国外',width:'60px',type:'unselect',event:function(row,index){
								// 	that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'drop_abroad'},function(res){
								// 		layer.msg(res.msg,{icon:res.status?1:2});
								// 	});
								// }},
								{fid:'cdn',title:'CDN',width:'40px',type:'unselect',event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'cdn'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'cc',is_contain:'open',title:'CC defense',type:'unselect',tips:function(row){return row.total[2].value},event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'cc'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'open',type:'btswitch',title:'Status',width:'50px',style:'text-align: center;', event:function(row,index,event){
									that.ajaxTask('set_site_obj_open',{siteName:row.siteName,obj:'open'},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}},
								{fid:'tools',title:'OPT',style:'text-align: right;',group:[{
									templet:function(row,index){
									     return 'Log '+(row.log_size > 0?'<i class="dot"></i>':'')
									},
									event:function(row,index){
										that.ajaxTask('get_logs_list',{siteName:row.siteName},function(res){
											if(res.length >0){
												that.get_site_logs_view(row,res);
											}else{
												layer.msg('No log',{icon:6});
											}
										});
									}
								},{
									title:'Conf',
									event:function(row,index){
										that.set_site_config_view({siteName:row.siteName});
									}
								}]}
							],
							data:res,
							done:function(res){
								// 隐藏选框经过时提示title
								$('#site_table .waf_table tbody tr td:nth-of-type(n+2) span:first-child').attr('title','');
								//提取所有站点名称
								if(res.length > 0){
								    $.each(res,function(index,item){
								        that.site_list.push(item.siteName)
								    })
								}
							}
						})
					});
					break;
				case 'webshell':
					this.render_san_webshell({data:[]});
					//获取可查杀的站点
					this.ajaxTask('return_site',function(res){
						var _option = '',rdata = res.msg;
						for (var i in rdata) {
							_option += '<option value="' + rdata[i] + '">' + i + '</option>'
						}
						$('[name="static_site_list"]').html(_option);
					});
					// 规则列表>>>添加webshell规则
					$('.add_webshell_rule').click(function() {
						layer.open({
							type: 1,
							title: 'Add Rule',
							area: ['340px', '215px'],
							closeBtn: 2,
							shadeClose: false,
							btn:['Confirm','Cancel'],
							content: '<div class="waf-form">\
									<div class="waf-line">\
										<span class="name-l" style="width:30px">Rule</span>\
										<div class="info-r">\
											<textarea name="webshell_rule" style="border:1px solid #ccc;border-radius:2px;width:220px;line-height: 15px;height: 75px;"></textarea>\
										</div>\
									</div>\
								</div>',
							yes:function(index,layers){
								var _rule = $('[name="webshell_rule"]').val();
								if (_rule == '') return layer.msg('The rule cannot be empty!', {icon: 2})
								that.ajaxTask('shell_add_rule',{rule:_rule},function(res){
									if(res.status){
										layer.close(index);
										that.refresh_data_webshell('rule_list');
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						});
					});
					break;
                case 'history': //封锁历史
					this.render_history_data();
					break;
				case 'logs': //操作日志
					this.get_gl_table_page();
					break;
			}
		},
		/**
        	* @description 渲染规则列表
			* @param {Object} obj 数据类型
			* @renturn 回调数据
        */
		render_other_conf:function(obj,callback){
			var that = this;
			this.ajaxTask('get_rule',{ruleName: obj.ruleName},function(res){
				that.refresh_table_view({
					el:'#other_conf_table',
					form_id:'other_conf_table', //用于重置
					height:340,
					config:[
						{fid:'1',title:'Rule',templet:function(row,index){
							return '<div class="" style="width:450px;word-break:break-all;line-height: 20px;">'+ row[1] +'</div>'
						}},
						{fid:'2',title:'Description',width:'150px'},
						{fid:'0',title:'Status',type:'btswitch',width:'50px',style:'text-align: center;',
							event:function(row,index,event){
								that.ajaxTask('set_rule_state',{index:index,ruleName:obj.ruleName},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
						}},
						{fid:'tools',title:'OPT',width:'100px',style:'text-align: right;',group:function(row,index){
							var _arry = [{
								title:'Edit',
								event:function(row,index,event,el){
									var _tr = $(el).parent().parent().parent();
									$(_tr).find('td:eq('+0+')').html('<textarea class="waf-input waf-table-textarea waf-rule-val" style="width:440px;">'+ row[1] +'</textarea>');
									$(_tr).find('td:eq('+1+')').html('<input type="text" class="waf-input waf-rule-ps" value="'+ row[2] +'" style="width:110px"/>');
									$(_tr).find('td:eq('+2+')').html('');
									$(_tr).find('td:eq('+3+')').html('<span><a class="btlink save_table_data" href="javascript:;">Save</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class="btlink clear_table_data" href="javascript:;">Cancel</a></span>');
									$('.save_table_data').click(function(e) {
										that.ajaxTask('modify_rule',{
											index:index,
											ruleBody:$('.waf-rule-val').val(),
											rulePs:$('.waf-rule-ps').val(),
											ruleName:obj.ruleName
										},function(res) {
											if(res.status) that.render_other_conf({ruleName:obj.ruleName});
											layer.msg(res.msg,{icon:res.status?1:2});
										});
									});
									$('.clear_table_data').click(function(e) {
										that.waf_table_list.other_conf_table.reset();
									});
								}}];
								if(row[3]){ _arry.push({
									title:'Del',
									event:function(row,index){
										bt.confirm({title:'Delete Rule',msg:'Do you really want to delete this filter rule?',icon:3,closeBtn:2},function(){
											that.ajaxTask('remove_rule',{ruleName:obj.ruleName,index:index},function(res){
												if(res.status) that.render_other_conf({ruleName:obj.ruleName});
												layer.msg(res.msg,{icon:res.status?1:2});
											})
										});
									}});
								}
							return _arry;
						}},
					],
					data:res,
					done:function(res){}
				});
			});
		},
		/**
        	* @description 渲染海外禁用IP地址列表
			* @renturn 回调数据
        */
		render_drop_abroad:function(callback){
			var that = this;
			this.ajaxTask('get_rule',{ruleName:'cn'},function(res){
				that.drop_abroad_list = res;
				that.refresh_table_view({
					el:'#ip_region_table',
					form_id:'ip_region_table', //用于重置
					height:305,
					config:[
						{fid:'0',title:'Begin IP',templet:function(row,index){return row[0]}},
						{fid:'1',title:'End IP',templet:function(row,index){return row[1]}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_cnip',{index:index},function(res){
									if(res.status) that.render_drop_abroad();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){}
				});
			});
		},
		/**
			* @description 渲染ip白名单
			* @renturn 回调数据
        */
		render_ip_white:function(callback){
			var that = this;
			this.ajaxTask('get_rule',{ruleName:'ip_white'},function(res){
				that.ip_config_list = res;
				that.refresh_table_view({
					el:'#ip_region_table',
					form_id:'ip_region_table', //用于重置
					height:305,
					config:[
						{fid:'0',title:'Begin IP',templet:function(row,index){return row[0]}},
						{fid:'1',title:'End IP',templet:function(row,index){return row[1]}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_ip_white',{index:index},function(res){
									if(res.status) that.render_ip_white();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){ if(callback) callback(res)}
				});
			});
		},
		/**
			* @description 渲染ip黑名单
			* @param {Number} obj [0]ipv4，[1]ipv6
			* @renturn 回调数据
        */
		render_ip_black:function(obj,callback){
			var that = this;
            if(obj === 0){
				this.ajaxTask('get_rule',{ruleName:'ip_black'},function(res){
                    that.ip_config_list = res;
                    that.refresh_table_view({
                        el:'#ipv4_region_table',
                        form_id:'ipv4_region_table', //用于重置
                        height:285,
                        config:[
                            {fid:'0',title:'Begin IP',templet:function(row,index){return row[0]}},
                            {fid:'1',title:'End IP',templet:function(row,index){return row[1]}},
                            {title:'OPT',width:'50px',style:'text-align: right;',group:[{
                                title:'Del',
                                event:function(row,index){
									that.ajaxTask('remove_ip_black',{index:index},function(res){
                                        if(res.status) that.render_ip_black(0);
										layer.msg(res.msg,{icon:res.status?1:2});
                                    });
                                }
                            }]}
                        ],
                        data:res,
                        done:function(res){if(callback) callback(res)}
                    });
                });
            }else{
				var loadT = layer.msg('Getting IPV6 list, please wait...', { icon: 16, time: 0, shade: [0.3, '#000'] });
                $.post('/plugin?action=a&name=btwaf&s=get_ipv6_address', function (res) {
					layer.close(loadT)
                    var rdata = res.msg
                    that.refresh_table_view({
                        el:'#ipv6_region_table',
                        form_id:'ipv6_region_table', //用于重置
                        height:305,
                        config:[
                            {title:'IPv6 address',templet:function(row,index){
                                return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>';
                            }},
                            {title:'OPT',width:'50px',style:'text-align: right;',group:[{
                                title:'Del',
                                event:function(row,index){
									that.ajaxTask('del_ipv6_back',{addr:row},function(res){
                                        if(res.status) that.render_ip_black(1);
										layer.msg(res.msg,{icon:res.status?1:2});
                                    });
                                }
                            }]}
                        ],
                        data:rdata,
                        done:function(rdata){if(callback) callback(rdata)}
                    });
                });
            }
		},
		/**
        	* @description 渲染ua白名单
            * @renturn 回调数据
        */
        render_ua_white:function(callback){
			var that = this;
			this.ajaxTask('get_ua_white',function(res){
			    that.ua_config_list = res.msg
                that.refresh_table_view({
                    el: "#ua_name_table",
                    form_id: 'ua_name_table',
                    height:305,
                    config:[
                        {title:'URL',templet:function(row,index){
                            return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>'
                        }},
                        {title:'OPT',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('del_ua_white',{ua_white:row},function(res){
									if(res.status) that.render_ua_white();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
                    ],
                    data:res.msg,
					done:function(rdata){if(callback) callback(rdata)}
                })
            })
        },
		/**
        	* @description 渲染ua黑名单
            * @renturn 回调数据
        */
        render_ua_black:function(callback){
			var that = this;
			this.ajaxTask('get_ua_black',function(res){
			    that.ua_config_list = res.msg
                that.refresh_table_view({
                    el: "#ua_name_table",
                    form_id: 'ua_name_table',
                    height:305,
                    config:[
                        {title:'URL',templet:function(row,index){
                            return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>'
                        }},
                        {title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('del_ua_black',{ua_black:row},function(res){
									if(res.status) that.render_ua_black();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
                    ],
                    data:res.msg,
					done:function(rdata){if(callback) callback(rdata)}
                })
            })
        },
		/**
        	* @description 渲染禁止上传、执行PHP的URL表格、访问的URL表格、扩展名表格
			* @param {Object} obj 网站名称，数据类型
			* @renturn 回调数据
        */
		render_disable_other:function(obj,callback){
			var that = this;
			this.ajaxTask('get_site_rule',{siteName:obj.siteName,ruleName:obj.ruleName},function(res){
				that.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table',
					height:380,
					config:[
						{title:'Rule',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>';
						}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_site_rule',{siteName:obj.siteName,index:index,ruleName:obj.ruleName},function(res){
									if(res.status) that.render_disable_other(obj)
									layer.msg(res.msg,{icon:res.status?1:2});
								})
							}
						}]}
					],
					data:res,
					done:function(res){if(callback) callback(res)}
				});
			});
		},
		/**
        	* @description 渲染Api接口防御、关键词拦截列表
            * @param {String} obj Api接口防御、关键词拦截
        */
		render_apiDefense_or_wordsKey:function(obj){
			var that = this;
			this.ajaxTask( obj.type == 'api_defense'?'get_url_white_chekc':'get_url_find',function(res){
                that.ua_config_list = res.msg
                that.refresh_table_view({
                    el:'#other_rule_table',
                    form_id:'other_rule_table', //用于重置
                    height:385,
                    config:[
                        {title:'URL',templet:function(row,index){return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>';}},
                        {title:'OPT',width:'50px',style:'text-align: right;',group:[{
                            title:'Del',
                            event:function(row,index){
								that.ajaxTask(obj.type == 'api_defense'?'del_url_white_chekc':'del_url_find',{url_find:row},function(res){
                                    if(res.status) that.render_apiDefense_or_wordsKey({type:obj.type})
									layer.msg(res.msg,{icon:res.status?1:2});
                                });
                            }
                        }]}
                    ],
                    data:res.msg,
                    done:function(rdata){}
                });
            });
		},
		/**
        	* @description 渲染url白名单
            * @param {Number} obj [0]标准模式，[1]增强模式
        */
		render_url_white:function(obj,callback){
			var that = this;
			if(obj === 0){
				this.ajaxTask('get_rule',{ruleName:'url_white'},function(res){
					that.url_config_list = res;
					that.refresh_table_view({ 
						el:'#white_rule_table', 
						form_id:'white_rule_table', 
						height:340,
						config:[
							{title:'URL',templet:function(row,index){
								return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>'
							}},
							{title:'OPT',width:'50px',style:'text-align: right;',group:[{
								title:'Del',
								event:function(row,index){
									that.ajaxTask('remove_url_white',{index:index},function(res){
										if(res.status) that.render_url_white(0);
										layer.msg(res.msg,{icon:res.status?1:2});
									})
								}
							}]}
						],
						data:res,
						done:function(res){if(callback) callback(res);}
					});
				})
			}else{
				this.ajaxTask('get_golbls_cc',function(res){
					var rdata = res.msg
					that.refresh_table_view({
						el:'#white_rule_strong_table',
						form_id:'white_rule_strong_table',
						height:375,
						config:[
							{title:'URL',templet:function(row,index){
								return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>'
							}},
							{title:'OPT',width:'50px',style:'text-align: right;',group:[{
								title:'Del',
								event:function(row,index){
									that.ajaxTask('del_golbls_cc',{text:row},function(res){
										if(res.status) that.render_url_white(1);
										layer.msg(res.msg,{icon:res.status?1:2});
									})
								}
							}]}
						],
						data:rdata,
						done:function(rdata){if(callback) callback(rdata);}
					});
				})
			}
		},
		/**
        	* @description 渲染URL黑名单
        */
		render_url_black:function(callback){
			var that = this;
			this.ajaxTask('get_rule',{ruleName:'url_black'},function(res){
				that.url_config_list = res;
				that.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table', 
					height:300,
					config:[
						{title:'URL',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>'
						}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_url_black',{index:index},function(res){
									if(res.status) that.render_url_black();
									layer.msg(res.msg,{icon:res.status?1:2});
								})
							}
						}]}
					],
					data:res,
					done:function(res){if(callback) callback(res);}
				});
			});
		},
		/**
        	* @description 渲染敏感字体替换表格
            * @param {Object} obj 是否为站点，站点名称
        */
        render_sansitive_table:function(obj,callback){
            var that = this;
			var sDdata = obj.site ?that.site_config.body_character_string : that.overall_config.body_character_string;
            that.refresh_table_view({
                el:'#sensitive_text_table',
                form_id:'sensitive_text_table', //用于重置
                height:205,
                config:[
                    {title:'Sensitive text',templet:function(row,index){
                        for(var item in row){return '<span class="overflow_hide" style="width: 210px;" title="'+item+'">'+item+'</span>'}
                    }},
                    {title:'Alternate text',templet:function(row,index){for(var ex in row){return '<span class="overflow_hide" style="width: 210px;" title="'+row[ex]+'">'+row[ex]+'</span>'}}},
                    {title:'OPT',width:'50px',style:'text-align: right;',group:[{
                        title:'Del',
                        event:function(row,index){
                            that.ajaxTask(obj.site ?'del_body_site_rule':'del_body_rule',{siteName:obj.site,body:JSON.stringify(row)},function(res){
								if(res.status){
									if(obj.site){
										$.post('/plugin?action=a&name=btwaf&s=get_site_config_byname',{siteName:obj.site},function(rdata){
											that.site_config = rdata;
										})
	                                }else{
										$.post('/plugin?action=a&name=btwaf&s=get_config',function(rdata){
											that.overall_config = rdata;
	                                	})
	                                }
	                                setTimeout(function(){
										that.render_sansitive_table({site:obj.site});
									}, 500);
	                            }
								layer.msg(res.msg,{icon:res.status?1:2});
							})
                        }
                    }]}
                ],
                data:sDdata,
                done:function(sDdata){if(callback) callback(sDdata)}
            });
        },
		/**
			* @description 渲染违禁词表格
		*/
		render_body_intercept_table:function(callback){
			var that = this;
		    this.ajaxTask('get_config',function(res){
    		    var bWdata = res.body_intercept;
    		    that.ban_word_list = bWdata;
    			that.refresh_table_view({
    				el:'#body_intercept_table',
    				form_id:'body_intercept_table', //用于重置
    				height:205,
    				config:[
    					{title:'Illegal word',templet:function(row,index){return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>'}},
    					{title:'OPT',width:'50px',style:'text-align: right;',group:[{
    						title:'Del',
    						event:function(row,index){								
    							that.ajaxTask('del_body_intercept',{text:row},function(res){
    								if(res.status) that.render_body_intercept_table();
    								layer.msg(res.msg,{icon:res.status?1:2});
    							})							    
    						}
    					}]}
    				],
    				data:bWdata,
    				done:function(bWdata){if(callback) callback(bWdata)}
    			});
		    });
		},
		/**
        	* @description 渲染CDN表格
            * @param {Object} obj 站点名称
        */
		render_cdn_table:function(obj,callback){
			var that = this;
			this.ajaxTask('get_site_cdn_header',{siteName:obj.siteName},function(res){
				that.refresh_table_view({
					el:'#other_rule_table',
					form_id:'other_rule_table',
					height:405,
					config:[
						{title:'header',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 410px;" title="'+row+'">'+row+'</span>';
						}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_site_cdn_header',{siteName:obj.siteName,cdn_header:row},function(res){
									that.render_cdn_table(obj);
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){if(callback) callback(res);}
				});
			});
		},
		/**
        	* @description 渲染站点配置
            * @param {Object} obj 站点名称
        */
		render_site_config:function(obj,callback){
			var that = this;
			this.ajaxTask('get_site_config_byname',{siteName:obj.siteName},function(res){
				that.site_config = res;
				for(var i=0;i<that.site_show_config.length;i++){
                    var _type = res[that.site_show_config[i]['type']];
                    if(that.site_show_config[i]['ps'] === undefined) that.site_show_config[i]['ps'] = (res['top'][that.site_show_config[i]['type']]['ps'] !== undefined?res['top'][that.site_show_config[i]['type']]['ps']:'');
                    that.site_show_config[i]['open'] = ( ((typeof _type == 'boolean')?_type:(_type!=undefined ?_type['open']:'')));
                }
				that.site_show_config[0].ps = '<font style="color:red;">Request the same URI more than '+ res.cc.limit +'</font> times in <font style="color:red;">'+ res.cc.cycle +'</font> second,Block IP for <font style="color:red;">'+ res.cc.endtime +'</font> second'
				that.site_show_config[1].open = ''
				that.site_show_config[9].open = that.site_config.cdn_baidu
				that.site_show_config[10].open = that.site_config.cdn
				// that.site_show_config[11].open = that.site_config.cdn_baidu
				that.site_show_config[12].open = ''
				that.site_show_config[13].open = ''
				that.site_show_config[14].open = ''
				that.site_show_config[15].open = ''
				that.site_show_config[16].open = ''
				console.log(that.site_show_config[9])
				that.refresh_table_view({
					el:'#site_config_table',
					form_id:'site_config_table', //用于重置
					height: 440,
					config:[
						{fid:'name',title:'Name'},
						{fid:'ps',title:'Description'},
						{fid:'open',type:'btswitch',title:'Status',style:'text-align: center;',event:function(row,index){
							that.ajaxTask('set_site_obj_open',{siteName:obj.siteName,obj:row.type},function(res){
								if(res.status) {
									that.refresh_data_total('site');
									that.render_site_config({siteName:obj.siteName});
								}
								layer.msg(res.msg,{icon:res.status?1:2});
							});
						}},
						{fid:'tools',title:'OPT',style:'text-align: right;',width:'45px',group:function(row,index){
							return [{
								title:(row.type == 'get' || row.type == 'post' || row.type == 'user-agent')?'Rule':(row.type == 'cdn_baidu'?' ':'Set'),
								event:function(row,index){
									switch(row.type){
										case 'cc':  //CC防御
											that.set_cc_rule_view({
												cc_cycle:res.cc.cycle,
												cc_endtime:res.cc.endtime,
												cc_limit:res.cc.limit,
												siteName:obj.siteName,
												increase_wu_heng: res.increase_wu_heng,
												increase: res.cc.increase,
												cc_increase_type: res.cc.cc_increase_type,
												cc_retry_cycle: res.cc_retry_cycle,
												cc_time:res.cc_time,
												mode:res.cc_mode,
											    cc_type_status:res.cc_type_status,
											});
											break;
										case 'cc_tolerate':   //恶意容忍度
											that.set_cc_tolerate_view({cycle: res.retry_cycle,retry: res.retry,time: res.retry_time,siteName:obj.siteName})
											break;
										case 'get':    //GET-URL过滤
										case 'post':   //POST过滤
										case 'user-agent':   //User-Agent过滤
										case 'cookie':   //Cookie过滤
											var _rule = row.type;
											if(row.name === 'GET-URL filter') _rule = 'url';
											if(row.name === 'GET-param filter') _rule = 'args';
											if(row.type === 'user-agent') _rule = 'user_agent';
											if(row.type === 'cookie') _rule = 'cookie';
											that.set_site_rule_view({siteName:obj.siteName,name:row.name,ruleName:_rule});
											break;
										case 'drop_abroad':   //禁止海外访问
										case 'drop_china':
											that.set_ip_region_view(row.type,false);
											break;
										case 'scan':    //常见扫描器
											that.set_scan_rule_view();
											break;
										case 'cdn':    //使用CDN
										case 'disable_php_path':    //禁止执行PHP的URL
										case 'disable_path':        //禁止访问的URL
										case 'disable_ext':         //禁止扩展名
										case 'disable_upload_ext':  //禁止上传的文件类型
											that.set_other_rule_one_view({type:row.type,siteName:obj.siteName})
											break;
										case 'url_tell':          //受保护的URL
											that.set_defend_url_view({siteName:obj.siteName})
											break;
										case 'url_rule':    //URL专用过滤
											that.set_url_special_filter_view({siteName:obj.siteName})
											break;
										case 'sensitive_text':      //敏感文字替换
											that.set_sensitive_text_view(true,obj.siteName);
											break;
										case 'body_intercept':      //违禁词拦截
											that.set_body_intercept_view({siteName:obj.siteName})
											break;
										case 'preventing_hotlinking':
											that.set_hotlinking_view({siteName:obj.siteName,id:res.site_id});
											break;
									}
								}
							}]
						}},
					],
					data:that.site_show_config,
					done:function(){if(callback) callback(res)}
				});
			});
		},
		/**
        	* @description 渲染受保护url地址
            * @param {Object} obj 站点名称,规则名称
        */
		render_defend_url_table:function(obj,callback){
			var that = this;
			that.ajaxTask('get_site_rule',{siteName:obj.siteName,ruleName:'url_tell'},function(res){
				that.refresh_table_view({
					el:'#defend_url_table',
					form_id:'defend_url_table', //用于重置
					height:350,
					config:[
						{title:'URL address',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 210px;" title="'+row[0]+'">'+row[0]+'</span>'
						}},
						{title:'Parameter name',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 100px;" title="'+row[1]+'">'+row[1]+'</span>'
						}},
						{title:'Parameter value',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 100px;" title="'+row[2]+'">'+row[2]+'</span>'
						}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_site_rule',{siteName:obj.siteName,index:index,ruleName:obj.ruleName},function(res){
									if(res.status) that.render_defend_url_table(obj);
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){if(callback) callback(res)}
				});
			});
		},
		/**
        	* @description 渲染url专用过滤表格
            * @param {Object} obj 站点名称,规则名称
        */
		render_url_filter_table:function(obj,callback){
			var that = this;
			that.ajaxTask('get_site_rule',{siteName:obj.siteName,ruleName:'url_rule'},function(res){
				that.refresh_table_view({
					el:'#url_special_filter_table',
					form_id:'url_special_filter_table', //用于重置
					height:305,
					config:[
						{title:'URL address',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 210px;" title="'+row[0]+'">'+row[0]+'</span>'
						}},
						{title:'Filter rule',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 210px;" title="'+row[1]+'">'+row[1]+'</span>'
						}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('remove_site_rule',{siteName:obj.siteName,index:index,ruleName:obj.ruleName},function(res){
									if(res.status) that.render_url_filter_table(obj);
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:res,
					done:function(res){if(callback) callback(res)}
				});
			});
		},
		/**
        	* @description 渲染站点规则
            * @param {Object} obj 站点名称,规则名称
        */
		render_site_rule:function(obj,callback){
			var that = this;
			that.ajaxTask('get_site_disable_rule',{siteName:obj.siteName,ruleName:obj.ruleName},function(res){
				that.refresh_table_view({
					el:'#site_rule_table',
					form_id:'site_rule_table', //用于重置
					height:425,
					config:[
						{fid:'1',title:'Rule',templet:function(row,index){
							return '<div class="" style="width:450px;word-break:break-all;line-height: 20px;">'+ row[1] +'</div>'
						}},
						{fid:'2',title:'Description',width:'150px'},
						{fid:'0',title:'Status',type:'btswitch',width:'50px',style:'text-align: center;',
							event:function(row,index,event){
								that.ajaxTask('set_site_disable_rule',{index:index,ruleName:obj.ruleName,siteName:obj.siteName},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
						}}
					],
					data:res,
					done:function(res){if(callback) callback(res)}
				});
			});
		},
		/**
        	* @description 渲染站点日志
            * @param {Object} obj 站点名称,记录的日期，页数
        */
		render_site_logs:function(obj,callback){
			var that = this;
			this.ajaxTask('get_safe_logs',{siteName:obj.siteName,toDate:obj.toDate,p:obj.p},function(res){
				that.refresh_table_view({
					el:'#site_logs_table',
					form_id:'site_logs_table', //用于重置
					config:[
						{fid:'0',width:'155px',title:'Time'},
						{fid:'1',title:'User IP',tips:true,width:'120px',type:'link',event:function(row,index){
							layer.confirm('Do you want to add <span style="color:red">' + row[1] + '</span> to the IP blacklist?', { title: 'Add to IP blacklist', closeBtn: 2,icon:0}, function () {
								if(bt.check_ip(row[1])){
									that.ajaxTask('add_ip_black',{start_ip:row[1],end_ip:row[1]},function(res){
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								}else{
									that.ajaxTask('set_ipv6_back',{addr:row[1]},function(res){layer.msg(res.msg,{icon:res.status?1:2})});
								}
							});
						}},
						{fid:'2',title:'Type'},
						{fid:'3',title:'URL address',templet:function(row,index){return '<span title="'+that.escapeHTML(row[3])+'">'+that.escapeHTML(row[3])+'</span>'}},
						{title:'Status',templet:function(row,index){return 'Blocked';}},
						{fid:'5',title:'Filter',tips:true,width:'120px',templet:function(row){
						    return typeof row[8] != 'undefined'? '<span title="'+that.escapeHTML(row[8])+'">'+that.escapeHTML(row[8])+'</span>':'<span title="'+that.escapeHTML(row[5])+'">'+that.escapeHTML(row[5])+'</span>'
						}},
						{fid:'tools',title:'OPT',width:'155px',style:'text-align: right;',group:[{
							title:'Whiten',
							event:function(row,index){
								layer.confirm('Do you want to add this action to the whitelist?', { title: 'Whiten', closeBtn: 2, icon: 3 }, function () {
									var rule_arry = row[6].split(" &gt;&gt; ");
									that.ajaxTask('wubao_url_white',{url_rule:row[3]},function(res){
										layer.msg(res.msg, {icon:res.status?1:2});
										if (rule_arry[1] != undefined) { $.get('https://www.bt.cn/Api/add_waf_logs?data=' + rule_arry[1], function (rdata) { }, 'jsonp') }
									});
								});
							}
						},{
							title:'Detail',
							event:function(row,index){
								var filter_rule = '',rule_arry = row[6].split(" >> "),incoming_value = '', risk_value = '';
								if (rule_arry.length == 0) filter_rule = rule_arry[0]
								incoming_value = rule_arry[1] == undefined ? 'Empty' : rule_arry[1];
								risk_value = rule_arry[2]
								risk_value = risk_value ? risk_value : 'Empty';
								function is_btfile(row){
								    alert(row[8])
								    if(row[8]){
								        return row[8];
								    }else{
								        return row[5];
								    };
								}
								layer.open({
									type: 1,
									title: "["+ row[0] + "] Detail",
									area: '600px',
									closeBtn: 2,
									shadeClose: false,
									content: '<div class="pd15 lib-box">\
											<table class="table" style="border:#ddd 1px solid; margin-bottom:10px">\
											<tbody><tr><th>Time</th><td>'+ that.escapeHTML(row[0]) + '</td><th>User IP</th><td><a class="btlink add_log_ip_black"  title="Add to blacklist">' + that.escapeHTML(row[1]) + '</a></td></tr><tr><th>Type</th><td>' + that.escapeHTML(row[2]) + '</td><th>Filter</th><td>' + that.escapeHTML(typeof row[8] != 'undefined'?row[8]:row[5]) + '</td></tr></tbody></table>\
											<div><b style="margin-left:10px">URI</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(row[3]) + '</div></div>\
											<div><b style="margin-left:10px">User-Agent</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(row[4]) + '</div></div>\
											<div><b style="margin-left:10px">Filter</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(rule_arry[0]) + '</div></div>\
											<div><b style="margin-left:10px">Incoming value</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(incoming_value) + '</div></div>\
											<div><b style="margin-left:10px">Value at risk</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(risk_value) + '</div></div>\
										</div>',
									success:function(){
										$('.add_log_ip_black').click(function(){
											layer.confirm('Do you want to add <span style="color:red">' + row[1] + '</span> to the IP blacklist?', { title: 'Add to IP blacklist', closeBtn: 2 }, function () {
												if(bt.check_ip(row[1])){
													that.ajaxTask('add_ip_black',{start_ip:row[1],end_ip:row[1]},function(res){
														layer.msg(res.msg,{icon:res.status?1:2});
													});
												}else{
													that.ajaxTask('set_ipv6_back',{addr:row[1]},function(res){
														layer.msg(res.msg,{icon:res.status?1:2});
													});
												}
											});
										});
									}
								})
							}
						},{
						    title:'HTTP',
						    event:function(row,index){
						        var _http_info = row[7];
						        if(_http_info){
						            layer.open({
						                type: 1,
    									title: "["+ row[0] + "] HTTP detail",
    									area: ['800px','500px'],
    									closeBtn: 1,
    									shadeClose: false,
    									maxmin: true,
    									content: '<div class="pd15 lib-box" style="height:100%">\
    											<pre id="http_info_data" style="height:100%"></pre></div>',
    								    success:function(layers){
    								        $('#http_info_data').text(_http_info);
    								        $(layers).css('top',($(window).height() - $(layers).height()) /2);
    								    }
						            })
						        }else{
						            layer.msg('No HTTP details',{icon:6})
						        }
						    }
						}]}
					],
					data:res,
					done:function(res){
						$('.site_logs_page').html(that.render_logs_pages(9,obj.p,res.length));
						$('.site_logs_page a').unbind().click(function(e){
							var _page = parseInt($(this).attr('data-page'));
							that.render_site_logs({siteName:obj.siteName,toDate:obj.toDate,p:_page});
						});
					}
				});
			});
		},
		/**
        	* @description 渲染封锁历史列表
            * @param {Object} obj 页数
        */
		render_history_data:function(obj,callback){
			var that = this;
			if(obj == undefined) obj={p:1}
			that.http({tips:'Getting logs, please wait...',method:'get_safe_logs',data:{drop_ip: 1,p:obj.p},check: true,success:function(res){
				if(res.clear){
					layer.confirm('The current log file is too large to get the list, whether to clear the log',{title:'Clean log',closeBtn:2,icon:0}, function(){
						that.ajaxTask('remove_log',{safe_logs:1,site_logs:JSON.stringify([]),site_all:0},function(res){
							layer.msg(res.msg,{icon:res.status?1:2})
						})
					})
					return false;
				}
				that.refresh_table_view({
					el:'#history_table',
					form_id:'history_table', //用于重置
					height:500,
					config:[
						{fid:'0',width:'130px', title:'Begin',type:'link',templet:function(res){return '<span title="'+bt.format_data(res[0])+'" class="overflow_hide" style="width: 130px;">'+bt.format_data(res[0])+'</span>'}},
						{fid:'1',width:'120px', title:'IP',templet:function(row,index){
							return row[row.length-1]?'<span title="'+row[1]+'" class="overflow_hide" style="width: 110px;"><a href="javascript:;" class="btlink uncover_ip" title="Unblock this IP" data-ip="'+ row[1] +'">'+ row[1] +'</a></span>':'<span title="'+row[1]+'" class="overflow_hide" style="width: 110px;">'+row[1]+'</span>';
						}},
						{fid:'2',width:'100px',title:'WebSite',templet:function(row,index){
							return '<span title="'+row[2]+'" class="overflow_hide" style="width: 90px;">'+row[2]+'</span>'
						}},
						{fid:'3',width:'95px', title:'Reason',templet:function(row,index){
						    if(row[5] === 'disable_upload_ext'){
						        return 'Malicious file upload';
						    }
						    if(row[5] === 'inc'){
						        return 'Multiple malicious requests';
						    }
							return row[5] === 'cc'?'CC attack':'Multiple malicious requests';
						}},
						{fid:'4',width:'70px',title:'Time',templet:function(row,index){return row[4] + 's'}},
						{fid:'5',width:'55px',title:'Status',templet:function(row,index){
							return row[row.length-1]?'<span style="color:red">Blocked</span>':'Unblocked';
						}},
						{fid:'tools',title:'OPT',style:'text-align: right;',group:[{
						    title:'Whiten',
						    event:function(row,index){
								bt.show_confirm('Add this URL to the whitelist','<span style="color:red">After joining the URL whitelist, it will no longer be defensive, please operate with caution!</br></span>',function(){
									that.ajaxTask('wubao_url_white',{url_rule:row[3]},function(res){
										layer.msg(res.msg, {icon:res.status?1:2});
									});
								})
						    }
						},{
							title:'Ban',
							event:function(row,index){
								layer.confirm('Do you want to add <span style="color:red">' + row[1] + '</span> to the IP blacklist?', { title: 'Add to IP blacklist', closeBtn: 2 }, function () {
									if(bt.check_ip(row[1])){
										that.ajaxTask('add_ip_black',{start_ip:row[1],end_ip:row[1]},function(res){
											layer.msg(res.msg,{icon:res.status?1:2});
										});
									}else{
										that.ajaxTask('set_ipv6_back',{addr:row[1]},function(res){
											layer.msg(res.msg,{icon:res.status?1:2});
										});
									}
								});
							}
						},{
							title:'Unblock',
							event:function(row,index){
								if(row[row.length-1]){
									layer.confirm('Do you want to unblock IP ['+ row[1] +']', { title: 'Unblock IP address',closeBtn:2,icon:0}, function () {
										that.ajaxTask('remove_waf_drop_ip',{ip:row[1]},function(res){
											if(res.status) that.render_history_data();
											layer.msg(res.msg,{icon:res.status?1:2});
										});
									});
									
									// layer.confirm('是否要从防火墙解封IP【'+ row[1] +'】</br><div class="history_add_ip_white"><span class="waf_unselect" title="" style="vertical-align: 2px;"><i class="waf-icon waf-icon-ok"><span class="glyphicon glyphicon-ok" aria-hidden="true" title=""></span></i><input type="checkbox"></span> 是否加入IP白名单</div> ', { title: '解封IP地址',closeBtn:2,icon:0}, function () {
									// 	var is_white = $('.waf-icon.waf-icon-ok').hasClass('waf-checked');
									// 	that.ajaxTask('remove_waf_drop_ip',{ip:row[1]},function(res){
									// 		if(res.status) that.render_history_data();
									// 		layer.msg(res.msg,{icon:res.status?1:2});
									// 	});
									// 	if(is_white){
									// 		$.post('/plugin?action=a&name=btwaf&s=add_ip_white',{start_ip:row[1],end_ip:row[1]},function(rdata){
									// 			if(!rdata.status){layer.msg(rdata.msg,{icon:2})}
									// 		})
									// 	}
									// });
									// // 是否加入白名单开关
									// $('.history_add_ip_white').on('click',function(){
									// 	var _checked = $(this).find('input').prop('checked');
									// 	if(_checked){
									// 		$(this).find('.waf-icon-ok').removeClass('waf-checked');
									// 		$(this).find('input').prop('checked',false);
									// 	}else{
									// 		$(this).find('.waf-icon-ok').addClass('waf-checked');
									// 		$(this).find('input').prop('checked',true);
									// 	}
									// })
								}else{
									layer.msg('IP has been unblocked',{icon:1})
								}
							}
						},{
							title:'Detail',
							event:function(row,index){
								if(!row[9] && !row[6]) return layer.msg('No data',{icon:6})
								var filter_rule = '',rule_arry = row[8].split(" &amp;gt;&amp;gt; "),incoming_value = '', risk_value = '';
								if (rule_arry.length == 0) filter_rule = rule_arry[0]
								incoming_value = rule_arry[1] == undefined ? 'Empty' : rule_arry[1];
								risk_value = rule_arry[2] ? rule_arry[2] : 'Empty';
								layer.open({
									type: 1,
									title: "["+ bt.format_data(res[0]) + "] Detail",
									area: '600px',
									closeBtn: 2,
									shadeClose: false,
									content: '<div class="pd15 lib-box">\
											<table class="table" style="border:#ddd 1px solid; margin-bottom:10px">\
											<tbody><tr><th>Time</th><td>'+ that.escapeHTML(bt.format_data(res[0])) + '</td><th>User IP</th><td><a class="btlink add_log_ip_black"  title="Add to blacklist">' + that.escapeHTML(row[1]) + '</a></td></tr><tr><th>Type</th><td>' + that.escapeHTML(row[6]) + '</td><th>Filter</th><td>' + that.escapeHTML(row[9]) + '</td></tr></tbody></table>\
											<div><b style="margin-left:10px">URI</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(row[3]) + '</div></div>\
											<div><b style="margin-left:10px">User-Agent</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(row[7]) + '</div></div>\
											<div><b style="margin-left:10px">Filter rule</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(rule_arry[0]) + '</div></div>\
											<div><b style="margin-left:10px">Incoming value</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(incoming_value) + '</div></div>\
											<div><b style="margin-left:10px">Value at risk</b></div>\
											<div class="lib-con pull-left mt10"><div class="divpre">'+ that.escapeHTML(risk_value) + '</div></div>\
										</div>',
									success:function(){
										$('.add_log_ip_black').click(function(){
											layer.confirm('Do you want to add <span style="color:red">' + row[1] + '</span> to the blacklist', { title: 'Add to blacklist', closeBtn: 2 }, function () {
												if(bt.check_ip(row[1])){
													that.ajaxTask('add_ip_black',{start_ip:row[1],end_ip:row[1]},function(res){
														layer.msg(res.msg,{icon:res.status?1:2});
													});
												}else{
													that.ajaxTask('set_ipv6_back',{addr:row[1]},function(res){
														layer.msg(res.msg,{icon:res.status?1:2});
													});
												}
											});
										});
									}
								})
							}
						},{
							title:'HTTP',
							event:function(row,index){
								var _http_info = row[10];
						        if(_http_info){
						            layer.open({
						                type: 1,
    									title: "["+ row[0] + "] HTTP detail",
    									area: ['800px','500px'],
    									closeBtn: 1,
    									shadeClose: false,
    									maxmin: true,
    									content: '<div class="pd15 lib-box" style="height:100%">\
    											<pre id="http_info_data" style="height:100%"></pre></div>',
    								    success:function(layers){
    								        $('#http_info_data').text(_http_info);
    								        $(layers).css('top',($(window).height() - $(layers).height()) /2);
    								    }
						            })
						        }else{
						            layer.msg('No http detail',{icon:6})
						        }
						    }
						}]}
					],
					data:res,
					done:function(res){
						// 解封所有封锁
						$('.uncover_ip').click(function(){
							var _ip = $(this).attr('data-ip');
							layer.confirm('Do you want to unblock IP ['+ _ip +']', { title: 'Unblock IP',closeBtn:2,icon:0}, function () {
								that.ajaxTask('remove_waf_drop_ip',{ip:_ip},function(res){
									if(res.status) that.render_history_data();
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						});
						$('.history_uncover_page').html(that.render_logs_pages(12,obj.p,res.length));
						$('.history_uncover_page a').unbind().click(function(e){
							var _page = parseInt($(this).attr('data-page'));
							that.render_history_data({p:_page});
						});
						if(callback) callback(res)
					}
				})
			}})
		},
		/**
        	* @description 渲染操作日志列表
            * @param {Object} obj 页数,点击页码时调用的函数
        */
		render_logs_data:function(obj,callback){
			var that = this;
			if(obj == undefined) obj={p:1}
			this.ajaxTask('get_gl_logs',{p:obj.p,tojs:obj.tojs},function(res){
				that.refresh_table_view({
					el:'#logs_table',
					form_id:'logs_table', //用于重置
					config:[
						{fid:'log',tips:true,title:'Detail '},
						{fid:'addtime',title:'Operation time',width:'150px',style:'text-align: right;'}
					],
					data:res.data,
					page:res.page,
					done:function(res,obj){}
				});
			});
		},
		/**
        	* @description 渲染日志分页
            * @param {Number} pages 每页个数
            * @param {Number} p 当前页数
            * @param {Number} num 总数
			* @return 返回组合的HTML页码文本
        */
		render_logs_pages:function(pages,p,num){
			return '<a class="nextPage" data-page="1">Home</a>'+ (p != 1?'<a class="nextPage" data-page="'+ (p-1) +'">Prev</a>':'') + (pages <= num?'<a class="nextPage" data-page="'+ (p+1) +'">Next</a>':'')+'<span class="Pcount"> '+ p +' </span>';
		},
		/**
        	* @description 渲染扫描webshell
            * @param {Object} obj 路径
        */
		render_san_webshell:function(obj,callback){
			var that = this;
			this.refresh_table_view({
				el:'#scan_webshell_table',
				form_id:'scan_webshell_table', //用于重置
				height:400,
				config:[
					{fid:'0',title:'Text name',templet:function(row,index){
						var _file = Object.keys(row)[0].split('/');
						return '<a href="javascript:;" class="btlink file_rule_link" title="'+ Object.keys(row)[0] +'"  onclick="OnlineEditFile(0,\''+ Object.keys(row)[0]+'\')" >' + _file[_file.length -1] + '</a>';
					}},
					{fid:'1',title:'Rule',width:200,class:'file_rule table-text-cell',templet:function(row,index){
						return  '<span>' + row[Object.keys(row)[0]] + '</span>';
					}},
					{fid:'total',title:'OPT',width:290,style:'text-align: right;',group:[
						{title:'Official',event:function(row,index){
							that.ajaxTask('send_baota',{filename:Object.keys(row)[0]},function(res){
								layer.msg(res.msg,{icon:res.status?1:2});
							});
						}},{title:'Third party',event:function(row,index){
							that.ajaxTask('upload_file_url',{filename:Object.keys(row)[0]},function(res){
								layer.msg(res.msg,{icon:res.status?1:2});
							});
						}},{title:'Open File',event:function(row,index){
							OnlineEditFile(0,Object.keys(row)[0]);
						}},{title:'Whiten',event:function(row,index){
							var _file = Object.keys(row)[0];
							layer.confirm('Do you want to add this action to the whitelist?', {title:'Whiten',icon:0,closeBtn:2}, function () {
								that.ajaxTask('lock_not_webshell',{not_path:_file,path:obj['path']},function(res){
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						}}
					]}
				],
				data:obj.data,
				done:function(res){
					$('#scan_webshell_table .fixed-table .file_rule').hover(function(e){
						var _val = $(this).find('span').text(),_that = $(this);
						$(this).append('<div class="rule_down_icon" style="top:'+ e.currentTarget.offsetTop +'px;right:274px"><i class="iconfont iconxialadown" style="font-size: 20px;"></i></div>')
						$(this).unbind('click').click(function(e){
							if(_that.find('.rule_mask').length === 0){
								_that.append('<div class="rule_mask" style="top:'+ e.currentTarget.offsetTop +'px;"><div class="content">'+ _val +'</div><i class="iconfont iconguanbi" style="font-size: 25px;"></i></div>')
							}
							e.preventDefault();
							e.stopPropagation();
						});
						$('.file_rule').on('click','.iconguanbi',function(e){
							$(this).parent().remove();
							_that.find('.rule_down_icon').remove();
							e.preventDefault();
							e.stopPropagation();
						})
					},function(e){
						$(this).find('.rule_down_icon').remove();
					});
					if(callback) callback(res);
				}
			});
		},
		/**
        	* @description 渲染webshell规则
        */
		render_webshell_rule:function(callback){
			var that = this;
			that.ajaxTask('shell_get_rule',function(res){
				that.refresh_table_view({
					el:'#webshell_rule_table',
					form_id:'webshell_rule_table', //用于重置
					height:500,
					config:[
						{fid:'1',title:'Rule',templet:function(row,index){
							return '<div class="" style="width:600px;word-break:break-all;line-height: 20px;">'+ row +'</div>'
						}},
						{fid:'0',title:'OPT',width:'50px',style:'text-align: right;',group:[{title:'Del',event:function(row,index){
							layer.confirm('Are you sure to delete this rule [ ' + row + ' ]?', {title: 'Tips',btn: ['Confirm', 'Cancel'],icon: 0,closeBtn: 2}, function () {
								that.ajaxTask('shell_del_rule',{rule:row},function(res){
									if(res.status) that.refresh_data_webshell('rule_list');
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							});
						}}]}
					],
					data:res,
					done:function(res){if(callback) callback(res)}
				});
			});
		},
		/**
			* @description 渲染http过滤视图
			* @param {Number} type  [0]为请求过滤   [1]为请求头过滤
        */
		render_http_rule_view:function(type){
			var that = this,data_request = this.overall_config['method_type'],data_header = this.overall_config['header_len'],
			analyze_ = [
				['POST parameter XSS defense',this.overall_config['post_is_xss'],'post_is_xss'],
				['POST parameter SQL injection defense',this.overall_config['post_is_sql'],'post_is_sql'],
				['GET parameter transfer XSS defense',this.overall_config['get_is_xss'],'get_is_xss'],
				['GET parameter passing SQL injection defense',this.overall_config['get_is_sql'],'get_is_sql']
			]
			if(type == 0){
				that.refresh_table_view({
					el:'#http_filtering_table',
					form_id:'http_filtering_table', //用于重置
					height:380,
					config:[
						{title:'Request type',templet:function(row,index){return '<span class="overflow_hide" style="width: 410px;" title="'+row[0]+'">'+row[0]+'</span>'}},
						{fid:'1', title:'Status',type:'btswitch',width:'50px',style:'text-align: center;',
							event:function(row,index,event){
								that.ajaxTask('add_method_type',{method_type:row[0],check:row[1]?0:1},function(res){
									if(res.status){
										that.refresh_data_total('overall')
										setTimeout(function(){that.render_http_rule_view(0)},200)
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}
					],
					data:data_request,
					done:function(){}
				});
			}else if(type == 1){
				that.refresh_table_view({
					el:'#header_filtering_table',
					form_id:'header_filtering_table', //用于重置
					height:337,
					config:[
						{title:'Header',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 305px;" title="'+row[0]+'">'+row[0]+'</span>'
						}},
						{title:'Length',templet:function(row,index){
							return '<span class="overflow_hide" style="width: 45px;" title="'+row[1]+'">'+row[1]+'</span>'
						}},
						{title:'OPT',width:'120px',style:'text-align: right;',group:[{
							title:'Edit',
							event:function(row,index,event,el){
								var _tr = $(el).parent().parent().parent();
								$(_tr).find('td:eq('+1+')').html('<input type="text" class="waf-input waf-rule-len" value="'+ row[1] +'" style="width:60px"/>');
								$(_tr).find('td:eq('+2+')').html('<span><a class="btlink save_header_data" href="javascript:;">Save</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class="btlink clear_header_data" href="javascript:;">Cancel</a></span>');
								$('.save_header_data').click(function(e) {
									that.ajaxTask('edit_header_len',{header_type:row[0].toLowerCase(),header_type_len:$('.waf-rule-len').val()},function(res) {
										if(res.status){
											that.refresh_data_total('overall')
											setTimeout(function(){that.render_http_rule_view(1);},200)
										}
										layer.msg(res.msg,{icon:res.status?1:2});
									});
								});
								$('.clear_header_data').click(function(e) {
									that.waf_table_list.header_filtering_table.reset();
								});
							}
						},{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('del_header_len',{header_type:row[0],header_type_len:row[1]},function(res){
									if(res.status){
										that.refresh_data_total('overall')
										setTimeout(function(){that.render_http_rule_view(1);},200)
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]}
					],
					data:data_header,
					done:function(){}
				});
			}else{
				that.refresh_table_view({
					el:'#statement_analyze_table',
					form_id:'statement_analyze_table', //用于重置
					height:380,
					config:[
						{title:'Defense type',templet:function(row,index){return '<span class="overflow_hide" style="width: 410px;" title="'+row[0]+'">'+row[0]+'</span>'}},
						{fid:'1', title:'Status',type:'btswitch',width:'50px',style:'text-align: center;',
							event:function(row,index,event){
								that.ajaxTask('set_obj_open',{obj:row[2]},function(res){
									if(res.status){
										that.refresh_data_total('overall')
										setTimeout(function(){that.render_http_rule_view(0)},200)
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}
					],
					data:analyze_,
					done:function(){}
				})
			}
		},
		/**
		* @descripttion 渲染蜘蛛池列表
		* @param {Number} num 蜘蛛类型
		* @return: 无返回值
		*/      
		render_spider_list:function(num,callback){
			var that = this,_list = ["baidu","google","360","sogou","yahoo","bingbot"];
			if(typeof num == 'number') num = _list[num]
			this.ajaxTask('get_rule',{ruleName: 'spider',spider:num},function(res){
				that.spider_data_list = res
				that.refresh_table_view({
					el:'#spider_list_info',
					form_id:'spider_list_info',
					height:280,
					config:[
						{title:'IP', templet:function(row,index){return row}},
						{title:'OPT',width:'50px',style:'text-align: right;',group:[{
							title:'Del',
							event:function(row,index){
								that.ajaxTask('del_spider',{spider:num,ip:row},function(res){
									if(res.status) that.render_spider_list(num);
									layer.msg(res.msg,{icon:res.status?1:2});
								});
							}
						}]
						}
					],
					data:res,
					done:function(res){ if(callback) callback(res)}
				})
			});
		},
        /**
			* 渲染收件者邮箱列表
		*/
		render_receive_list:function(){
			var that = this;
			$.post('/config?action=get_settings',function(rdata){
				var tbody_ = '',data = rdata.user_mail.mail_list;
				if(data.length > 0){
					$.each(data,function(index,item){
						tbody_ += '<tr>'
							+ '<td>'+item+'</td>'
							+ '<td style="text-align: right;"><a class="btlink" onclick="bt_waf.del_email(\''+item +'\')">Del</a></td></tr>'
					})
				}else{
					tbody_ = '<tr><td colspan="2">No data</td></tr>'
				}
				$('.receive_table').html(tbody_);
			})
		},
		render_static_code_list:function(callback){
			var that = this;
			this.ajaxTask('get_config',function(res){
				var rdata = res.static_code_config
				var _arry = [];
				for(var i in rdata){
					var o = {'code':i,'status':rdata[i]}
					_arry.push(o)
				}
				that.refresh_table_view({
					el:'#code_table',
    				form_id:'code_table', //用于重置
    				height:270,
    				config:[
						{title:'Status Code',templet:function(row,index){return row['code']}},
						{title:'Blocking state',templet:function(row,index){
							if(row['status'] == '444') return 'Intercept';
							return row['status']
							}
						},
						{title:'OPT',width:'120px',style:'text-align: right;',group:[{
							title:'Edit',
							event:function(row,index){
								that.open_code_view_dialog(false,row);
							}
						},{
    						title:'Del',
    						event:function(row,index){
    							that.ajaxTask('del_static_code_config',{code_from:row['code'],code_to:row['status']},function(res){
    								if(res.status) that.render_static_code_list();
    								layer.msg(res.msg,{icon:res.status?1:2});
    							})
    						}
    					}
						]}
					],
					data:_arry,
					done:function(res){if(callback) callback(res);}
				})
			})
		},
		/**
        	* @description 设置状态码配置
        */
		set_static_code_config:function(){
			var that = this;
            layer.open({
                type: 1,
                title: '状态码列表',
                area: ['550px', '500px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="code_table" style="padding:25px 15px">\
						<div class="waf-form-input">\
							<button class="btn btn-success btn-sm va0 add_code">Add</button>\
						</div>\
						<div id="code_table"></div>\
						<ul class="help-info-text c7 ptb10">\
							<li style="color:red;">Note: If your intercepted status code is 403, then the intercepted page will not be displayed after adding</li>\
							<li>It is recommended to add 500 error reports for interception to effectively prevent information leakage</li>\
						</ul>\
					</div>',
				success:function(){
					that.render_static_code_list();
					$('.add_code').click(function(){
						that.open_code_view_dialog(true);
					})
				}
			})
		},
		/**
        	* @description 设置CC规则配置视图
            * @param {String} obj 对象，显示的数据
        */
		set_cc_rule_view:function(obj){
			var that = this,_btn = ['Apply'],enhance_mode = '',mode= 1,renji_flag = false,renji_count = 0;
			if(!obj.siteName) _btn= ['Apply to global']
            // 增强模式
            if(obj.increase){
                enhance_mode = 1;
            }else{enhance_mode = 0;}
            //模式
            if(obj.mode == undefined){
                mode = 1
            }else{mode = obj.mode <= '1'?1:2}
    		layer.open({
                type: 1,
                title: "Set CC Rule"+(obj.siteName?'【'+ obj.siteName +'】':''),
                area: '550px',
                closeBtn: 2,
                shadeClose: false,
				btn:_btn,
                content:'<div class="waf-form cc_rule_form pd20">\
                    <div class="waf-line">\
    					<span class="name-l">Mode</span>\
    					<div class="info-r">\
    						<select class="bt-input-text mr5" style="width:140px" name="cc_key_mode" id="cc_key_mode">\
                                <option value="1">General mode</option>\
                                <option value="2">Enhanced mode</option>\
                            </select>\
    					</div>\
    				</div>\
    				 <div class="waf-line">\
    					<span class="name-l">Request</span>\
    					<div class="info-r">\
    						<select class="bt-input-text mr5" style="width:140px" name="cc_type_status" id="cc_type_status">\
                                <option value="1">URL with param</option>\
                                <option value="2">URL without param</option>\
                                <option value="3">IP</option>\
                                <option value="4">IP+UA</option>\
                            </select>\
    					</div>\
    				</div>\
    				<div class="waf-line">\
    					<span class="name-l">Cycle</span>\
    					<div class="info-r">\
    						<input type="number" name="cc_cycle" value="" class="waf-input" />\
    						<span class="waf_input_tips">Sec</span>\
    					</div>\
    				</div>\
    				<div class="waf-line">\
    					<span class="name-l">Frequency</span>\
    					<div class="info-r">\
    						<input type="number" name="cc_limit" value="" class="waf-input" />\
    						<span class="waf_input_tips">Time(s)</span>\
    					</div>\
    				</div>\
    				<div class="waf-line">\
    					<span class="name-l">Block Time</span>\
    					<div class="info-r">\
    						<input type="number" name="cc_endtime" value="" class="waf-input" />\
    						<span class="waf_input_tips">Sec</span>\
    					</div>\
    				</div>\
                    <div class="waf-line enhance_view" style="display:none;">\
    					<span class="name-l">Captcha</span>\
    					<div class="info-r" style="width: 395px;">\
    						<select class="bt-input-text mr5" style="width:139px" name="cc_enhance_mode">\
                                <option value="0">Automatic mode</option>\
                                <option value="1">Always on</option>\
                            </select>\
                            <div class="bt_cc_view" style="display:inline-block;">\
                                <div class="info-r" style="display: inline-block;margin-left:10px;margin-bottom:0;">Set trigger conditions, time<input class="bt-input-text" name="cc_time" type="text" value="" style="width:50px;margin:0 5px;"/>Sec</div>\
                                <div class="info-r" style="display: inline-block;margin-left:10px;margin-bottom:0;">Threshold<input class="bt-input-text" name="cc_retry_cycle" type="text" value="" style="width:50px;margin:0 5px;"/>Time(s)</div>\
                            </div>\
    					</div>\
                    </div>\
                    <div class="waf-line cc_increase">\
    					<span class="name-l">Ways of</span>\
    					<div class="info-r">\
                            <select class="bt-input-text mr5" style="width:139px" name="cc_increase_type" disabled="disabled">\
                                <option value="js">JS</option>\
                                <option value="code">Vcode</option>\
                                <option value="renji">Captcha</option>\
                                <option value="huadong">Swipe</option>\
                            </select>\
    					</div>\
    				</div>\
    				<div class="waf-line-tips">\
    					<ul class="waf_tips_list mtl0 c7 ptb10">\
    						<li class="key" style="display:'+ (obj.siteName?'none':'list-item') +'">The setting here is the initial value, which will be inherited when a new site is added, and it is invalid for the existing site.</li>\
    						<li class="key" style="display:'+ (!obj.siteName?'none':'list-item') +'">The settings here are only valid for the current site.</li>\
                            <li class="key cc_borwser" style="display:none">Browser verification: verify whether it is a normal browser request, if the website visits abnormally after opening, please close it</li>\
                            <li class="key cc_four" style="display:none">Enhanced mode: CC defense enhanced version, which may affect the user experience after being turned on. It is recommended to turn it on when the user is attacked by CC.</li>\
                            <li class="cc_auto" style="display:none">When the automatic mode is set to on, the enhanced mode is automatically turned on when the website is accessed <span class="waf_cc_limit cc_retry_cycle key"></span> times within <span class="waf_cc_limit cc_time key"></span> seconds , If the rule is not triggered, the enhanced mode is automatically turned off.</li>\
							<li><span class="waf_cc_cycle key">Accumulatively request the same URL more than '+ obj.cc_limit +'</span> times within <span class="waf_cc_limit key">'+ obj.cc_cycle +'</span> seconds, trigger CC defense, block this IP for <span class="waf_cc_endtime key">'+ obj.cc_endtime +'</span> sec</li>\
    						<li class="key" style="display:'+ (!obj.siteName?'none':'list-item') +'">Please do not set too strict CC rules, so as not to affect the normal user experience</li>\
    					</ul>\
    				</div>\
    			</div>',
    			success:function(index,layero){
                    // 同步提示
    				var arry = ['cc_cycle','cc_limit','cc_endtime'];
    				for(var i=0;i<arry.length;i++){
    					(function(i){
    						$('[name="'+ arry[i] +'"]').on('keyup click',function(){
    							$('.waf_'+arry[i]).html($(this).val());
    						});
    					})(i)
    				}
                    // 设置选项
                    var _sel = that.waf_cc_config_list;
                    // 选项触发
                    $('[name=cc_key_mode]').change(function(){
    					//数据填入
    					var _data = _sel[$(this).val() == '1'?1:(obj.mode =='3'?3:4)].data;
                        for(var item in _data){
    						$('[name='+item+']').val(_data[item]);
    					}
    					$('[name=cc_cycle]').val(obj.cc_cycle)
        				$('[name=cc_limit]').val(obj.cc_limit)
        				$('[name=cc_endtime]').val(obj.cc_endtime)
        				$('[name=cc_type_status]').val(obj.cc_type_status)
                        //触发不同的显示
                        if($(this).val() == 1){
                            $('.bt_cc_view,.enhance_view,.cc_borwser,.cc_four,.cc_auto,.cc_increase').hide();
                        }else{
                            $('.bt_cc_view,.cc_borwser,.cc_auto,.enhance_view,.cc_four,.cc_increase').show();
                            // 设置自动模式触发时间、阀口
    						if(obj.siteName){
    							$('[name=cc_time]').val(obj.cc_time).attr('data-default',obj.cc_time);
    							$('.cc_time').html(obj.cc_time)
    							$('[name="cc_retry_cycle"]').val(obj.cc_retry_cycle).attr('data-default',obj.cc_retry_cycle);
    							$('.cc_retry_cycle').html(obj.cc_retry_cycle)
    						}else{
    							$('[name=cc_time]').val(that.overall_config.cc_time).attr('data-default',that.overall_config.cc_time);
    							$('.cc_time').html(that.overall_config.cc_time)
    							$('[name="cc_retry_cycle"]').val(that.overall_config.cc_retry_cycle).attr('data-default',that.overall_config.cc_retry_cycle);
    							$('.cc_retry_cycle').html(that.overall_config.cc_retry_cycle)
    						}
                        }
                        //人机校验判断
                        var _val = _data.cc_enhance_mode;
                         _val == 0? $('[name=cc_enhance_mode]').siblings().show():$('[name=cc_enhance_mode]').siblings().hide();
                        _val == 0? $('[name=cc_increase_type]').val('js').prop('disabled','disabled'):$('[name=cc_increase_type]').prop('disabled',false);
                        $('.increase_span').addClass('hide')
                    })
                    $('[name=cc_enhance_mode]').change(function(){
                        var _val = $(this).val();
                        if(_val == 0) {
                            $('.enhance_view').css({
                                'height': '100px'
                            })
                        } else {
                            $('.enhance_view').css({
                                'height': '2pc'
                            })
                        }
                        _val == 0? $(this).siblings().show():$(this).siblings().hide();
                        _val == 0? $('[name=cc_increase_type]').val('js').prop('disabled','disabled'):$('[name=cc_increase_type]').prop('disabled',false);
                    })
                    $('[name=cc_increase_type]').change(function(){
                        var _val = $(this).val(),_select = $(this);
                        switch(_val){
                            case 'code':
                                $('.code_span').removeClass('hide')
                                $('.renji_span').addClass('hide')
                                break;
                            case 'renji':
                            case 'huadong':
                                $('.code_span').addClass('hide')
                                $('.renji_span').removeClass('hide')
                                if(!renji_flag && renji_count == 0){
                                    that.ajaxTask('check_renji',function(res){
                                        renji_count = 1
                                        if(!res){
                                            layer.msg((res?'Can':'Can not')+'turn on man-machine and sliding verification, please refer to the tutorial for details.',{icon:res?1:2})
                                            renji_flag = true;
                                            $('[name=cc_increase_type] option[value=renji], [name=cc_increase_type] option[value=huadong]').prop('disabled',true)
                                        }
                                    })
                                }
                                break;
                        }
                    })
    				// 触发默认select
                    $('[name=cc_key_mode]').val(mode);
    				$('[name=cc_key_mode]').change();
    				//设置获取的数据重新填入
    				$('[name=cc_cycle]').val(obj.cc_cycle)
    				$('[name=cc_limit]').val(obj.cc_limit)
    				$('[name=cc_endtime]').val(obj.cc_endtime)
    				$('[name=cc_type_status]').val(obj.cc_type_status)
    				// 设置四层防御状态/增强模式验证方式
    				$('[name=cc_increase_type]').val(obj.cc_increase_type == undefined ?'js': obj.cc_increase_type)
    			    $('.'+obj.cc_increase_type+'_span').removeClass('hide')
    			},
    			yes:function(index,layero){
                    var num = $('[name=cc_key_mode]').val(),
                        cc_cycle = $('[name="cc_cycle"]').val(),
                        cc_limit = $('[name="cc_limit"]').val(),
                        cc_endtime = $('[name="cc_endtime"]').val(),
                        increase_wu_heng = $('[name="increase_wu_heng"]').val(),
                        cc_four_defense = $('[name="cc_four_defense"]').val(),
                        cc_time = $('[name="cc_time"]'),
                        cc_retry_cycle= $('[name="cc_retry_cycle"]'),
                        cc_enhance_mode = $('[name="cc_enhance_mode"]').val(),
                        cc_increase_type = $('[name="cc_increase_type"]').val()
                        cc_type_status = $('[name="cc_type_status"]').val()

                    if(renji_flag){
                        layer.msg('Panel cannot open the man-machine and swipe verification',{icon:2})
                        return false;
                    }
                    if(cc_cycle == 0 || cc_limit == 0 || cc_endtime == 0) return layer.msg('The rule parameter cannot be 0, please re-enter!',{icon:2});
                    num == '1'?num = 1:(cc_enhance_mode == '0'?num = 3:num = 4)
    				// 提交基础信息
                    var pdata = {
                        siteName: obj.siteName,
                        cc_mode: num,
                        cycle: cc_cycle,
                        limit: cc_limit,
                        endtime: cc_endtime,
                        is_open_global: obj.siteName == undefined ?1:0,
                        increase: cc_enhance_mode == '0'?0:1,
                        increase_wu_heng:increase_wu_heng == '0'?0:1,
                        cc_increase_type:cc_increase_type,
                        cc_type_status:cc_type_status
                    }
                    // 检测是否需要开启/关闭【自动，四层防御】，规则配置提交
                    // 一、是否为自动模式
                    if(num == 3){
						if(cc_time.val() == '' || cc_retry_cycle.val() == '') return layer.msg('Please set the correct trigger condition',{icon:2})
                        if(!obj.siteName){
    						that.http({load:3,check:true,method:'start_cc_status',success:function(res){}})
                            if(cc_time.val() != cc_time.attr('data-default') || cc_retry_cycle.val() != cc_retry_cycle.attr('data-default')){
    							//提交自动模式数据
    							that.http({load:3,method:'set_cc_automatic',data: {
    							    cc_time:cc_time.val(),
    							    cc_retry_cycle:cc_retry_cycle.val(),
    							    increase_wu_heng:increase_wu_heng}
    							,success:function(res){}})
                            }
                        }else{
    						pdata['cc_time'] = cc_time.val();
    						pdata['cc_retry_cycle'] = cc_retry_cycle.val();
    					}
                    }else{
                        that.http({load:3,check:true,method:'stop_cc_status',success:function(res){}})
                    }
    // //                 // 三、CC防御配置提交
    				that.ajaxTask(!obj.siteName?'set_cc_conf':'set_site_cc_conf',pdata,function(res){
    					if(res.status) {
    						if(obj.siteName){
    							that.render_site_config({siteName:obj.siteName});
    						}else{
    							that.refresh_data_total('overall');
    						}
    						layer.close(index);
    					}
                        layer.msg(res.msg,{icon:res.status?1:2});
                    });
    			}
    		});
    	},
		/**
        	* @description 设置规则配置视图
            * @param {Object} row 数据对象
        */
		set_other_rule_view:function(row){
			var _type = '' ,that = this;
			if(row.name == 'GET-param filter'){
				_type = 'args';
			}else if(row.name == 'GET-URL filter'){
				_type = 'url';
			}else if(row.type == 'user-agent'){
				_type = 'user_agent';
			}else{
				_type = row.type;
			}
			layer.open({
				type: 1,
				title: "Edit rule[" + row.name + "]",
				area: ['800px', '600px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="other_table">\
							<div class="waf-form-input">\
								<input type="text" class="waf-input" name="ruleValue" placeholder="Rule content, please use regular expression" />\
								<input type="text" class="waf-input" name="rulePs" placeholder="Description" />\
								<button class="btn btn-success btn-sm va0 pull-right add_overall_rule" style="padding: 5px 10px;">Add</button></div>\
							<div id="other_conf_table"></div>\
							<ul class="help-info-text c7 ptb10">\
								<li style="color:red;">Note: If you do not understand regular expressions, please do not modify the content of the rules at will</li>\
								<li>You can add or modify the content of the rule, but please use regular expressions</li>\
								<li>The built-in rules allow modification, but cannot be deleted directly. You can set the rule status to define whether the firewall uses this rule</li>\
							</ul>\
						</div>',
				success:function(index,layero){
					that.render_other_conf({ruleName:_type});
					$('.add_overall_rule').click(function() {
						var _ruleValue = $('[name=ruleValue]'),_rulePs = $('[name=rulePs]');
						that.ajaxTask('add_rule',{
							ruleValue:_ruleValue.val(),
							ps:_rulePs.val(),
							ruleName:_type
						},function(res){
							if(res.status) {
								that.render_other_conf({ruleName:_type});
								_ruleValue.val('');
								_rulePs.val('');
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					});
				}
			});
		},
		/**
        	* @description 设置IP段视图（IP黑、白名单、禁止海外、禁止境内）
            * @param {String} type 数据类型
            * @param {Boolean} isShow 数据类型
        */
		set_ip_region_view:function(type,isShow){
			var that = this;
			layer.open({
				type: 1,
				title: type == 'drop_abroad' || type == 'drop_china'?'Manage domestic IP segments':(type =='ip_white'?'Manage IP whitelist':'Manage IP blacklist'),
				area: ['550px', '568px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="ip_region_table" style="padding:'+ ( type =='ip_black'?'0':'23px 15px' ) +'">\
                        <div style="display:'+ ( type =='ip_black'?'block':'none' ) +'">\
                            <div class="tab_list">\
                                <div class="tab_block active">IPv4 blacklist</div>\
                                <div class="tab_block">IPv6 blacklist</div></div>\
                            <div class="pd15 ipv4_block">\
                                <div class="waf-form-input">\
                                    <input type="text" class="waf-input" name="ipv4_start_ip" placeholder="Begin IP" />\
                                    <input type="text" class="waf-input" name="ipv4_end_ip" placeholder="End IP" />\
                                    <button class="btn btn-success btn-sm va0 pull-right add_ipv4_region">Add</button>\
                                </div>\
                                <div id="ipv4_region_table"></div>\
                                <div class="waf-btn-group">\
                                    <button class="btn btn-success va0 mr5 mt10 import_ip">Import</button>\
                                    <button class="btn btn-success va0 mr5 mt10 export_ip">Export</button>\
                                    <button class="btn btn-success va0 mr5 mt10 empty_ip">Empty</button>\
                                </div>\
                            </div>\
                            <div class="pd15 ipv6_block" style="display:none;">\
                                <div class="waf-form-input">\
                                    <input type="text" class="waf-input" name="ipv6_address" placeholder="IPv6" style="width: 440px;" />\
                                    <button class="btn btn-success btn-sm va0 pull-right add_ipv6_region">Add</button>\
                                </div>\
                                <div id="ipv6_region_table"></div>\
                            </div>\
                            <ul class="pd15 waf_tips_list mtl0 c7 ptb10">\
                                <li>The IP segments in the blacklist will be banned from access, except for those already in the IP whitelist</li>\
                            </ul>\
                        </div>\
                        <div style="display:'+ ( type !='ip_black'?'block':'none' ) +'">\
                            <div class="waf-form-input">\
                                <input type="text" class="waf-input" name="start_ip" placeholder="Begin IP" />\
                                <input type="text" class="waf-input" name="end_ip" placeholder="End IP" />\
                                <button class="btn btn-success btn-sm va0 pull-right add_ip_region">Add</button>\
                            </div>\
                            <div id="ip_region_table"></div>\
                            <div class="waf-btn-group" style="display:'+( isShow == undefined?'block':'none' )+'">\
                                <button class="btn btn-success va0 mr5 mt10 import_ip">Import</button>\
                                <button class="btn btn-success va0 mr5 mt10 export_ip">Export</button>\
                                '+(type == 'ip_white'?'<button class="btn btn-success va0 mr5 mt10 empty_ip">Empty</button>':'')+'\
                            </div>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+ ( type=='drop_abroad'?'block':'none' ) +'">\
                                <li>If there is any missing domestic IP segment, please add it here</li>\
                            </ul>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+ ( type=='ip_white'?'block':'none' ) +'">\
                                <li>All rules are invalid for the IP segments in the whitelist, including the IP blacklist and URL blacklist, the IP whitelist has the highest priority</li>\
                            </ul>\
                        </div>\
					</div>',
				success:function(layero, index){
					switch(type){
						case 'drop_abroad':
						case 'drop_china':
							that.render_drop_abroad();
						    break;
						case 'ip_white':
							that.render_ip_white();
						    break;
						case 'ip_black':
							that.render_ip_black(0);
						    break;
					}
                    $('.add_ip_region').click(function(){
						var start_ip = $('[name=start_ip]'),end_ip = $('[name=end_ip]');
						if(start_ip.val() == '' || end_ip.val() == '')return layer.msg('Please enter the starting or ending IP address',{icon:2});
						if(!bt.check_ip(start_ip.val()) || !bt.check_ip(end_ip.val()))return layer.msg('Please enter the correct IP format',{icon:2});
						that.ajaxTask('add_'+(type == 'ip_white' ? 'ip_white': (type =='ip_black'?'ip_black':'cnip')),{start_ip:start_ip.val(),end_ip:end_ip.val()},function(res){
							if(res.status) {
								start_ip.val('');
								end_ip.val('');
								that['render_'+ (type=='ip_white'?'ip_white':'drop_abroad')](0);
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					});
					$('.add_ipv4_region').click(function(){
						var start_ip = $('[name=ipv4_start_ip]'),end_ip = $('[name=ipv4_end_ip]');
						if(start_ip.val() == '' || end_ip.val() == '')return layer.msg('Please enter the begin or end IP',{icon:2})
						if(!bt.check_ip(start_ip.val()) || !bt.check_ip(end_ip.val()))return layer.msg('Please enter the correct IP format',{icon:2})
						that.ajaxTask('add_'+(type =='ip_white'?'ip_white':'ip_black'),{start_ip:start_ip.val(),end_ip:end_ip.val()},function(res){
							if(res.status) {
								start_ip.val('');
								end_ip.val('');
								that['render_'+ type](0);
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					});
                    $('.add_ipv6_region').click(function(){
						var addr = $('[name=ipv6_address]').val();
						that.ajaxTask('set_ipv6_back',{addr:addr},function(res){
							if(res.status){
								$('[name="ipv6_address"]').val('');
                                $('.tab_list .tab_block:eq(1)').click();
                            }
							layer.msg(res.msg, { icon: res.status ? 1 : 2 });
                        })
                    })
                    //ip黑名单tab选项
                    $(".tab_list .tab_block").click(function(){
                        $(this).addClass('active').siblings().removeClass('active');
                        if($(this).index() == 0){
                            $('.ipv4_block').show().next().hide();
							that.render_ip_black(0);
                        }else{
                            $('.ipv4_block').hide().next().show();
							that.render_ip_black(1);
                        }
                    })
					// 导入
					$('.import_ip').click(function(){
						that.import_or_export_view(type,true);
					});
					// 导出
					$('.export_ip').click(function(){
						that.import_or_export_view(type,false,(type == 'drop_abroad' || type == 'drop_china'? that.drop_abroad_list: that.ip_config_list)
						);
					});
					//清空
					$('.empty_ip').click(function(){
					    that.empty_data_list(type)
					})
				}
			});
		}, 
		/**
		* @descripttion 获取蜘蛛视图
		* @return: 无返回值
		*/
		get_spider_view:function(){
			var that = this;
			layer.open({
				type:1,
				title: 'Spider pond',
				area:['550', '600px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="spider_list_table" style="padding:0;height: 100%;">\
						<ul class="tab_list">\
							<li class="tab_block active">Baidu</li>\
							<li class="tab_block">Google</li>\
							<li class="tab_block">360</li>\
							<li class="tab_block">Sougou</li>\
							<li class="tab_block">Yahoo</li>\
							<li class="tab_block">Bing</li>\
							<li class="tab_block">ByteDance</li>\
						</ul>\
						<div class="pd15">\
							<div class="waf-form-input">\
								<input type="text" class="waf-input" name="add_spider" style="width: 450px;" placeholder="Please fill in IP">\
								<button class="btn btn-success btn-sm va0 pull-right submit_spider">Add</button>\
							</div>\
							<div id="spider_list_info"></div>\
							<div class="waf-btn-group">\
								<button class="btn btn-success va0 mr5 mt10 import_ip">Import</button>\
								<button class="btn btn-success va0 mr5 mt10 export_ip">Export</button>\
							</div>\
							<ul class="help-info-text c7">\
								<li style="color:red;font-size: 12px;">Importing errors will cause spider crawling to fail. Non-professionals should not operate.</li>\
							</ul>\
						</div>\
					</div>',
				success:function(){
					var _that = 0,plist = ["baidu","google","360","sogou","yahoo","bingbot","bytespider"];
					that.render_spider_list(0);  //默认百度
					//选项卡切换
					$('.spider_list_table .tab_block').click(function(){
						var _index = $(this).index();
						_that = _index;
						$(this).addClass('active').siblings().removeClass('active');
						that.render_spider_list(_index);
					})
					//添加蜘蛛IP
					$('.submit_spider').click(function(){
						var val = $('input[name=add_spider]');
						if(!bt.check_ip(val.val()) || val.val() == '') return layer.msg('Please enter the correct IP format',{icon:0});
						that.ajaxTask('add_spider',{spider:plist[_that],ip:val.val()},function(res){
							if(res.status){
								val.val('');
								that.render_spider_list(_that);
							}
							layer.msg(res.msg,{icon:res.status?1:2})
						})
					})
					//导入
					$('.import_ip').click(function(){
						that.import_or_export_spider_view(plist[_that],true)
					})
					//导出
					$('.export_ip').click(function(){
						that.import_or_export_spider_view(plist[_that],false,that.spider_data_list)
					})
				}
			})
		},
		/**
        	* @description 设置恶意容忍度视图
            * @param {Object} obj 数据参数
        */
		set_cc_tolerate_view:function(obj){
			var _btn = ['Apply'],that = this;
			if(!obj.siteName) _btn= ['Apply to global']
			layer.open({
				type: 1,
                title: "Set tolerance for malicious requests"+(obj.siteName?'['+ obj.siteName +']':''),
                area: '550px',
                closeBtn: 2,
                shadeClose: false,
				btn:_btn,
                content:'<div class="waf-form cc_rule_form pd20">\
					<div class="waf-line">\
						<span class="name-l">Cycle</span>\
						<div class="info-r">\
							<input type="number" name="cc_tolerate_cycle" value="'+ obj.cycle +'" class="waf-input" />\
							<span class="waf_input_tips">Sec</span>\
						</div>\
					</div>\
					<div class="waf-line">\
						<span class="name-l">Frequency</span>\
						<div class="info-r">\
							<input type="number" name="cc_tolerate_retry" value="'+ obj.retry +'" class="waf-input" />\
							<span class="waf_input_tips">Times</span>\
						</div>\
					</div>\
					<div class="waf-line">\
						<span class="name-l">Block Time</span>\
						<div class="info-r">\
							<input type="number" name="cc_tolerate_time" value="'+ obj.time +'" class="waf-input" />\
							<span class="waf_input_tips">Sec</span>\
						</div>\
					</div>\
					<div class="waf-line-tips">\
						<ul class="waf_tips_list mtl0 c7 ptb10">\
							<li>Accumulated malicious requests exceeded <span class="key">'+ obj.retry +'</span> times within <span class="key">'+ obj.cycle +'</span> seconds , blocked <span class="key">'+ obj.time +'</span> seconds</li>\
							<li class="key">Apply to global: set the current malicious tolerance rules globally, and cover the current malicious tolerance rules of all sites</li>\
						</ul>\
					</div>\
				</div>',
				yes:function(index,layero){
					var time = $('[name=cc_tolerate_time]').val(),
                        cycle = $('[name="cc_tolerate_cycle"]').val(),
						retry = $('[name="cc_tolerate_retry"]').val()

					if(retry == 0 || cycle == 0 || time == 0)return layer.msg('The rule parameter cannot be 0, please re-enter!',{icon:2})
					that.ajaxTask(obj.siteName?'set_site_retry':'set_retry',{
						retry: retry,
						retry_time: time,
						retry_cycle: cycle,
						is_open_global: obj.siteName == undefined ? 1:0,
						siteName: obj.siteName
					},function(rdata){
						if(rdata.status){
							setTimeout(function(){
								layer.close(index);
								obj.siteName? that.render_site_config({siteName:obj.siteName}) : that.refresh_data_total('overall');
							},1000)
						}
						layer.msg(rdata.msg,{icon:rdata.status?1:2});
					})
				}
			});
		},
		/**
        	* @description 设置ua黑/白名单
            * @param {String} type 数据类型
        */
		set_ua_white_view:function(type){
            var that = this;
            layer.open({
                type: 1,
                title: type == 'ua_white'? 'UA whitelist': 'UA blacklist',
                area: ['550px', '580px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="ua_name_table">\
                    <div class="waf-form-input">\
                        <input type="text" class="waf-input" name="ua_region" placeholder="E.g.:Mozilla">\
                        <button class="btn btn-success btn-sm va0 pull-right add_ua_region">Add</button>\
                    </div>\
                    <div id="ua_name_table"></div>\
                    <div class="waf-btn-group">\
                        <button class="btn btn-success va0 mr5 mt10 ua_import_url">Import</button>\
                        <button class="btn btn-success va0 mr5 mt10 ua_export_url">Export</button>\
                        <button class="btn btn-success va0 mr5 mt10 ua_empty">Empty</button>\
                    </div>\
                    <ul class="waf_tips_list mtl0 c7 ptb10">\
                        <li class="key">In the initialization phase, search for keywords in the client UA. Use with caution.</li>\
                        <li class="key">Can be used as a secret key in the API interface</li>\
                        <li class="key">If the keyword is found, skip any interception</li>\
                    </ul>\
                </div>',
                success:function(layero,index){
                    switch(type){
                        case 'ua_white':
                            that.render_ua_white();
                            break;
                        case 'ua_black':
                            that.render_ua_black();
                            break;
                    }
                    $('.add_ua_region').click(function(){
                        var ua_region = $('input[name=ua_region]').val(),pdata = {}
						if(ua_region == '') return layer.msg('Please enter a keyword',{icon:2})
						that.ajaxTask('add_'+type,type =='ua_white'?{ua_white:ua_region}:{ua_black:ua_region},function(res){
							if(res.status) {
								$('input[name=ua_region]').val('')
								that['render_'+type]();
							}
                            layer.msg(res.msg,{icon:res.status?1:2});
                        })
                    })
                    // 导入
					$('.ua_import_url').click(function(){
						that.import_or_export_pure_array_view(type,true);
					});
					// 导出
					$('.ua_export_url').click(function(){
						that.import_or_export_pure_array_view(type,false,that.ua_config_list);
					});
					//清空
					$('.ua_empty').click(function(){
					    that.empty_data_list(type)
					})
                }
            })
        },
		/**
        	* @description 规则显示页面
            * @param {Object} obj 数据类型
        */
		set_other_rule_one_view:function(obj){
			var _title = '',_pl = '',that = this;
			switch(obj.type){
				case 'url_white':
				    _title = 'Manage URL whitelist',_pl = 'URL address, supports regular expressions';
				     break;
                case 'url_black':
					_title = 'Manage Url blacklist',_pl = 'URL address, supports regular expressions';
				    break;
				case 'cdn':
					_title = 'Manage CDN-Headers【'+ obj.siteName +'】',_pl = 'header name';
				    break;
				case 'disable_upload_ext':
					_title = 'File types prohibited from uploading ['+ obj.siteName +' ]',_pl = 'Extension, without dot (.), E.g.: sql';
				    break;
				case 'disable_php_path':
					_title = 'URL address that prohibits running PHP ['+ obj.siteName +' ]',_pl = 'URL address, supports regular expressions';
				    break;
				case 'disable_path':
					_title = 'URL address prohibited ['+ obj.siteName +' ]',_pl = 'URL address, supports regular expressions';
				    break;
				case 'disable_ext':
					_title = 'Forbidden extension ['+ obj.siteName +' ]',_pl = 'Extension, without dot (.), E.g.: sql';
				    break;
                case 'api_defense':
					_title = 'API defence',_pl = 'E.g. : ^/api/getinfo$';
				    break;
                case 'key_words':
					_title = 'URL keyword blocking',_pl = 'E.g. : find.zip';
				    break;
			}
			layer.open({
				type: 1,
				title: _title,
				area: ['550px', '600px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="other_rule_table" style="padding:'+ ( obj.type =='url_white'?'0':'19px 15px') +';height: 100%">\
                        <div style="display:'+(obj.type =='url_white'? 'block':'none')+'">\
                            <div class="tab_list">\
                                <div class="tab_block active">[ General mode ] URL whitelist</div>\
                                <div class="tab_block">[ Enhanced mode ] URL whitelist</div></div>\
                            <div class="pd15 url_white">\
                                <div class="waf-form-input">\
                                    <input type="text" class="waf-input" name="rule_url_white" placeholder="'+ _pl +'" />\
                                    <button class="btn btn-success btn-sm va0 pull-right add_white_rule">Add</button>\
                                </div>\
                                <div id="white_rule_table"></div>\
                                <div class="waf-btn-group">\
                                    <button class="btn btn-success va0 mr5 mt10 white_import_url">Import</button>\
                                    <button class="btn btn-success va0 mr5 mt10 white_export_url">Export</button>\
                                    <button class="btn btn-success va0 mr5 mt10 empty_url_or_key">Empty</button>\
                                </div>\
                            </div>\
                            <div class="pd15 url_strong_white" style="display:none">\
                                <div class="waf-form-input">\
                                    <input type="text" class="waf-input" name="rule_url_white_strong" placeholder="'+ _pl +'" />\
                                    <button class="btn btn-success btn-sm va0 pull-right add_white_rule_strong">Add</button>\
                                </div>\
                                <div id="white_rule_strong_table"></div>\
                            </div>\
                            <ul class="waf_tips_list mtl0 c7" style="padding-left:15px">\
                                <li>All rules are invalid for URLs in the whitelist, excluding the IP blacklist.</li>\
                            </ul>\
                        </div>\
                        <div style="display:'+(obj.type !='url_white'? 'block':'none')+'">\
                            <div class="waf-form-input">\
                                <input type="text" class="waf-input" name="rule_url" placeholder="'+ _pl +'" />\
                                <button class="btn btn-success btn-sm va0 pull-right add_other_rule">Add</button>\
                            </div>\
                            <div id="other_rule_table"></div>\
                            <div class="waf-btn-group" style="display:'+( obj.type=='url_black'|| obj.type=='key_words'?'block':'none' )+'">\
                                <button class="btn btn-success va0 mr5 mt10 '+(obj.type == 'url_black'?'black_import_url':'key_import')+'">Import</button>\
                                <button class="btn btn-success va0 mr5 mt10 '+(obj.type == 'url_black'?'black_export_url':'key_export')+'">Export</button>\
                                <button class="btn btn-success va0 mr5 mt10 empty_url_or_key">Empty</button>\
                            </div>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='url_black'?'block':'none' )+'">\
                                <li>URL blacklist is forbidden to access, except when URL whitelist and IP whitelist exist.</li>\
                            </ul>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='cdn'?'block':'none' )+'">\
                                <li>The firewall will try to get the client IP in the above header</li>\
                            </ul>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='disable_upload_ext'?'block':'none' )+'">\
                                <li>Except for regular expression statements, rule values are not case sensitive, so lowercase is recommended</li>\
                                <li>Directly fill in the extension to be forbidden to access, such as I want to prohibit uploading of *.php files: php</li>\
                            </ul>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='disable_php_path' || obj.type=='disable_path'?'block':'none' )+'">\
                                <li>Except for regular expression statements, rule values are not case sensitive, so lowercase is recommended</li>\
                                <li>Please do not include URI parameters here, generally for the directory URL, example: /admin</li>\
							</ul>\
							<ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='disable_ext'?'block':'none' )+'">\
                                <li>Except for regular expression statements, rule values are not case sensitive, so lowercase is recommended</li>\
                                <li>Directly fill in the extension to be forbidden to access, such as I want to forbid access to *.sql file: sql</li>\
                            </ul>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='api_defense'?'block':'none' )+'">\
                                <li>API defense refers to the need for CC defense against certain interfaces when some APIs are whitelisted</li>\
                                <li>The example when writing API is as follows:^/api/getuserinfo$</li>\
                                <li>Note the writing. Must start with ^ and end with $</li>\
                            </ul>\
                            <ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+( obj.type=='key_words'?'block':'none' )+'">\
                                <li>URL interception during initialization</li>\
                            </ul>\
                        </div>\
					</div>',
				success:function(layero, index){
					var other_rule_msg = {'disable_upload_ext': 'Please enter the extension','disable_php_path': 'Please enter the URL address','disable_path': 'Please enter the URL address','disable_ext': 'Please enter the extension'}
					switch(obj.type){
						case 'url_white':
							that.render_url_white(0);
							break;
                        case 'url_black':
							that.render_url_black();
							break;
						case 'cdn':
							that.render_cdn_table({siteName:obj.siteName});
							break;
						case 'disable_upload_ext':
						case 'disable_php_path':
						case 'disable_path':
						case 'disable_ext':
							that.render_disable_other({siteName:obj.siteName,ruleName:obj.type});
							break;
                        case 'api_defense':
						case 'key_words':
							that.render_apiDefense_or_wordsKey({type:obj.type});
							break;
					}
					$('.add_other_rule').click(function(){
						var rule_url = $('[name=rule_url]');
						switch(obj.type){
							case 'url_black':
								if(rule_url.val() == '') return layer.msg('Please enter the URL address',{icon:2});
								that.ajaxTask('add_url_black',{url_rule:rule_url.val()},function(res){
									if(res.status) {
										rule_url.val('');
										that.render_url_black();
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
								break;
							case 'cdn':
								if(rule_url.val() == '') return layer.msg('Please enter Header',{icon:2});
								that.ajaxTask('add_site_cdn_header',{siteName:obj.siteName,cdn_header:rule_url.val()},function(res){
									if(res.status) {
										that.render_cdn_table({siteName:obj.siteName});
										rule_url.val('');
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
								break;
							case 'api_defense':
							case 'key_words':
								if(rule_url.val() == '') return layer.msg('Keywords cannot be empty',{icon:2});
								that.ajaxTask(obj.type == 'api_defense'?'add_url_white_chekc':'add_url_find',{url_find:rule_url.val()},function(res){
									if(res.status) {
										rule_url.val('');
										that.render_apiDefense_or_wordsKey({type:obj.type});
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
								break;
							case 'disable_upload_ext':
							case 'disable_php_path':
							case 'disable_path':
							case 'disable_ext':
								if(rule_url.val() == '') return layer.msg(other_rule_msg[obj.type],{icon:2});
								that.ajaxTask('add_site_rule',{siteName:obj.siteName,ruleName:obj.type,ruleValue:rule_url.val()},function(res){
									if(res.status){
										rule_url.val('');
										that.render_disable_other({siteName:obj.siteName,ruleName:obj.type});
									} 
									layer.msg(res.msg,{icon:res.status?1:2});
								});
								break;
						}
					});
                    $('.add_white_rule').click(function(){
                        var rule_url_white = $('[name=rule_url_white]');
						if(rule_url_white.val() == '') return layer.msg('Please enter the URL address',{icon:2});
                        that.ajaxTask('add_url_white',{url_rule:rule_url_white.val()},function(res){
							if(res.status){
								rule_url_white.val('');
								that.render_url_white(0);
							}
                            layer.msg(res.msg,{icon:res.status?1:2});
                        });
                    })
                    $('.add_white_rule_strong').click(function(){
                        var rule_url_white = $('[name=rule_url_white_strong]');
						if(rule_url_white.val() == '') return layer.msg('Please enter the URL address',{icon:2});
                        that.ajaxTask('golbls_cc_zeng',{text:rule_url_white.val()},function(res){
							if(res.status){
								rule_url_white.val('');
								that.render_url_white(1);
							}
                            layer.msg(res.msg,{icon:res.status?1:2});
                        });
                    })
                    //url白名单tab选项
                    $(".tab_list .tab_block").click(function(){
                        $(this).addClass('active').siblings().removeClass('active');
                        if($(this).index() == 0){
                            $('.url_white').show().next().hide();
							that.render_url_white(0);
                        }else{
                            $('.url_white').hide().next().show();
							that.render_url_white(1);
                        }
                    })
					// 导入
					$('.white_import_url,.black_import_url').click(function(){
						that.import_or_export_view(obj.type,true);
					});
					// 导出
					$('.white_export_url,.black_export_url').click(function(){
						that.import_or_export_view(obj.type,false,that.url_config_list);
					});
					// 关键词拦截
					$('.key_import').click(function(){
						that.import_or_export_pure_array_view(obj.type,true);
					});
					$('.key_export').click(function(){
						that.import_or_export_pure_array_view(obj.type,false,that.ua_config_list);
					});
					// 清空
					$('.empty_url_or_key').click(function(){
					    that.empty_data_list('uri_find')
					})
				}
			});
		},
		/**
        	* @description 设置扫描器视图
        */
		set_scan_rule_view:function(){
			var that = this;
			layer.open({
				type: 1,
				title: "Scanner Filtering Rules",
				area: ['600px', '530px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="waf-form scan_rule_form pd20">\
					<div class="waf-lines">\
						<span class="name-l">Header</span>\
						<div class="info-r">\
							<textarea name="scan_args" class="waf-input"></textarea>\
						</div>\
					</div>\
					<div class="waf-lines">\
						<span class="name-l">Cookie</span>\
						<div class="info-r">\
							<textarea name="scan_cookie" class="waf-input"></textarea>\
						</div>\
					</div>\
					<div class="waf-lines">\
						<span class="name-l">Args</span>\
						<div class="info-r">\
							<textarea name="scan_header" class="waf-input"></textarea>\
						</div>\
					</div>\
					<div class="waf-line-tips">\
						<ul class="waf_tips_list mtl0 c7 ptb10">\
							<li class="key">Both key and value will be filtered at the same time, please set it carefully.</li>\
							<li>Please use regular expressions and back up the original expressions before submitting.</li>\
						</ul>\
					</div>\
				</div>',
				btn:['Apply','Close'],
				success:function(index,layero){
					that.ajaxTask('get_rule',{ruleName:"scan_black"},function(res){
						$('[name=scan_args]').text(res.args);
						$('[name=scan_cookie]').text(res.cookie);
						$('[name=scan_header]').text(res.header);
					});
				},
				yes:function(layero,index){
					var scan_args = $('[name=scan_args]').val(),
						scan_cookie = $('[name=scan_cookie]').val(),
						scan_header = $('[name=scan_header]').val();
					that.ajaxTask('save_scan_rule',{header:scan_header,cookie:scan_cookie,args:scan_args},function(res){
						if(res.status) layer.close(layero)
						layer.msg(res.msg,{icon:res.status?1:2});
					});
				}
			});
		},
		/**
        	* @description 设置敏感文字替换视图
            * @param {Booleans} isBoolean 是否为站点
            * @param {String} site 站点名称
        */
        set_sensitive_text_view:function(isBoolean,site){
            var that = this;
            layer.open({
                type: 1,
				title: "Sensitive text replacement",
				area: ['550px', '400px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="sensitive_text_table pd20">\
                    <div class="waf-form-input">\
                        <input type="text" class="waf-input" name="sensitive_text" placeholder="Sensitive text" style="width: 215px;">\
                        <input type="text" class="waf-input" name="replace_text" placeholder="Replaced text" style="width: 215px;">\
                        <button class="btn btn-success btn-sm va0 pull-right add_replace">Add</button>\
                    </div>\
                    <div id="sensitive_text_table"></div>\
                    <ul class="waf_tips_list mtl0 c7 ptb10">\
                        <li>Support regular matching (lua regular) ranking, the higher the weight</li>\
                        <li>Please do not fill in randomly, it may cause the entire site to be blank</li>\
                    </ul>\
                </div>',
                success:function(layers,index){
                    // 渲染表格
                    that.render_sansitive_table({isBoolean:isBoolean,site:site});
                    // 添加
                    $(".add_replace").click(function(){
                        var _sen = $('[name=sensitive_text]'),_rep= $('[name=replace_text]');
						if(_sen.val() == '' || _rep.val() == '') return layer.msg('Please enter sensitive text or alternative text',{icon:2})
						that.ajaxTask(isBoolean?'add_body_site_rule':'add_body_rule',{text:_sen.val(),text2:_rep.val(),siteName:site},function(res){
                            if(res.status){
								_sen.val('');_rep.val('');
								if(site){
									$.post('/plugin?action=a&name=btwaf&s=get_site_config_byname',{siteName:site},function(rdata){
										that.site_config = rdata;
                                	})
                                }else{
									$.post('/plugin?action=a&name=btwaf&s=get_config',function(rdata){
										that.overall_config = rdata;
                                	})
                                }
                                setTimeout(function(){
									that.render_sansitive_table({site:site});
								}, 500);
                            }
							layer.msg(res.msg,{icon:res.status?1:2});
						})
                    })
                }
            })
        },
		/**
			* @description 设置违禁词拦截视图
		    * @param {object} obj 站点名称
		    *
		*/
		set_body_intercept_view:function(obj){
		    var that = this;
		    layer.open({
		        type: 1,
				title: "illegal word block",
				area: ['550px', '430px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="sensitive_text_table pd20" style="height:100%;">\
		            <div class="waf-form-input">\
		                <input type="text" class="waf-input" name="body_intercept" placeholder="Illegal words" style="width: 430px;">\
                        <button class="btn btn-success btn-sm va0 pull-right add_body_intercept">Add</button>\
		            </div>\
		            <div id="body_intercept_table"></div>\
		            <div class="waf-btn-group">\
                         <button class="btn btn-success va0 mr5 mt10 import_body_intercept">Import</button>\
                         <button class="btn btn-success va0 mr5 mt10 export_body_intercept">Export</button>\
                         <button class="btn btn-success va0 mr5 mt10 empty_body_intercept">Empty</button>\
                    </div>\
		            <ul class="waf_tips_list mtl0 c7 ptb10">\
                        <li>Please do not fill in randomly, all prohibited words are suggested to be a complete word</li>\
		            </ul>\
		        </div>',
		        success:function(layers,index){
		            that.render_body_intercept_table();// 渲染表格
		            // 添加
		            $(".add_body_intercept").click(function(){
		                var _ban = $('[name=body_intercept]');
						if(_ban.val() == '') return layer.msg('Please enter an illegal word',{icon:2})
						that.ajaxTask('add_body_intercept',{text:_ban.val()},function(res){
							if(res.status){
								_ban.val('');
								that.render_body_intercept_table();// 渲染表格
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
		            });
					// 导入
					$('.import_body_intercept').click(function(){
						that.import_or_export_body_intercept_view(obj.type,true);
					});
					// 导出
					$('.export_body_intercept').click(function(){
						that.import_or_export_body_intercept_view(obj.type,false,that.ban_word_list);
					});
					// 清空
					$('.empty_body_intercept').click(function(){
						var _ban_data = that.ban_word_list;
						if (_ban_data == []) layer.msg('The current illegal word is empty',{icon:2})
						layer.confirm('Whether to clear the list data', { title: 'clear the list',closeBtn:2,icon:0}, function () {
						    that.ajaxTask('empty_body_intercept',{text:_ban_data},function(res){
    							if(res.status){
    								_ban_data = [];
    								that.render_body_intercept_table();// 渲染表格
    							}
    							layer.msg(res.msg,{icon:res.status?1:2});
    						});  
						})
					});
		        }
		    })
		},
		/**
        	* @description 设置站点配置视图
            * @param {Object} obj 站点名称
        */
		set_site_config_view:function(obj,callback){
			var that = this;
			layer.open({
                type: 1,
                title: "Website configuration [ "+ obj.siteName +" ]",
                area: ['860px','610px'],
                closeBtn: 2,
                shadeClose: false,
                content:'<div class="waf_site_body pd20">\
					<div class="waf_head_view">\
						<span class="pull-left" style="font-weight: 400;font-size: 16px;margin-right: 10px;">Website firewall switch</span>\
						<div class="waf-switch pull-left">\
							<input class="btswitch btswitch-ios" id="waf_swicth_site" type="checkbox">\
							<label class="btswitch-btn" for="waf_swicth_site" onclick="bt_waf.waf_switch_site(\''+ obj.siteName + '\')"></label>\
						</div>\
					</div>\
					<div id="site_config_table"></div>\
					<ul class="waf_tips_list mtl0 c7 ptb10">\
						<li>Note: Most of the configurations here are only valid for the current site!</li>\
					</ul>\
				</div>',
				success:function(index,layero){
					that.render_site_config(obj,function(res){
						$('#waf_swicth_site').prop("checked",res.open)
					});
				}
			});
		},
		/**
        	* @description 设置受保护的URI地址
            * @param {Object} obj 站点名称,规则名称
        */
		set_defend_url_view:function(obj){
			var that = this;
			layer.open({
				type: 1,
				title: 'Protected URI address ['+obj.siteName+' ]',
				area: ['550px', '662px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="defend_url_view" style="padding:25px 15px;height: 100%;">\
                        <div><div class="waf-form-input">\
                                <input type="text" class="waf-input" name="url_defend_address" placeholder="URI address, support regular expression" style="margin-right:10px;width:200px"/>\
                                <input type="text" class="waf-input" name="url_defend_name" placeholder="Parameter name" style="margin-right:10px; width:110px"/>\
                                <input type="text" class="waf-input" name="url_defend_value" placeholder="Parameter value" style="width:110px"/>\
                                <button class="btn btn-success btn-sm va0 pull-right add_defend_region">Add</button>\
                            </div>\
                            <div id="defend_url_table"></div>\
                            <ul class="waf_tips_list mtl0 c7 ptb10">\
                                <li>It can be used to protect the website backend address, API interface and other non-public URI addresses from being infiltrated</li>\
                                <li>Parameter names and parameter values are case sensitive</li>\
                                <li>Set a protected URL: The URL must be accessed with the specified parameter name and parameter value, otherwise it will be blocked by the firewall</li>\
                                <li>Assuming URI address: ^/admin/admin.php Parameter name: test Parameter value: bt.cn</li>\
                                <li>The right way to access: /admin/admin.php?test=bt.cn</li>\
                            </ul>\
                        </div>\
					</div>',
				success:function(layero, index){
					// 初次触发
					that.render_defend_url_table({siteName:obj.siteName,ruleName:'url_tell'})
					// 添加事件
					$('.add_defend_region').click(function(){
						var _address = $('[name=url_defend_address]'), 
							_name = $('[name=url_defend_name]'), 
							_val = $('[name=url_defend_value]')
						if(_address.val() == '' || _name.val() == '' || _val.val() == '') return layer.msg('请输入地址或参数',{icon:2});
						that.ajaxTask('add_site_rule',{
							siteName:obj.siteName,
							ruleName:'url_tell',
							ruleUri:_address.val(),
							ruleValue:_name.val(),
							rulePass:_val.val()
						},function(res){
							if(res.status){
								that.render_defend_url_table({siteName:obj.siteName,ruleName:'url_tell'});
								_address.val('');_name.val('');_val.val('');
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					})
				}
			});
		},
		/**
        	* @description 设置URL专用过滤
            * @param {Object} obj 站点名称,规则名称
        */
		set_url_special_filter_view:function(obj){
			var that = this;
			layer.open({
				type: 1,
				title: 'URL dedicated filtering ['+obj.siteName+' ]',
				area: ['550px', '550px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="url_special_filter_table" style="padding:24px 15px">\
                        <div><div class="waf-form-input">\
                                <input type="text" class="waf-input" name="url_filter_address" placeholder="URI address, support regular expression" style="margin-right:10px;width:215px"/>\
                                <input type="text" class="waf-input" name="url_filter_rule" placeholder="Filter rules, please use regular expressions" style="width:215px"/>\
                                <button class="btn btn-success btn-sm va0 pull-right add_filter_rule">Add</button>\
                            </div>\
                            <div id="url_special_filter_table"></div>\
                            <ul class="waf_tips_list mtl0 c7 ptb10">\
                                <li>It can be used to strengthen the protection of login entrances, reply comments and other interfaces, and quickly patch security vulnerabilities in third-party programs</li>\
                                <li>Parameter names and parameter values are case sensitive</li>\
                                <li>This filter acts on both GET and POST parameters</li>\
                            </ul>\
                        </div>\
					</div>',
				success:function(layero, index){
					// 初次触发
					that.render_url_filter_table({siteName:obj.siteName,ruleName:'url_rule'})
					// 添加事件
					$('.add_filter_rule').click(function(){
						var _address = $('[name=url_filter_address]'), _rule = $('[name=url_filter_rule]');
						if(_address.val() == '' || _rule.val() == '')return layer.msg('Please enter an address or filter rule');
						that.ajaxTask('add_site_rule',{
							siteName:obj.siteName,
							ruleName:'url_rule',
							ruleValue:_rule.val(),
							ruleUri:_address.val()
						},function(res){
							if(res.status){
								that.render_url_filter_table({siteName:obj.siteName,ruleName:'url_rule'});
								_address.val('');_rule.val('');
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					})
				}
			});
		},
		/**
        	* @description 设置站点规则视图
            * @param {Object} obj 站点名称,规则名称
        */ 
		set_site_rule_view:function(obj,callback){
			var that = this;
			layer.open({
				type: 1,
				title: "Edit site rules ["+ obj.siteName +"] - [ "+ obj.name +" ]",
				area: ['800px', '600px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="other_table">\
							<div id="site_rule_table"></div>\
							<ul class="help-info-text c7 ptb10">\
								<li>Here inherit the enabled rules in the global settings</li>\
								<li>The settings here are only valid for the current site</li>\
							</ul>\
						</div>',
				success:function(layer,index){
					that.render_site_rule({siteName:obj.siteName,ruleName:obj.ruleName});
				}
			});
		},
		/**
        	* @description HTTP请求过滤视图
        */ 
		set_http_rule_view:function(){
			var that = this;
			layer.open({
				type: 1,
				title: 'HTTP request filtering',
				area: ['550px', '530px'],
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="http_rule_table" style="padding:0">\
						<div class="tab_list">\
							<div class="tab_block active">Request type filtering</div>\
							<div class="tab_block">Request header filtering</div>\
							<div class="tab_block">Semantic Analysis</div></div>\
						<div class="pd15 http_filtering tabs_box">\
							<div id="http_filtering_table"></div>\
						</div>\
						<div class="pd15 header_filtering tabs_box" style="display:none">\
							<div class="waf-form-input">\
								<input type="text" class="waf-input" name="rule_header_filtering" style="width: 350px;" placeholder="Please enter the header name" />\
								<input type="number" class="waf-input" name="rule_header_length" placeholder="Length" style="width: 95px;"/>\
								<button class="btn btn-success btn-sm va0 pull-right add_header_filtering">Add</button>\
							</div>\
							<div id="header_filtering_table"></div>\
						</div>\
						<div class="pd15 statement_analyze tabs_box" style="display:none">\
							<div id="statement_analyze_table"></div>\
						</div>\
					</div>',
				success:function(){
					//  选项卡切换
					$(".tab_list .tab_block").click(function(){
						$(this).addClass('active').siblings().removeClass('active');
						if($(this).index() == 0){
							$('.http_filtering').show().siblings('.tabs_box').hide();
							that.render_http_rule_view(0);
						}else if($(this).index() == 1){
							$('.header_filtering').show().siblings('.tabs_box').hide();
							that.render_http_rule_view(1);
						}else{
							$('.statement_analyze').show().siblings('.tabs_box').hide();
							that.render_http_rule_view(2);
						}
					})
					that.render_http_rule_view(0);
					
					//请求头添加
					$('.add_header_filtering').click(function(){
						var header_ = $('[name=rule_header_filtering]'),
							len_ = $('[name=rule_header_length]');
						if(header_.val() == '')return layer.msg('Request type cannot be empty',{icon:2});
						if(len_.val() == '')return layer.msg('Length cannot be empty',{icon:2});
						that.ajaxTask('add_header_len',{header_type:header_.val(),header_type_len:len_.val()},function(res){
							if(res.status){
								header_.val(''); len_.val('');
								that.refresh_data_total('overall')
								setTimeout(function(){that.render_http_rule_view(1);},200)
							}
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					})
				}
			})
		},
		/**
        	* @description 站点防盗链视图
            * @param {Object} obj 站点名称,站点id
        */ 
		set_hotlinking_view:function(obj){
			var that = this;
			layer.open({
				type: 1,
				title: "Anti-leech setting",
				area: '600px',
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="bt-form pd20">\
					<div class="line">\
						<span class="tname">URL suffix</span>\
						<div class="info-r"><input name="sec_fix" class="bt-input-text mr5 sec_fix" type="text" style="width:360px"></div>\
					</div>\
					<div class="line">\
						<span class="tname">Allow domain names</span>\
						<div class="info-r"><input name="sec_domains" class="bt-input-text mr5 sec_domains" type="text" style="width:360px"></div>\
					</div>\
					<div class="line label-input-group">\
						<span class="tname"> </span>\
						<div class="info-r ">\
							<input type="checkbox" class="hotlinking_status" id="hotlinking_status" name="hotlinking_status">\
							<label class="mr20" for="hotlinking_status" style="font-weight:normal">Enable anti-leech</label>\
							<input type="checkbox" class="hotlinking_none" id="hotlinking_none" name="hotlinking_none">\
							<label class="mr20" for="hotlinking_none" style="font-weight:normal">Allow empty HTTP_REFERER requests</label>\
						</div>\
					</div>\
					<ul class="help-info-text c7"><li>By default, resources are allowed to be directly accessed, that is, requests with empty HTTP_REFERER are not restricted</li><li>Please use a comma (,) to separate multiple URL suffixes and domain names, E.g.: png,jpeg,zip,js</li><li>When the anti-leech chain is triggered, it will directly return to the 404 status</li></ul>\
					</div>',
				success:function(){
					that.get_hotlinking_data(obj);
					$('#hotlinking_status').click(function(){
						var loadTa = layer.msg('Turning on anti-leech setting...', { time: 0, icon: 16, shade: [0.3, '#000'] });
						$.post('/site?action=SetSecurity',{
							id: obj.id,
							name: obj.siteName,
							fix: $('input[name=sec_fix]').val(),
							domains: obj.siteName,
							status: $(this).prop('checked')},function(res){
								layer.close(loadTa);
								if(res.status) that.get_hotlinking_data(obj);
								layer.msg(res.msg,{icon:res.status?1:2})
						})
					})
					$('#hotlinking_none').click(function(){
						var loadTs = layer.msg('Submitting anti-leech configuration...', { time: 0, icon: 16, shade: [0.3, '#000'] });
						$.post('/site?action=SetSecurity',{
							id: obj.id,
							name: obj.siteName,
							fix: $('input[name=sec_fix]').val(),
							domains: obj.siteName,
							status: '1'},function(res){
								layer.close(loadTs);
								if(res.status) that.get_hotlinking_data(obj);
								layer.msg(res.msg,{icon:res.status?1:2})
						})
					})
				}
			})
		},
        /**
        	* @description 获取站点日志视图
            * @param {Object} row 当前站点对象数据
            * @param {Object} dateList 日志列表
        */ 
		get_site_logs_view:function(row,dateList){
			var that = this;
			layer.open({
				type: 1,
				title: "Website Logs-[ "+ row.siteName +" ]",
				area: ['900px', '660px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="site_logs_table">\
							<div class="waf_date_select">\
								<div class="waf-title">Select Date：</div>\
								<div class="waf-unselect">\
									<div class="waf-inputs"><div class="waf-inputs-tips">'+ dateList[0] +'</div></div>\
									<dl class="waf-input-list" data-val="'+ dateList[0] +'"></dl>\
								</div>\
							</div>\
							<div id="site_logs_table"></div>\
							<div class="site_logs_page waf_page"></div>\
						</div>',
				success:function(layero,index){
					var _html = '';
					for(var i=0;i<dateList.length;i++){
						_html += '<dd waf-data="'+ dateList[i] +'" '+ ( i==0?'class="waf_checked"':'' ) +'>'+ dateList[i] +'</dd>';
					}
					$('.waf-unselect .waf-input-list').html(_html);
					$('.waf-unselect .waf-inputs').click(function(e){
						if(!$(this).parent().hasClass('active')){
							$(this).parent().addClass('active');
						}else{
							$(this).parent().removeClass('active');
						}
						$(document).unbind('click').click(function(e){
							$('.waf-unselect').removeClass('active');
							$(this).unbind('click');
						});
						e.stopPropagation();
						e.preventDefault();
					});
					$('.waf-input-list dd').click(function(e){
						var _val = $(this).attr('waf-data');
						$(this).addClass('waf_checked').siblings().removeClass('waf_checked');
						$(this).parent().attr('data-val',_val);
						$(this).parent().prev().find('.waf-inputs-tips').html(_val);
						that.render_site_logs({siteName:row.siteName,toDate:_val,p:1});
					});
					that.render_site_logs({siteName:row.siteName,toDate:dateList[0],p:1});
				}
			})
		},
		/**
        	* @description 日志跳转页面
            * @param {String} p 页数
        */ 
		get_gl_table_page:function(p){
			if(p == undefined) p=1
			this.render_logs_data({p:p,tojs:'bt_waf.get_gl_table_page'});
		},
		/**
        	* @description 站点防盗链数据获取
            * @param {Object} obj 站点名称,站点id
        */ 
		get_hotlinking_data:function(obj){
			var that = this;
			var loadT = layer.msg('Getting anti-hotlink settings...', { time: 0, icon: 16, shade: [0.3, '#000'] });
			$.post('/site?action=GetSecurity',{name:obj.siteName,id:obj.id},function(res){
				layer.close(loadT);
				$('input[name=sec_fix]').val(res.fix);
				$('input[name=sec_domains]').val(res.domains);
				$('#hotlinking_status').attr('checked',res.status)
				$('#hotlinking_none').attr('checked',res.none)
			})
		},
		/**
		 * @descripttion  添加/修改状态码
		 * @param {Booleans} is_creat   是否为添加
		 * @param {Object} data   修改时原本的数据
		 * @return: 无返回值
		 */
		open_code_view_dialog:function(is_creat,data){
			var that = this;
			layer.open({
				type: 1,
				title: (is_creat?'Add':'Edit')+' status code',
				area: '350px',
				closeBtn: 2,
				btn:[(is_creat?'Add':'Edit'),' Cancel'],
				content:'<div class="waf-form pd20">\
							<div class="waf-line waf_one">\
								<span class="name-l">Status Code</span>\
								<div class="info-r">\
									<select id="staticStatusCode" class="bt-input-text mr5" style="width: 80px;" '+(is_creat?'':'disabled="disabled"')+'></select>\
								</div>\
							</div>\
							<div class="waf-line waf_one">\
								<span class="name-l">Blocking state</span>\
								<div class="info-r">\
									<select id="interceptCode" class="bt-input-text mr5" style="width: 80px;"></select>\
								</div>\
							</div>\
						</div>',
				success:function(){
					var code_from = ["403","404","500","501","502"],
						code_to = ["444","500","501","502","503","400","401","404"],
						cf_html = '',
						ct_html = '';
					$.each(code_from,function(index,item){
						cf_html+='<option value="'+item+'">'+item+'</option>';
					})
					$.each(code_to,function(index,item){
						ct_html+='<option value="'+item+'">'+(item == '444'?'拦截':item)+'</option>'
					})

					$('#staticStatusCode').html(cf_html)
					$('#interceptCode').html(ct_html)
					if(!is_creat){
						$('#staticStatusCode').val(data['code']);
						$('#interceptCode').val(data['status']);
					}
				},
				yes:function(index,layero){
					that.ajaxTask(is_creat?'add_static_code_config':'edit_static_code_config',{code_from:$('#staticStatusCode').val(),code_to:$('#interceptCode').val()},function(res){
						if(res.status){
							layer.close(index);
							that.render_static_code_list();
						}
						layer.msg(res.msg,{icon:res.status?1:2})
					})
				}
			})
		},
		/**
		* @descripttion 清理站点/封锁历史日志
		* @return: 无返回值
		*/
		clean_site_or_history_log:function(_type){
			var that = this,_selection = [],_isall = false;
			switch(_type){
				case 'site':
					layer.open({
						type: 1,
						title: 'Clean up site logs',
						area: '450px',
						closeBtn:2,
						skin:'clean_log_data',
						btn:['Clean','Cancel'],
						content: '<div class="waf-form pd20">\
							<div class="waf-line is_clean_site">\
								<span class="name-l">WebSite</span>\
								<div class="info-r"><div class="select-menu"></div></div>\
							</div>\
						</div>',
						success:function(){
							bt_waf.select({
								el:'.select-menu',
								method:'get_site_config',
								data:{},
								config:{width: 260,placeholder:'Please select a website',ischeck:true,issearch:true},
								dataFilter:function(Fdata){
									var _arry = [];
									$.each(Fdata,function(index,item){
										_arry.push([item['siteName'],item['siteName']])
									})
									return _arry;
								},
								formatRepoSelection:function(list,isall){
									_selection = list;
									_isall = isall;
								}
							})
						},
						yes:function(index,layero){
							if(_selection.length<=0) return layer.msg('Please select a website',{icon:0})
							that.ajaxTask('remove_log',{safe_logs:0,site_all:_isall?1:0,site_logs:JSON.stringify(_isall?[]:_selection)},function(res){
								if(res.status) layer.close(index);
								layer.msg(res.msg,{icon:res.status?1:2})
							})
						}
					})
				break;
				case 'history':
					layer.confirm('Whether to delete all log data in the block history',{title:'Clean up the log',closeBtn:2,icon:0}, function(){
						that.ajaxTask('remove_log',{safe_logs:1,site_all:0,site_logs:JSON.stringify([])},function(res){
							layer.msg(res.msg,{icon:res.status?1:2})
						})
					})
				break;
			}
		},
		/**
        	* @description 导出导入视图
            * @param {String} type IP/URL黑白名单
            * @param {Booleans} data 是否导入
            * @param {String} ip_data 导出的数据
        */
		import_or_export_view:function(type,data,ip_data){
            var that = this,_name = '';
			if(type.indexOf("ip_") == 0){
				_name = "IP"+(type=='ip_white'?'white':'black')+"list";
			}else if(type.indexOf("url_") == 0){
				_name = "URL"+(type=='url_white'?'white':'black')+"list";
			}else{
			    _name ="Deny "+(type=='drop_abroad'?'oversea':'china')+" access";
			}
			layer.open({
				type: 1,
				title:(data?'Import':'Export')+ _name,
				area: ['400px', '390px'],
				closeBtn: 2,
				shadeClose: false,
				btn:[(data?'Confirm':'Export configuration file'),'Cancel'],
				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" placeholder="" name="config">'+ (ip_data != undefined?JSON.stringify(ip_data):'') +'</textarea></div>',
				success:function(){
				    var _placeText = '';
				    // 当导入为url黑白名单时
				    if(data){
				        if(type.indexOf("url_") == 0){
				            _placeText = 'Import format：["^/test","^/web"]';
				        }else if(type.indexOf("ip_") == 0){
				            _placeText = 'Import format：[["192.168.1.1","192.168.1.2"],["127.0.0.1","127.0.0.255"]]'
				        }else{
				            _placeText = 'Import format：[["192.168.1.1","192.168.1.2"],["192.168.33.","192.168.1.99"]]'
				        }
				    }else{
				        _placeText = ''
				    }
			        $('[name=config]').attr('placeholder',_placeText)
				},
				yes:function(layero,index){
					var _config = $('[name=config]').val();
					if(data){
						if(_config == '')return layer.msg('Import data cannot be empty',{icon:2})
						if(type == 'drop_abroad'|| type =='drop_china') type = 'cn'
						that.ajaxTask('import_data',{s_Name:type,pdata:_config},function(res){
							if(res.status){
								setTimeout(function(){
									layer.close(layero)
                                    if(type == 'ip_white'){that.render_ip_white()}
                                    if(type == 'ip_black'){$('.ip_region_table .tab_list .tab_block:eq(0)').click();}
                                    if(type == 'url_white'){$('.other_rule_table .tab_list .tab_block:eq(0)').click();}
                                    if(type == 'url_black'){that.render_url_black()}
                                    if(type == 'drop_abroad' || type == 'drop_china'){that.render_drop_abroad()}
                                },1000)
                            } 
							layer.msg(res.msg,{icon:res.status?1:2});
						});
					}else{
						that.render_download_link(_config,  type+'.json');
					}
					return false;
				}
			});
		},
		/**
		 * @description 导出导入视图【ua黑白名单，url关键词拦截】
		 * @param {String} type 类型
		 * @param {Booleans} data 是否导出
		 * @param {String} ban_data 导出的数据
		 */
		import_or_export_pure_array_view:function(type,data,other_data){
		    var that = this,_name = '';
		    if(type == 'ua_black'){
		        _name = 'UA blacklist'
		    }else if(type == 'ua_white'){
		        _name = 'UA whitelist'
		    }else{
		        _name = 'URL keyword blocking'
		    }
		    layer.open({
				type: 1,
				title:(data?'Import':'Export')+ _name,
				area: ['400px', '390px'],
				closeBtn: 2,
				shadeClose: false,
				btn:[(data?'Confirm':'Export to file'),'Cancel'],
				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" placeholder="'+(data?'Import format:[&#34;text&#34;,&#34;json&#34;]':'')+'" name="other">'+ (other_data != undefined?JSON.stringify(other_data):'') +'</textarea></div>',
				yes:function(layero,index){
					var _other = $('[name=other]').val();
				    if(data){
			            if(_other == '') return layer.msg('Import data cannot be empty',{icon:2})
				        that.ajaxTask(type == 'ua_black'?'add_black_list':(type == 'ua_white'?'add_ua_list':'add_url_list'),{pdata:_other},function(res){
    						if(res.status){
    							setTimeout(function(){
    								layer.close(layero)
    								if(type == 'ua_black') that.render_ua_black();
    								if(type == 'ua_white') that.render_ua_white();
    								if(type == 'key_words') that.render_apiDefense_or_wordsKey(type);
    							},1000)
    						}
    						layer.msg(res.msg,{icon:res.status?1:2});
    					});
				    }else{
				        that.render_download_link(_other,  type+'.json');
				    }
				}
			});
		},
		/**
		 * @description 违禁词导出导入视图
		 * @param {String} type 违禁词拦截
		 * @param {Booleans} data 是否导入
		 * @param {String} ban_data 导出的数据
		 */
		import_or_export_body_intercept_view:function(types,data,ban_data){
			var that = this,_name ="Illegal words";
			layer.open({
				type: 1,
				title:(data?'Import':'Export')+ _name,
				area: ['400px', '390px'],
				closeBtn: 2,
				shadeClose: false,
				btn:[(data?'Confirm':'Export'),'Cancel'],
				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" placeholder="'+(data?'Import format:One per line, if entered on the same line, it is regarded as one':'')+'" name="ban">'+ (ban_data != undefined?((ban_data.toString()).replace(/[,，]/g,"\n")):'') +'</textarea></div>',
				yes:function(layero,index){
					var _ban = $('[name=ban]').val();
					if(data){
				        if(_ban == '')return layer.msg('Import data cannot be empty',{icon:2})
					    that.ajaxTask('import_body_intercept',{text:_ban},function(res){
    						if(res.status){
    							setTimeout(function(){
    								layer.close(layero)
    								that.render_body_intercept_table();  //渲染表格
    							},1000)
    						}
    						layer.msg(res.msg,{icon:res.status?1:2});
    					});
					}else{
					    that.render_download_link(_ban, 'banned.json');
					}
				}
			});
		},
		/**
		* @descripttion 导入导出蜘蛛池
		* @param {String} param
		* @param {String} type
		* @param {String} data
		* @return: 无返回值
		*/
		import_or_export_spider_view:function(param,type,data){
			var that = this;
			layer.open({
				type: 1,
				title:(type?'Import':'Export')+ 'Spider pool data',
				area: ['400px', '390px'],
				closeBtn: 2,
				shadeClose: false,
				btn:[(type?'Confirm':'Export to file'),'Cancel'],
				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" placeholder="'+(type?'Import format:[&#34;192.168.1.1&#34;,&#34;192.168.1.2&#34;]':'')+'" name="config">'+ (data != undefined?JSON.stringify(data):'') +'</textarea></div>',
				yes:function(layero,index){
					var _config = $('[name=config]').val();
					if(type){
						if(_config == '')return layer.msg('Import data cannot be empty',{icon:2})
						layer.confirm('<span style="color:red">Importing errors will cause spider crawling to fail. Non-professionals should not operate.</span>',{title:'Import data confirmation',closeBtn:2,icon:0}, function () {
							that.ajaxTask('import_spider',{spider:param,ip_list:_config},function(res){
							setTimeout(function(){
								layer.close(layero)
								that.render_spider_list(param)
							},1000)
    						layer.msg(res.msg,{icon:res.status?1:2});
						})
						})
					}else{
						that.render_download_link(_config, 'spider.json');
					}
				}
			});
		},
		/**
			* @description 导出/导入防火墙配置
        */
		import_or_export_waf_config:function(is_import,config){
			var that = this,passkey = '',btn = []
			if(is_import) passkey = config
			layer.open({
				type: 1,
				title:(is_import?'Export':'Import')+ 'Firewall global configuration',
				area: ['600px', is_import?'480px':'400px'],
				closeBtn: 2,
				shadeClose: false,
				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" placeholder="'+(is_import?'':'Please paste the encrypted configuration text here')+'" name="ban">'+ passkey +'</textarea><button class="btn btn-success changeCopykeys" style="font-size: 12px;padding: 5px 12px;margin-top: 5px;display:'+(is_import?'inline-block':'none')+';">Copy</button><button class="btn btn-success import_or_export_keys" style="font-size: 12px;padding: 5px 12px;margin: 5px 0 0 5px;">'+(is_import?'Download':'Import')+'</button><ul class="waf_tips_list mtl0 c7 ptb10" style="display:'+(is_import?'block':'none')+';"><li>Only export global configuration (CC configuration, malicious request tolerance configuration, IP black and white list, UA black and white list, URL black and white list, sensitive text replacement, URL keyword blocking), excluding firewall website configuration</li><li>GET, POST, URL, UA, Cookie only export response code and switch status, do not include internal rules</li><li>It is recommended to use the copy or download button, the key may be missed if copy is selected</li></ul></div>',
				success:function(){
					// 复制
					$('.changeCopykeys').click(function(){
						bt.pub.copy_pass(passkey);
					})
					// 导出下载
					$('.import_or_export_keys').click(function(){
						switch($(this).text()){
							case 'Import':
								var _ban = $('[name=ban]').val();
								if(_ban == '')return layer.msg('Import data cannot be empty',{icon:2})
								that.ajaxTask('import_sesings',{backup_data:_ban},function(res){
									if(res.status){
										setTimeout(function(){
											layer.close(layero)
											that.refresh_data_total('home');
										},1000)
									}
									layer.msg(res.msg,{icon:res.status?1:2});
								});
								break;
							case 'Download':
							that.render_download_link(_ban, 'waf_config.json');
								break;
						}
					})
				}
			});
		},
		/**
        	* @description 导出封is_import锁列表数据
        */
		export_block_view:function(){
		    var that = this;
		    this.ajaxTask('import_ip_data',function(data){
                layer.open({
    		        type:1,
    		        title:'Export blocked IP list',
    		        area: ['400px', '390px'],
    				closeBtn: 2,
    				shadeClose: false,
    				btn:['Export to file','Cancel'],
    				content:'<div class="pd20"><textarea rows="15" style="padding:5px 10px;width:100%;height:100%;border-radius:2px;border:1px solid #ccc;" name="ip_block_list">'+ JSON.stringify(data) +'</textarea></div>',
    				yes:function(layero,index){
    				    that.render_download_link(data, 'BlockedIPs.json');
    				}
    		    })
		    })
		},
		/**
        	* @description 清空数据列表
        */
		empty_data_list:function(type){
		    var that = this;
		    layer.confirm('Whether to clear the list data', { title: 'clear the list',closeBtn:2,icon:0}, function () {
				that.ajaxTask('empty_data',{type:type},function(res){
					if(res.status){
					    switch(type){
					        case 'ua_white':
                                that.render_ua_white();
                                break;
                            case 'ua_black':
                                that.render_ua_black();
                                break;
                            case 'ip_white':
    							that.render_ip_white();
    						    break;
    						case 'ip_black':
    							that.render_ip_black(0);
    						    break;
                            case 'url_white':
    							that.render_url_white(0);
    							break;
                            case 'url_black':
    							that.render_url_black();
                            case 'key_words':
    							that.render_apiDefense_or_wordsKey({type:type});
    							break;
                            case 'uri_find':
    							that.render_apiDefense_or_wordsKey({type:'key_words'});
    							break;
					    }
					}
					layer.msg(res.msg,{icon:res.status?1:2});
				});
			});
		},
		/**
        	* @description 渲染下载链接
            * @param {String} content 下载内容
            * @param {String} filename 文件名称
        */
		render_download_link:function(content, filename) {
			// 创建隐藏的可下载链接
			var eleLink = document.createElement('a');
			eleLink.download = filename;
			eleLink.style.display = 'none';
			// 字符内容转变成blob地址
			var blob = new Blob([content]);
			eleLink.href = URL.createObjectURL(blob);
			// 触发点击
			document.body.appendChild(eleLink);
			eleLink.click();
			// 然后移除
			document.body.removeChild(eleLink);
		},
		/**
        	* @description 全局防火墙开关按钮
        */
		waf_switch:function(){
			this.ajaxTask('set_open',function(res){
				layer.msg(res.msg,{icon:res.status?1:2})
			})
		},
		/**
        	* @description 站点防火墙开关
            * @param {Object} obj 站点名称
        */
		waf_switch_site:function(obj){
			var that = this;
			this.ajaxTask('set_site_obj_open',{siteName:obj,obj:'open'},function(res){
				if(res.status) that.refresh_data_total('site');
				layer.msg(res.msg,{icon:res.status?1:2});
			});
		},
        /**
			* 添加收件者邮箱
		*/
		add_receive_info:function(){
			var that = this;
			layer.open({
				type: 1,
				area: "400px",
				title: "Add recipient email",
				closeBtn: 2,
				shadeClose: false,
				content: '<div class="bt-form pd20 pb70">\
					<div class="line">\
						<span class="tname">Recipient Email</span>\
						<div class="info-r">\
							<input name="creater_email_value" class="bt-input-text mr5" type="text" style="width: 240px" value="">\
						</div>\
					</div>\
					<div class="bt-form-submit-btn">\
						<button type="button" class="btn btn-danger btn-sm smtp_closeBtn">Close</button>\
						<button class="btn btn-success btn-sm CreaterReceive">Create</button>\
					</div>\
					</div>',
				success:function(layers,index){
					$(".CreaterReceive").click(function(){
						var _receive = $('input[name=creater_email_value]').val();
						if(_receive != ''){
							var loadT = layer.msg('Creating recipient list, please wait...', { icon: 16, time: 0, shade: [0.3, '#000'] });
							$.post('/config?action=add_mail_address',{email:_receive},function(rdata){
								layer.close(loadT);
								// 刷新收件者列表
								if(rdata.status){
									layer.close(index)
									that.render_receive_list();
								} 
								layer.msg(rdata.msg,{icon:rdata.status?1:2});
							})
						}else{
							layer.msg('Please enter the recipient\'s email address！',{icon:2});
						}
					})
					
					$(".smtp_closeBtn").click(function(){
						layer.close(index)
					})
				}
			})
		},
		/**
			* 设置发送者信息
		*/
		set_sender_info:function(){
			var that = this;
			var loadT = layer.msg('Retrieving sender information, please wait...', { icon: 16, time: 0, shade: [0.3, '#000'] });
			$.post('/config?action=get_settings',function(rdata){
				layer.close(loadT);
				var qq_mail = rdata['user_mail']['info']['msg']['qq_mail'] ? rdata['user_mail']['info']['msg']['qq_mail'] : '',
					qq_stmp_pwd = rdata['user_mail']['info']['msg']['qq_stmp_pwd']? rdata['user_mail']['info']['msg']['qq_stmp_pwd'] : '',
					hosts = rdata['user_mail']['info']['msg']['hosts']? rdata['user_mail']['info']['msg']['hosts'] : '',
					port = rdata['user_mail']['info']['msg']['port']? rdata['user_mail']['info']['msg']['port'] : ''
				layer.open({
					type: 1,
					area: "460px",
					title: "Set sender email information",
					closeBtn: 2,
					shift: 5,
					shadeClose: false,
					content: '<div class="bt-form pd20 pb70">\
						<div class="line">\
							<span class="tname">Sender email</span>\
							<div class="info-r">\
								<input name="channel_email_value" class="bt-input-text mr5" type="text" style="width: 300px" value="'+qq_mail+'">\
							</div>\
						</div>\
						<div class="line">\
							<span class="tname">Smtp password</span>\
							<div class="info-r">\
								<input name="channel_email_password" class="bt-input-text mr5" type="password" style="width: 300px" value="'+qq_stmp_pwd+'">\
							</div>\
						</div>\
						<div class="line">\
							<span class="tname">Smtp server</span>\
							<div class="info-r">\
								<input name="channel_email_server" class="bt-input-text mr5" type="text" style="width: 300px" value="'+hosts+'">\
							</div>\
						</div>\
						<div class="line">\
							<span class="tname">Port</span>\
							<div class="info-r">\
								<select class="bt-input-text mr5" id="port_select">\
									<option value="465" '+(port == '465'?'selected':'')+'>465</option>\
									<option value="25" '+(port == '25'?'selected':'')+'>25</option>\
									<option value="587" '+(port == '587'?'selected':'')+'>587</option>\
									<option value="other" '+(!that.is_port(port) && port != ''?'selected':'')+'>customize</option>\
								</select>\
								<input name="channel_email_port" class="bt-input-text mr5" type="Number" style="width: 190px" value="'+port+'">\
							</div>\
						</div>\
						<ul class="help-info-text c7">\
							<li>It is recommended to use port 465, and the protocol is SSL/TLS</li>\
							<li>Port 25 is SMTP protocol, port 587 is STARTTLS protocol</li>\
						</ul>\
						<div class="bt-form-submit-btn">\
							<button type="button" class="btn btn-danger btn-sm smtp_closeBtn">Close</button>\
							<button class="btn btn-success btn-sm SetChannelEmail">Save</button></div>\
						</div>',
					success:function(layers,index){
						var _option = '';
						$("#port_select").change(function(e){
							if(e.target.value == 'other'){
								$("#port_select").css("width","100px");
								$('input[name=channel_email_port]').css("display","inline-block");
							}else{
								$("#port_select").css("width","300px");
								$('input[name=channel_email_port]').css("display","none");
							}
						})
						$("#port_select").change()  //默认触发点击一次
						$(".SetChannelEmail").click(function(){
							var _email = $('input[name=channel_email_value]').val(),
								_passW = $('input[name=channel_email_password]').val(),
								_server = $('input[name=channel_email_server]').val(),
								_port = $('#port_select').val()
							if(_port == 'other') _port = $('input[name=channel_email_port]').val()
							if(_email == '') return layer.msg('Email address cannot be empty！',{icon:2});
							if(_passW == '') return layer.msg('STMP password cannot be empty！',{icon:2});
							if(_server == '') return layer.msg('STMP server address cannot be empty!',{icon:2})
							if(_port == '') return layer.msg('Please enter a valid port number',{icon:2})
							
							var loadTs = layer.msg('The mailbox channel is being generated, please wait...', { icon: 16, time: 0, shade: [0.3, '#000'] });
							$.post('/config?action=user_mail_send',{email:_email,stmp_pwd:_passW,hosts:_server,port:_port},function(res){
								layer.close(loadTs);
								if(res.status){
									layer.close(index)
									that.render_receive_list();
								}
								layer.msg(res.msg,{icon:res.status?1:2})
							})
						})
						$(".smtp_closeBtn").click(function(){
							layer.close(index)
						})
					}
				})
			})
		},
		/**
			* 删除收件者列表
			* @param {String} emil 需要删除的邮箱
		*/
		del_email:function(mail){
			var that = this;
			layer.confirm('Do you want to delete [ '+mail+' ] mailbox', { title: 'Delete recipient',closeBtn:2,icon:0}, function () {
				var loadT = layer.msg('Deleting [ '+mail+' ], please wait...', { icon: 16, time: 0, shade: [0.3, '#000'] })
				$.post('/config?action=del_mail_list',{email:mail},function(rdata){
					layer.close(loadT);
					if(rdata.status) that.render_receive_list();
					layer.msg(rdata.msg,{icon:rdata.status?1:2})
				})
			})
		},
		/**
			* 是否为默认端口
			* @param {Number} num 端口号
			* @return 判断是否为数组内的端口，否者返回false
		*/
		is_port:function(num){
			var that = this,ary_ = ['25','465','587'];
			for(var i = 0; i<ary_.length;i++){
				if(ary_[i] == num) return true;
			}
			return false
		},
		/**
			* 推送方式保存按钮
		*/
		alert_submit:function(){
			var _info = $('.box-group input:checked').attr('data-type');
			this.ajaxTask(_info == 'mail'?'set_mail_to':'set_dingding',function(res){
				layer.msg(res.msg,{icon:res.status?1:2})
			})
		},
		/**
			* 设置钉钉url信息，保存按钮
		*/
		set_submit_ding:function(){
			var _url = $('textarea[name=channel_dingding_value]').val(),_all = $('#panel_alert_all').prop("checked");
			if(_url == '') return layer.msg('请输入钉钉url',{icon:2})
			var loadT = layer.msg('正在生成钉钉通道中,请稍候...', { icon: 16, time: 0, shade: [0.3, '#000'] });
			$.post('/config?action=set_dingding',{url:_url,atall:_all == true? 'True':'False'},function(rdata){
				layer.close(loadT);
				layer.msg(rdata.msg,{icon:rdata.status?1:2})
			})
		},
		/**
        	* @description 刷新webshell页面数据
            * @param {String} type 选项卡>当前
        */
		refresh_data_webshell:function(type){
			var that = this;
			switch(type){
				case 'killing': //查杀
				    break;
				case 'rule_list': //规则列表
					that.render_webshell_rule();
				    break;
				case 'logs': //日志
					that.ajaxTask('get_log',function(res){
						$('.webshell_logs').html(res);
						$('.webshell_logs').scrollTop(99999999);
					});
				    break;
			}
		},
		/**
        	* @description 渲染表格视图
            * @param {Object} obj 提供ID,配置项
        */
		refresh_table_view:function(obj){
			var _thead = '<thead><tr>',_tbody = '',_config = obj.config,_data = obj.data,_event = {},that = this;
				$(obj.el).css({'height':this.is_defined((typeof obj.height),obj.height,'auto')}).addClass(this.is_defined((typeof obj.height),'fixed-table-view'));
				this.waf_table_list[obj.form_id] = obj;
				this.waf_table_list[obj.form_id]['reset']  = function () {
					that.refresh_table_view(obj)
				}
			for(var i=0;i<_config.length;i++){
				_thead += '<th '+this.is_data_type({name:'width',data:_config[i]}) + this.is_data_type({name:'align',data:_config[i]}) + this.is_data_type({name:'style',data:_config[i]})+'>' + _config[i].title +'</th>';
				if(_config[i]['event']){
					_event[obj.form_id+'_'+_config[i].fid] = {
						name: obj.form_id + '_' + _config[i].fid,
						event: _config[i]['events'] !== undefined?_config[i]['events']:'click',
						method: _config[i]['event']
					};
				}
			}
			_thead += '</tr></thead>';
			_tbody += '<tbody>';
			if(obj.inverted) _data.reverse();
			for(var z=0;z<_data.length;z++){
				_tbody += '<tr data-index="'+ z +'">';
				for(var j=0;j<_config.length;j++){
					var templet = '',_text = '';
					_tbody += '<td '+ (this.is_data_type({name:'style',data:_config[j]})) +' '+ this.is_data_type({name:'class',data:_config[j]}) +'>';
					if(_config[j].templet !== undefined && _config[j].event === undefined){
						_text = _config[j].templet(_data[z],z);
						_tbody += _text;
					}else if(_config[j].group !== undefined){
						var _arry = [];
						if(typeof _config[j].group === 'function'){
							_arry = _config[j].group(_data[z],z);
						}else{
							_arry = _config[j].group;
						}
						_tbody += '<span>';
						for(var y=0;y<_arry.length;y++){
							_tbody += '<a class="btlink" '+ this.is_defined((typeof _arry[y]['event']),'data-event="'+obj.form_id+'_'+_config[j].fid+'_'+ y +'"')+
    								this.is_data_type({name:'href',data:_config[y]}) +
    								this.is_data_type({name:'class',data:_config[y]}) +
    								this.is_data_type({name:'target',data:_config[y]}) +'>'+
								    (_arry[y].templet == undefined?_arry[y].title:_arry[y].templet(_arry[y],y))
								+'</a>';
							if((y+1) !== _arry.length) _tbody += '&nbsp;|&nbsp;';
							if(_arry[y]['event'] && !_event[obj.form_id+'_'+_config[j].fid+'_' + y]){
								_event[obj.form_id+'_'+_config[j].fid+'_' + y] = {
									name: obj.form_id+'_'+_config[j].fid+'_' + y,
									event: _arry[y]['events'] !== undefined?_arry[y]['events']:'click',
									method: _arry[y]['event']
								};
							}
						}
						_tbody += '</span>';
					}else{
						_text = _data[z][_config[j].fid];
						if(_text !== '' && typeof _text !== 'undefined'){
							_tbody += '<span title="'+ this.is_defined(typeof _config[j].tips,_text) +'">';
							switch(_config[j].type){
								case 'text':
									_tbody += '<span '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"')+'>'+ _text +'</span>';
								break;
								case 'link':
									_tbody += '<a class="btlink" '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"') + this.is_data_type({name:'href',data:_config[j],val:_config[j]['href']?_text:false}) + this.is_data_type({name:'class',data:_config[j]}) + this.is_data_type({name:'target',data:_config[j]}) +'>'+ 
									    (_config[j].templet == undefined?_text:_config[j].templet(_data[z],z))
									+'</a>';
								break;
								case 'checkbox':
									_tbody += '<input type="checkbox" class="waf_td_checkbox" '+(_data[z][_config[j].fid]?'checked':'') +' '+this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"')+' />';
								break;
								case 'btswitch':
									_tbody += '<input class="btswitch btswitch-ios" id="close_'+ _config[j].fid+'_'+ obj.form_id +'_'+ z +'" '+(_data[z][_config[j].fid]?'checked':'') +' type="checkbox">'+
										'<label class="btswitch-btn" for="close_'+ _config[j].fid +'_'+ obj.form_id +'_'+ z +'" '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"') +'></label>';
								break;
								case 'unselect':
									_tips = _config[j].tips?_config[j].tips(_data[z]):'';
									_open = typeof _data[z][_config[j].fid] == 'object'?_data[z][_config[j].fid][_config[j].is_contain]:_data[z][_config[j].fid];
									_tbody += '<span class="waf_unselect" '+ this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"') +'><i class="waf-icon waf-icon-ok '+ (_open?'waf-checked':'')  +'"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></i><input type="checkbox" '+ (_open?'checked':'')  +'></span>' + ( _tips === ''?'':('<span class="tipsval '+ (_tips>0?'grade_1':'') +'" title="Number of interceptions:'+ _tips +'">'+ _tips +'</span>'));
								break;
								default:
									_tbody += '<span '+this.is_defined((typeof _config[j].event),'data-event="'+obj.form_id+'_'+_config[j].fid+'"')+'>'+ _text +'</span>';
								break;
							}
							_tbody += '</span>';
						}else{
							_tbody += '<span>--</span>';
						}
					}
					_tbody += '</td>';
				}
				_tbody += '</tr>';
			}
			if(_data.length ===  0){
				_tbody += '<tr><td colspan="'+ _config.length +'" align="center">'+ this.is_defined((typeof obj.tips),obj.tips,'No data') +'</td></tr>';
			}
			_tbody += '</tbody>';
			$(obj.el).html('<table class="'+ this.is_defined((typeof obj.class),obj.class,'waf_table table table-hover') +'">'+ _thead + _tbody +'</table>');
			if(obj.page){
				if($(obj.el).next().length == 0){
					$(obj.el).after('<div class="waf_page">'+ obj.page +'</div>');
				}else{
					$(obj.el).next().html(obj.page);
				}
			}
			this.bind_evnet_group(obj,_event);
			setTimeout(function(){
				obj.done(obj.data,obj);
			},100);
			if(obj.height !== undefined){
				$(obj.el+' table').before('<table class="'+ that.is_defined((typeof obj.class),obj.class,'waf_table table table-hover fixed-table-thead') +'">'+ _thead +'</table>')
				$(obj.el+ ' .fixed-table-thead').next().addClass('fixed-table');
				$(obj.el+' .fixed-table thead th').each(function(index,el){
					var _offsetWidth = $(this)[0].offsetWidth - 20;
					$(obj.el +' .fixed-table-thead thead th').eq(index).html($(obj.el +' thead th').eq(index).text() +'<div class="waf-fht-cell" style="width:'+ _offsetWidth +'px">');
				});
				if($(obj.el+ ' .fixed-table')[0].offsetHeight > parseFloat(obj.height)){
					$(obj.el+ ' .fixed-table-thead').addClass('fixed-table-shadow');
				}
				$(obj.el+ ' .fixed-table-thead').css('top',$(obj.el).scrollTop())
				$(obj.el).scroll(function(){
					$(obj.el+ ' .fixed-table-thead').css('top',$(this).scrollTop());
				});
			}
		},
		// 判断格式
		is_defined:function(is_val,num1,num2){
			return is_val !== 'undefined'?(num1 === undefined?is_val:num1):(num2 === undefined?'':num2);
		},
		/**
        	* @description 判断数据类型 (仅用于表单渲染类型绑定)
            * @param {string} obj 数据类型、数据
			* 
        */
		is_data_type:function(obj){
			if(obj.data === undefined) return 'href="javascript:;"';
			if(obj.data[obj.name] !== undefined)return obj.name +'="'+ obj.data[obj.name]+'"';
			if(obj.name == 'href'){
				if(!obj.val){
					return 'href="javascript:;" ';
				}else{
					return 'href="'+ obj.val +'" ';
				}
			}
			return '';
		},
		/**
        	* @description 绑定事件组 (仅用于表单渲染事件绑定)
            * @param {string} obj 全部数据
            * @param {string} events 调用的事件
        */
		bind_evnet_group:function(obj,events){
			for(var i in events){
				(function(i){
					$(obj.el +' [data-event='+events[i].name+']').bind(events[i].event,function(e){
						var _index = parseInt($(this).parent().parent().parent().attr('data-index')),
							_data = obj.data[_index];
						events[i].method(_data,_index,e,$(this));
					});
				})(i)
			}
		},
		// 添加千位分界符
		addThousands:function(num) {
			var reg = /\d{1,3}(?=(\d{3})+$)/g;
			if ( num &&num.toString().indexOf('.') == -1) {
				return (num + '').replace(reg, '$&,');
			} else {
				return num.toString().replace(/(\d)(?=(\d{3})+\.)/g, function ($0, $1) {
					return $1 + ",";
				});
			}
		},
		// 规则转码
		escapeHTML:function(val) {
			val = "" + val;
			return val.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, '&quot;').replace(/'/g, "‘").replace(/\(/g, "&#40;").replace(/\&#60;/g, "&lt;").replace(/\&#62;/g, "&gt;").replace(/`/g, "&#96;").replace(/=/g, "＝");
		},
		/**
         * @descripttion 选项框多选搜索
         * @param {Object} config.el                    选项框的元素/id（带#符号）
         * @param {Object} config.url                   数据请求
         * @param {Object} config.loading               请求时的提示语
         * @param {Object} config.param                 请求所需参数
         * @param {Object} config.dataFilter            请求数据处理（过滤成模板类型数据）
         * @param {Object} config.config.width          选项框宽度
         * @param {Object} config.config.name           选项框搜索的name值
         * @param {Object} config.config.placeholder    选项框提示的文字
         * @param {Object} config.config.ischeck        选项框是否多选
         * @param {Object} config.config.issearch       选项框是否可搜索
         * @param {Object} config.data                  选项框所能选择的数据
         * @return {Function} callback 
         */
		select:function(config){
            function RenderSelect(config){
                this.config = config;
                this.init();
            }
            RenderSelect.prototype = {
                _event: [],           //选中的数据
                inputShowText: '',    //input位置显示的文本内容
                manyCheckArray:[],    //多选时临时存放的数据（用于拼接数据
                init:function(){
                    var that = this,_Obj = this.config
                    // 数据类型判断
                    if(_Obj.method != undefined){
                        this.request_data_list()
                    }else if(_Obj.data != undefined){
                        this.create_select_list()
                    }else{
                        return layer.msg('Missing [method] or [data] parameters',{icon:2})
                    }
                    
                    // 监听选项框 文档事件
                    $(_Obj.el).on('click',function(e){
                        $(document).one('click',function(ev){
                            ev.stopPropagation();
                            $(_Obj.el +' .select-picker-search').removeClass('Select-moseDown');
                            $(_Obj.el +' .select-list-item').hide();
                        })
                        e.stopPropagation();
                    })
                    // 显示/隐藏下拉列表
                    $(_Obj.el).on('click','.select-picker-search',function(e){
                        if(!$(this).hasClass('Select-moseDown')){
                            $(this).addClass('Select-moseDown');
                            $(_Obj.el +' .select-list-item').show();
                            $('input[name=query_list]').focus();
                        }else{
                            $(this).removeClass('Select-moseDown');
                            $(_Obj.el +' .select-list-item').hide();
                        }
                    })
                    // 列表点击时
                    $(_Obj.el).on('click','.select-list-item li',function(ev){
                        var check_all = $('.checkAll'),_attr = $(this).data('attr'),_index = $(this).data('index');
                        switch(_attr){
                            case 'all':
                                if(!$(this).hasClass('active')){
                                    $(this).addClass('active').siblings().addClass('active');
                                    that._event = $.extend(true,[],_Obj.data)    //深拷贝数组否则影响原有数据
                                }else{
                                    $(this).removeClass('active').siblings().removeClass('active');
                                    that._event = [];
                                }
                                break;
                            default:
                                if(!$(this).hasClass('active')){
                                    _Obj.config.ischeck ? $(this).addClass('active') : $(this).addClass('active').siblings().removeClass('active');
                                    _Obj.config.ischeck ? that._event.push(_Obj.data[_index]) : that._event = _Obj.data[_index];
                                }else{
                                    if(_Obj.config.ischeck){
                                        $(this).removeClass('active');
                                        for(var i = 0;i<that._event.length; i++){
                                            if(that._event[i][0] === _attr) that._event.splice(i,1);
                                        }
                                    }
                                }
                                // 选择的数量等于原有数据时自动全选
                                if(that._event.length == _Obj.data.length){
                                    check_all.addClass('active')
                                }else{
                                    check_all.removeClass('active')
                                }
                                break;
                        }
                        if(_Obj.config.ischeck){  //判断是否多选
                            // 判断选择数量
                            if(that._event.length < 1){
                                that.inputShowText = _Obj.config.placeholder
                            }else{
                                that.manyCheckArray = [];
                                $.each(that._event, function(k,showlist){that.manyCheckArray.push(showlist[1])})
                                that.inputShowText = that.manyCheckArray.join(', ')
                            }
                        }else{
                            // 单选时选中直接输入并关闭选择区
                            that.inputShowText = _Obj.data[_index][1];
                            $(_Obj.el +' .select-picker-search').click();
                        }
                        // 输出内容
                        $(_Obj.el +' .picker-text-list').attr('title',that.inputShowText).html(that.inputShowText);
						_Obj.formatRepoSelection(that.manyCheckArray,that._event.length == _Obj.data.length)
                        ev.stopPropagation();
                        ev.preventDefault();
                    })
                    // 搜索功能
                    $(_Obj.el).on('input','input[name=query_list]',function(){
                        var _search = $(this).val();
                        if(_search.trim() != ''){
                            $('.select-list-item li').each(function(){
                                var _span = $(this).find('span').html()
                                if(_span.toLowerCase().indexOf(_search.toLowerCase()) == -1){
                                    $(this).hide()
                                }else{
                                    $(this).show()
                                }
                            })
                        }else{
                            $('.select-list-item li').show()
                        }
                    })
                },
                /**
                 * @descripttion: 创建下拉列表
                 * @return: 无返回值
                 */
                create_select_list:function(){
                    var _html = '',_li = '',obj = this.config,_config = this.config.config;
                    _html += '<div class="bt-select-full '+(_config.ischeck ? 'many' : 'only-one')+'">'
                        +'<div class="select-picker-search" style="width:'+_config.width+'px"><span class="picker-text-list" style="width:'+(_config.width - 35)+'px">'+_config.placeholder+'</span></div>'
                        +'<span class="down-select-full"></span>'
                        +'<div class="select-list-item">'
                        +(_config.issearch?'<input name="query_list" placeholder="Fuzzy search" style="width:'+(_config.width - 20)+'px">':'')
                        +'<ul>'

                    // 多选时添加全部选中
                    _config.ischeck ? _li+='<li data-attr="all" class="checkAll"><div class="select-check-full"></div><span class="select-name-full">Select all</span></li>':''
                    $.each(obj.data,function(index,item){
                        _li += '<li data-attr="'+item[0]+'" data-index="'+index+'">'
                                +(_config.ischeck?'<div class="select-check-full"></div>':'')
                                +'<span class="select-name-full">'+item[1]+'</span>'
                            +'</li>'
                    })
                    _html += _li +'</ul></div></div>'
                    $(obj.el).html(_html);
                },
                /**
                 * @descripttion: 请求API返回的数据
                 * @return: 无返回值
                 */
                request_data_list:function(){
                    var that = this,obj = this.config;
                    bt_waf.http({method:obj.method,data:obj.data,success(rdata){
                        if(obj.dataFilter){
                            obj.data = obj.dataFilter(rdata);
                        }else{ obj.data = rdata.data}
                        that.create_select_list();
                    }})
                }
            }
            return new RenderSelect(config);
        },
		/**
        	* @description 动态处理请求，设置全局ajaxList，api和提示语，遍历请求返回成功值
            * @param {String} config 需要请求的api
            * @param {Function} data 请求参数
            * @param {Function} success 成功值
            * @param {Function} error 失败值
        */
        ajaxTask: function (config, data, success, error) {
            if (typeof config == "string") {
                if (typeof data == "object") {
                    config = { method: config, data: data, success: success, error: error }
                } else if (typeof data == "function") {
                    config = { method: config, success: data }
                    if (typeof success == "function") {
                        config.error = success
                    }
                }
            }
            if (config.middle === false) { config.success(); return false }
            this.http({
                tips: this.ajaxList[config.method] + ', Please wait...',
                method: config.method,
                data: config.data || {},
                success: function (rdata) {
                    if (config.success) config.success(rdata);
                },
                error: function (rdata) {
                    if (config.error) config.error(rdata);
                }
            });
        },
		// 请求封装
		http: function (obj) {
            var loadT = '';
            if (obj.load == undefined) obj.load = 0;
            if (obj.url == undefined) {
                if (obj.plugin_name === undefined && this.plugin_name !== undefined) obj.plugin_name = this.plugin_name
                if (!obj.plugin_name || !obj.method) {
                    layer.msg('The plug-in class name, or the plug-in method name is missing!', {icon: 2 });
                    return false;
                }
            }
            if (obj.load === 0 || obj.tips != undefined) {
                loadT = layer.msg(obj.tips, {icon: 16,time: 0, shade: 0.1});
            } else if (obj.load === 1 || (obj.tips == undefined && obj.load == undefined)) {
                loadT = layer.load();
            }
            $.ajax({
                type: obj.type===undefined?'POST':obj.type,
                url: obj.url != undefined ? obj.url : ('/plugin?action=a&name=' + obj.plugin_name + '&s=' + obj.method),
                data: obj.data || {},
                timeout: obj.timeout || 99999999,
                complete: function (res) {
                    if (obj.load === 0 || obj.load === 1) layer.close(loadT);
                },
                success: function (rdata) {
                    if (obj.check) {
                        obj.success(rdata);
                        return
                    }
                    if (typeof rdata.status !== 'undefined' && rdata.status === false) {
                        layer.msg(rdata.msg, {icon: 2});
                        return false;
                    }
                    obj.success(rdata);
                },
                error: function (ex) {
                    if (!obj.error) {
                        obj.msg || obj.msg == undefined ? layer.msg('Error found during request!', {icon: 2}) : '';
                        return;
                    }
                    return obj.error(ex);
                }
            });
        }
	}
	function site_waf_config(siteName){
		bt_waf.set_site_config_view({siteName:siteName});
	}
	if(window.location.pathname !== '/site'){
		bt_waf.init();
	}
</script>